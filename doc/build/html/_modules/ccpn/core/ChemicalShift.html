
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ccpn.core.ChemicalShift &#8212; Python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.ChemicalShift</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.core.ChemicalShift</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module Documentation here</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (https://www.ccpn.ac.uk) 2014 - 2022&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Ed Brooksbank, Joanna Fox, Victoria A Higman, Luca Mureddu, Eliza Płoskoń&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Timothy J Ragan, Brian O Smith, Gary S Thompson &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See https://ccpn.ac.uk/software/licensing/&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Skinner, S.P., Fogh, R.H., Boucher, W., Ragan, T.J., Mureddu, L.G., &amp; Vuister, G.W.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;CcpNmr AnalysisAssign: a flexible platform for integrated NMR analysis&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;J.Biomol.Nmr (2016), 66, 111-124, http://doi.org/10.1007/s10858-016-0060-y&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Ed Brooksbank $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2022-02-23 17:20:31 +0000 (Wed, February 23, 2022) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.1.0 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: Ed Brooksbank $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2021-08-02 10:55:54 +0100 (Mon, August 02, 2021) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">ccpn.core</span> <span class="kn">import</span> <span class="n">_importOrder</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.NmrAtom</span> <span class="kn">import</span> <span class="n">NmrAtom</span>
<span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShiftList</span> <span class="kn">import</span> <span class="n">ChemicalShiftList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">ccpNmrV3CoreSetter</span><span class="p">,</span> <span class="n">undoStackBlocking</span><span class="p">,</span> <span class="n">deleteV3Object</span><span class="p">,</span> <span class="n">ccpNmrV3CoreUndoBlock</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Pid</span> <span class="kn">import</span> <span class="n">Pid</span><span class="p">,</span> <span class="n">createId</span>
<span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShiftList</span> <span class="kn">import</span> <span class="n">CS_UNIQUEID</span><span class="p">,</span> <span class="n">CS_ISDELETED</span><span class="p">,</span> <span class="n">CS_STATIC</span><span class="p">,</span> <span class="n">CS_VALUE</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> \
    <span class="n">CS_FIGUREOFMERIT</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_SEQUENCECODE</span><span class="p">,</span> <span class="n">CS_RESIDUETYPE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> \
    <span class="n">CS_COMMENT</span><span class="p">,</span> <span class="n">CS_COLUMNS</span><span class="p">,</span> <span class="n">ChemicalShiftState</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.V3CoreObjectABC</span> <span class="kn">import</span> <span class="n">V3CoreObjectABC</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Common</span> <span class="kn">import</span> <span class="n">makeIterableList</span>
<span class="kn">from</span> <span class="nn">ccpn.util.decorators</span> <span class="kn">import</span> <span class="n">logCommand</span>


<span class="n">MINFOM</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">MAXFOM</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">ShiftParameters</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;ShiftParameters&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CS_UNIQUEID</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_ISDELETED</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_STATIC</span><span class="si">}</span><span class="s1"> &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CS_VALUE</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_VALUEERROR</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_FIGUREOFMERIT</span><span class="si">}</span><span class="s1"> &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CS_NMRATOM</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_CHAINCODE</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_SEQUENCECODE</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_RESIDUETYPE</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">CS_ATOMNAME</span><span class="si">}</span><span class="s1"> &#39;</span>
                                                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">CS_COMMENT</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>


<div class="viewcode-block" id="ChemicalShift"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShift.ChemicalShift">[docs]</a><span class="k">class</span> <span class="nc">ChemicalShift</span><span class="p">(</span><span class="n">V3CoreObjectABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Chemical Shift, containing a ChemicalShift value for the NmrAtom they belong to.</span>

<span class="sd">    Chemical shift values are continuously averaged over peaks assigned to the NmrAtom,</span>
<span class="sd">    (unless this behaviour is turned off)</span>

<span class="sd">    ChemicalShift objects are sorted by uniqueId.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Short class name, for PID.</span>
    <span class="n">shortClassName</span> <span class="o">=</span> <span class="s1">&#39;CS&#39;</span>
    <span class="c1"># Attribute - necessary as subclasses must use superclass className</span>
    <span class="n">className</span> <span class="o">=</span> <span class="s1">&#39;ChemicalShift&#39;</span>
    <span class="n">_oldClassName</span> <span class="o">=</span> <span class="s1">&#39;_OldChemicalShift&#39;</span>

    <span class="n">_parentClass</span> <span class="o">=</span> <span class="n">ChemicalShiftList</span>

    <span class="c1">#: Name of plural link to instances of class</span>
    <span class="n">_pluralLinkName</span> <span class="o">=</span> <span class="s1">&#39;chemicalShifts&#39;</span>

    <span class="n">_childClasses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_isGuiClass</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># the attribute name used by current</span>
    <span class="n">_currentAttributeName</span> <span class="o">=</span> <span class="s1">&#39;chemicalShifts&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new instance of v3 Shift</span>

<span class="sd">        _unique Id links the shift to the dataFrame storage and MUST be specified</span>
<span class="sd">        before the shift can be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_oldValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValueError</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># All other properties are derived from the chemicalShiftList pandas dataframe</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN Properties</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Identifier for the object, used to generate the pid and longPid.</span>
<span class="sd">        Generated by combining the id of the containing object, i.e. the checmialShift instance,</span>
<span class="sd">        with the value of one or more key attributes that uniquely identify the object in context</span>
<span class="sd">        E.g. &#39;default.1&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedId</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDeleted</span> <span class="k">else</span> <span class="n">createId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chemicalShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;ChemicalShiftList containing ChemicalShift.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># Class Properties and methods</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Not allowed for ChemicalShift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;ChemicalShift does not have attribute name&#39;</span><span class="p">)</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not allowed for ChemicalShift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;ChemicalShift name cannot be set&#39;</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Getter/setter for undo/redo</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_STATIC</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@_static</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_static</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_STATIC</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">static</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Static state of ChemicalShift.</span>
<span class="sd">        :return: True if chemicalShift or parent chemicalShiftTable is static</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">static</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Dynamic state of ChemicalShift.</span>
<span class="sd">        :return: not chemicalShift.static</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orphan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Orphan state of the chemicalShift</span>
<span class="sd">        :return: True if not static (i.e. dynamic), and has no associated peaks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignedPeaks</span>

<div class="viewcode-block" id="ChemicalShift.getStatic"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShift.ChemicalShift.getStatic">[docs]</a>    <span class="k">def</span> <span class="nf">getStatic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the local static state of the chemicalShift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_static</span></div>

    <span class="c1"># @logCommand(get=&#39;self&#39;)</span>
    <span class="c1"># def setStatic(self, value: bool):</span>
    <span class="c1">#     &quot;&quot;&quot;Set the local static state for the chemicalShift.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if not isinstance(value, bool):</span>
    <span class="c1">#         raise ValueError(f&#39;{self.className}.setStatic must be True/False&#39;)</span>
    <span class="c1">#     # use setter above to handle undo/redo</span>
    <span class="c1">#     self._static = value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;State of chemicalShift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ChemicalShiftState</span><span class="o">.</span><span class="n">STATIC</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">orphan</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ChemicalShiftState</span><span class="o">.</span><span class="n">ORPHAN</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ChemicalShiftState</span><span class="o">.</span><span class="n">DYNAMIC</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="c1"># NOTE:ED - added &#39;@checkDeleted&#39; but I don&#39;t think they are required</span>
    <span class="c1"># @checkDeleted()</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;shift value of ChemicalShift, in unit as defined in the ChemicalShiftList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUE</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the value for the chemicalShift.</span>
<span class="sd">        Integers will be cast as floats on the next get operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.value must be of type float, int or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.value cannot be changed with attached nmrAtom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUE</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valueError</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;shift valueError of ChemicalShift, in unit as defined in the ChemicalShiftList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="nd">@valueError</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">valueError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the valueError for the chemicalShift.</span>
<span class="sd">        Integers will be cast as floats on the next get operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.valueError must be of type float, int or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.valueError cannot be changed with attached nmrAtom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">figureOfMerit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Figure of Merit for ChemicalShift, between 0.0 and 1.0 inclusive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_FIGUREOFMERIT</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

    <span class="nd">@figureOfMerit</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">figureOfMerit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the figureOfMerit for the chemicalShift.</span>
<span class="sd">        Integers will be cast as floats on the next get operation; only integers 0 and 1 are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.figureOfMerit must be of type float, int or None&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">MINFOM</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="n">MAXFOM</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.figureOfMerit must be in range [</span><span class="si">{</span><span class="n">MINFOM</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">MAXFOM</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_FIGUREOFMERIT</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NmrAtom</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Attached NmrAtom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">_nmrAtomPid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_nmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">NmrAtom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the nmrAtom inside core undoBlock</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">nat</span><span class="o">.</span><span class="n">_chemicalShifts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># nmrAtom and derived properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span>
                                             <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nat</span><span class="p">:</span>
                <span class="n">nat</span><span class="o">.</span><span class="n">_chemicalShifts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">value</span><span class="o">.</span><span class="n">_chemicalShifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_recalculateShiftValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@nmrAtom</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreUndoBlock</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">nmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Pid</span><span class="p">,</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the nmrAtom for the chemicalShift</span>
<span class="sd">        nmrAtom can be core object of type NmrAtom, or string pid or None</span>

<span class="sd">        :param value: new nmrAtom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span>

        <span class="n">_oldNmrAt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">_oldNmrAt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># trivial - ignore</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check the new value is valid - allow core object, str or Pid</span>
            <span class="n">_nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_nmrAtom</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.nmrAtom: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_nmrAtom</span> <span class="o">==</span> <span class="n">nat</span><span class="p">:</span>
                <span class="c1"># trivial - ignore</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_nmrAtom</span><span class="p">,</span> <span class="n">NmrAtom</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.nmrAtom: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> must be of type NmrAtom&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_searchChemicalShifts</span><span class="p">(</span><span class="n">nmrAtom</span><span class="o">=</span><span class="n">_nmrAtom</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.nmrAtom: </span><span class="si">{</span><span class="n">_nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s1"> already exists&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_nmrAtom</span>

        <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_oldNmrAt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># previously empty - remember the OLD settings - is only required by undo/redo to give previous state</span>
                <span class="n">_oldSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
                <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="n">_oldSettings</span><span class="p">),</span> <span class="p">)</span>

            <span class="c1"># update the nmrAtom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nmrAtom</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nmrAtom</span><span class="p">,</span> <span class="n">_oldNmrAt</span><span class="p">),</span>
                        <span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nmrAtom</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># now empty - remember the NEW settings - is only required by undo/redo to give new state</span>
                <span class="n">_newSettings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
                <span class="n">addUndoItem</span><span class="p">(</span><span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="n">_newSettings</span><span class="p">),</span> <span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chainCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;chainCode for attached nmrAtom.</span>
<span class="sd">        Optional user value if nmrAtom is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@chainCode</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">chainCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the chainCode for the chemicalShift</span>
<span class="sd">        Cannot be changed if there is an nmrAtom already attached</span>
<span class="sd">        Must be of type string or None</span>

<span class="sd">        :param value: new chainCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.chainCode must be of type str or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.chainCode: derived value, cannot modify when nmrAtom is set&#39;</span><span class="p">)</span>
        <span class="c1"># only set if the nmrAtom has not been set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequenceCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;sequenceCode for attached nmrAtom.</span>
<span class="sd">        Optional user value if nmrAtom is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_SEQUENCECODE</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@sequenceCode</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">sequenceCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the sequenceCode for the chemicalShift</span>
<span class="sd">        Cannot be changed if there is an nmrAtom already attached</span>
<span class="sd">        Must be of type string or None</span>

<span class="sd">        :param value: new sequenceCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.sequenceCode must be of type str or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.sequenceCode: derived value, cannot modify when nmrAtom is set&#39;</span><span class="p">)</span>
        <span class="c1"># only set if the nmrAtom has not been set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_SEQUENCECODE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">residueType</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;residueType for attached nmrAtom.</span>
<span class="sd">        Optional user value if nmrAtom is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_RESIDUETYPE</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@residueType</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">residueType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the residueType for the chemicalShift</span>
<span class="sd">        Cannot be changed if there is an nmrAtom already attached</span>
<span class="sd">        Must be of type string or None</span>

<span class="sd">        :param value: new residueType</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.residueType must be of type str or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.residueType: derived value, cannot modify when nmrAtom is set&#39;</span><span class="p">)</span>
        <span class="c1"># only set if the nmrAtom has not been set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_RESIDUETYPE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atomName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;atomName for attached nmrAtom</span>
<span class="sd">        Optional user value if nmrAtom is None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>

    <span class="nd">@atomName</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">atomName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Set the atomName for the chemicalShift</span>
<span class="sd">        Cannot be changed if there is an nmrAtom already attached</span>
<span class="sd">        Must be of type string or None</span>

<span class="sd">        :param value: new atomName</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.atomName must be of type str or None&#39;</span><span class="p">)</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtomPid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.atomName: derived value, cannot modify when nmrAtom is set&#39;</span><span class="p">)</span>
        <span class="c1"># only set if the nmrAtom has not been set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="c1">#~~~~~~~~~~~~~~~~</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assignedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Assigned peaks for attached nmrAtom belonging to this chemicalShiftList.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assigned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allAssignedPeaks</span>
        <span class="k">if</span> <span class="n">assigned</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pp</span> <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">assigned</span> <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShiftList</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allAssignedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;All assigned peaks for attached nmrAtom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_nmrAtomPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="n">_nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">_nmrAtomPid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_nmrAtom</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">makeIterableList</span><span class="p">(</span><span class="n">_nmrAtom</span><span class="o">.</span><span class="n">assignedPeaks</span><span class="p">)))</span>

        <span class="k">return</span> <span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">peakPpmPositions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple of the assigned peak positions (in ppm)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignedPeaks</span> <span class="k">for</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pk</span><span class="o">.</span><span class="n">ppmPositions</span><span class="p">,</span> <span class="n">pk</span><span class="o">.</span><span class="n">dimensionNmrAtoms</span><span class="p">))</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># Implementation functions - necessary as there is no abstractWrapper object</span>
    <span class="c1">#=========================================================================================</span>

<div class="viewcode-block" id="ChemicalShift.rename"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShift.ChemicalShift.rename">[docs]</a>    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not allowed for ChemicalShift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;ChemicalShift cannot be renamed&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_resetUniqueId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the uniqueId</span>
<span class="sd">        CCPN Internal - although not sure whether actually required here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self._wrapperList._searchChemicalShifts(uniqueId=value):</span>
        <span class="c1">#     raise ValueError(f&#39;{self.className}._resetUniqueId: uniqueId {value} already exists&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccpnSortKey</span> <span class="o">=</span> <span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">),</span> <span class="n">_importOrder</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oldClassName</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">)</span>

<div class="viewcode-block" id="ChemicalShift.delete"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShift.ChemicalShift.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the shift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">deleteChemicalShift</span><span class="p">(</span><span class="n">uniqueId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">)</span></div>
        <span class="c1"># raise RuntimeError(f&#39;{self.className}.delete: Please use ChemicalShiftList.deleteChemicalShift()&#39;)  # optional error-trap</span>

    <span class="k">def</span> <span class="nf">_updateNmrAtomShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Restore the links to the nmrAtoms</span>
<span class="sd">        CCPN Internal - called from first creation from _restoreObject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span>
        <span class="c1"># must assume that the shift value is correct at this point</span>
        <span class="k">if</span> <span class="n">_nmrAtom</span><span class="p">:</span>
            <span class="n">_nmrAtom</span><span class="o">.</span><span class="n">_chemicalShifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN functions</span>
    <span class="c1">#=========================================================================================</span>

    <span class="k">def</span> <span class="nf">_getAsTuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the contents of the shift as a tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDeleted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._getAsTuple: shift is deleted&#39;</span><span class="p">)</span>

        <span class="n">newRow</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_isDeleted</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_static</span><span class="p">,</span>  <span class="c1"># the local static</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">figureOfMerit</span><span class="p">,</span>
                  <span class="p">)</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,)</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span> <span class="k">else</span>
                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chainCode</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequenceCode</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residueType</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atomName</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>
                  <span class="p">)</span> <span class="o">+</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,)</span>
        <span class="n">newRow</span> <span class="o">=</span> <span class="n">ShiftParameters</span><span class="p">(</span><span class="o">*</span><span class="n">newRow</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newRow</span>

    <span class="k">def</span> <span class="nf">_getAsPandasSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the contents of the shift as a pandas series</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAsTuple</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="n">_row</span><span class="p">,),</span> <span class="n">columns</span><span class="o">=</span><span class="n">CS_COLUMNS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_recalculateShiftValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the shift value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nmrAtom</span> <span class="o">=</span> <span class="n">nmrAtom</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">static</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">assignedPeaks</span><span class="p">:</span>
                    <span class="c1"># remember the oldest setting</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_oldValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValueError</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueError</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_oldValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValueError</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">value</span><span class="p">,</span> <span class="n">valueError</span> <span class="o">=</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">_recalculateShiftValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span><span class="p">,</span> <span class="n">valueError</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="n">valueError</span> <span class="o">=</span> <span class="n">valueError</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">valueError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># update the dataframe</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="n">valueError</span><span class="p">)</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oldValue</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValueError</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># make sure that the empty value does not change</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValue</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oldValueError</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_renameNmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the values in the table for the renamed nmrAtom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">:</span>
            <span class="c1"># nmrAtom and derived properties</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapperList</span><span class="o">.</span><span class="n">_setAttributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">,</span> <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span>
                                             <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">),)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>

    <span class="c1">#===========================================================================================</span>
    <span class="c1"># new&lt;Object&gt; and other methods</span>
    <span class="c1"># Call appropriate routines in their respective locations</span>
    <span class="c1">#===========================================================================================</span>

    <span class="nd">@deleteV3Object</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_deleteWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_newDeletedShifts</span><span class="p">,</span> <span class="n">_newShifts</span><span class="p">,</span> <span class="n">_oldDeletedShifts</span><span class="p">,</span> <span class="n">_oldShifts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete a pure V3 ChemicalShift object</span>
<span class="sd">        Method is wrapped with create/delete notifier</span>
<span class="sd">        CCPN Internal - Not standalone - requires functionality from ChemicalShiftList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add an undo/redo item to recover shifts</span>
        <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
            <span class="c1"># replace the contents of the internal list with the original/recovered items</span>
            <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_undoRedoShifts</span><span class="p">,</span> <span class="n">_oldShifts</span><span class="p">),</span>
                        <span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_undoRedoShifts</span><span class="p">,</span> <span class="n">_newShifts</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nmrAtom</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
            <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_undoRedoDeletedShifts</span><span class="p">,</span> <span class="n">_oldDeletedShifts</span><span class="p">),</span>
                        <span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_undoRedoDeletedShifts</span><span class="p">,</span> <span class="n">_newDeletedShifts</span><span class="p">))</span></div>


<span class="k">def</span> <span class="nf">_newChemicalShift</span><span class="p">(</span><span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                      <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new chemicalShift attached to the chemicalShiftList.</span>

<span class="sd">    :param chemicalShiftList: parent chemicalShiftList</span>
<span class="sd">    :param _uniqueId: _unique int identifier</span>
<span class="sd">    :return: a new ChemicalShift instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">ChemicalShift</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="o">=</span><span class="n">_uniqueId</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;ChemicalShiftList._newChemicalShift: unable to generate new ChemicalShift item&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_getByTuple</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="p">,</span>
                <span class="n">uniqueId</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">isDeleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">static</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">valueError</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="n">nmrAtom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">chainCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">residueType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atomName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a new tuple object from the supplied parameters</span>
<span class="sd">    Check whether a valid tuple can be created, otherwise raise the appropriate errors</span>
<span class="sd">    CCPN Internal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># check whether the parameters are valid</span>
    <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">((</span><span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">atomName</span><span class="p">)):</span>
        <span class="c1"># compare with parameter not the found nmrAtom</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot set nmrAtom and derived Properties at the same time&#39;</span><span class="p">)</span>

    <span class="c1"># now check with the &#39;found&#39; nmrAtom</span>
    <span class="n">nmrAtom</span> <span class="o">=</span> <span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="p">(</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;nmrAtom must be of type nmrAtom or None&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">static</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;static must be True/False&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">atomName</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;chainCode, sequenceCode, residueType, atomName must be of type str or None&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">valueError</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;value, valueError, figureOfMerit must be of type float, int or None&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">figureOfMerit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">MINFOM</span> <span class="o">&lt;=</span> <span class="n">figureOfMerit</span> <span class="o">&lt;=</span> <span class="n">MAXFOM</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;figureOfMerit must be in range [</span><span class="si">{</span><span class="n">MINFOM</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">MAXFOM</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>

    <span class="c1"># create the row as defined in the pandas dataFrame</span>
    <span class="n">newRow</span> <span class="o">=</span> <span class="p">(</span><span class="n">uniqueId</span><span class="p">,</span>
              <span class="n">isDeleted</span><span class="p">,</span>
              <span class="n">static</span><span class="p">,</span>
              <span class="n">value</span><span class="p">,</span>
              <span class="n">valueError</span><span class="p">,</span>
              <span class="n">figureOfMerit</span><span class="p">,</span>
              <span class="p">)</span> <span class="o">+</span> \
             <span class="p">(((</span><span class="nb">str</span><span class="p">(</span><span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">),)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">val</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span> <span class="k">if</span> <span class="n">nmrAtom</span> <span class="k">else</span>
              <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">chainCode</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sequenceCode</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">residueType</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atomName</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">))</span> <span class="o">+</span> \
             <span class="p">(</span><span class="n">comment</span><span class="p">,)</span>
    <span class="n">newRow</span> <span class="o">=</span> <span class="n">ShiftParameters</span><span class="p">(</span><span class="o">*</span><span class="n">newRow</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">newRow</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.ChemicalShift</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>