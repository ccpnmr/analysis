
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ccpn.core.ChemicalShiftList &#8212; Python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.ChemicalShiftList</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.core.ChemicalShiftList</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (https://www.ccpn.ac.uk) 2014 - 2022&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Ed Brooksbank, Joanna Fox, Victoria A Higman, Luca Mureddu, Eliza Płoskoń&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Timothy J Ragan, Brian O Smith, Gary S Thompson &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See https://ccpn.ac.uk/software/licensing/&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Skinner, S.P., Fogh, R.H., Boucher, W., Ragan, T.J., Mureddu, L.G., &amp; Vuister, G.W.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;CcpNmr AnalysisAssign: a flexible platform for integrated NMR analysis&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;J.Biomol.Nmr (2016), 66, 111-124, http://doi.org/10.1007/s10858-016-0060-y&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Ed Brooksbank $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2022-07-05 13:20:36 +0100 (Tue, July 05, 2022) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.1.0 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>

<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.ccp.nmr</span> <span class="kn">import</span> <span class="n">Nmr</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.AbstractWrapperObject</span> <span class="kn">import</span> <span class="n">AbstractWrapperObject</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.DataFrameABC</span> <span class="kn">import</span> <span class="n">DataFrameABC</span>
<span class="kn">from</span> <span class="nn">ccpn.core.PeakList</span> <span class="kn">import</span> <span class="n">PeakList</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Spectrum</span> <span class="kn">import</span> <span class="n">Spectrum</span>
<span class="kn">from</span> <span class="nn">ccpn.core.NmrAtom</span> <span class="kn">import</span> <span class="n">NmrAtom</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Pid</span> <span class="kn">import</span> <span class="n">Pid</span><span class="p">,</span> <span class="n">remapSeparators</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">newObject</span><span class="p">,</span> <span class="n">newV3Object</span><span class="p">,</span> <span class="n">renameObject</span><span class="p">,</span> \
    <span class="n">undoBlockWithoutSideBar</span><span class="p">,</span> <span class="n">undoStackBlocking</span><span class="p">,</span> <span class="n">undoBlock</span><span class="p">,</span> <span class="n">ccpNmrV3CoreSetter</span>
<span class="kn">from</span> <span class="nn">ccpn.util.decorators</span> <span class="kn">import</span> <span class="n">logCommand</span>
<span class="kn">from</span> <span class="nn">ccpn.util.OrderedSet</span> <span class="kn">import</span> <span class="n">OrderedSet</span>
<span class="kn">from</span> <span class="nn">ccpn.util.DataEnum</span> <span class="kn">import</span> <span class="n">DataEnum</span>


<span class="n">CS_UNIQUEID</span> <span class="o">=</span> <span class="s1">&#39;uniqueId&#39;</span>
<span class="n">CS_PID</span> <span class="o">=</span> <span class="s1">&#39;pid&#39;</span>
<span class="n">CS_VALUE</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
<span class="n">CS_VALUEERROR</span> <span class="o">=</span> <span class="s1">&#39;valueError&#39;</span>
<span class="n">CS_FIGUREOFMERIT</span> <span class="o">=</span> <span class="s1">&#39;figureOfMerit&#39;</span>
<span class="n">CS_NMRATOM</span> <span class="o">=</span> <span class="s1">&#39;nmrAtom&#39;</span>
<span class="n">CS_NMRRESIDUE</span> <span class="o">=</span> <span class="s1">&#39;nmrResidue&#39;</span>
<span class="n">CS_CHAINCODE</span> <span class="o">=</span> <span class="s1">&#39;chainCode&#39;</span>
<span class="n">CS_SEQUENCECODE</span> <span class="o">=</span> <span class="s1">&#39;sequenceCode&#39;</span>
<span class="n">CS_RESIDUETYPE</span> <span class="o">=</span> <span class="s1">&#39;residueType&#39;</span>
<span class="n">CS_ATOMNAME</span> <span class="o">=</span> <span class="s1">&#39;atomName&#39;</span>
<span class="n">CS_STATE</span> <span class="o">=</span> <span class="s1">&#39;state&#39;</span>
<span class="n">CS_STATIC</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
<span class="n">CS_DYNAMIC</span> <span class="o">=</span> <span class="s1">&#39;dynamic&#39;</span>
<span class="n">CS_ORPHAN</span> <span class="o">=</span> <span class="s1">&#39;orphan&#39;</span>
<span class="n">CS_SHIFTLISTPEAKS</span> <span class="o">=</span> <span class="s1">&#39;shiftListPeaks&#39;</span>
<span class="n">CS_ALLPEAKS</span> <span class="o">=</span> <span class="s1">&#39;allPeaks&#39;</span>
<span class="n">CS_SHIFTLISTPEAKSCOUNT</span> <span class="o">=</span> <span class="s1">&#39;shiftListPeaksCount&#39;</span>
<span class="n">CS_ALLPEAKSCOUNT</span> <span class="o">=</span> <span class="s1">&#39;allPeaksCount&#39;</span>
<span class="n">CS_COMMENT</span> <span class="o">=</span> <span class="s1">&#39;comment&#39;</span>
<span class="n">CS_ISDELETED</span> <span class="o">=</span> <span class="s1">&#39;isDeleted&#39;</span>
<span class="n">CS_OBJECT</span> <span class="o">=</span> <span class="s1">&#39;_object&#39;</span>  <span class="c1"># this must match the object search for guiTable</span>

<span class="n">CS_COLUMNS</span> <span class="o">=</span> <span class="p">(</span><span class="n">CS_UNIQUEID</span><span class="p">,</span> <span class="n">CS_ISDELETED</span><span class="p">,</span>
              <span class="n">CS_STATIC</span><span class="p">,</span>
              <span class="n">CS_VALUE</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="n">CS_FIGUREOFMERIT</span><span class="p">,</span>
              <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_SEQUENCECODE</span><span class="p">,</span> <span class="n">CS_RESIDUETYPE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span>
              <span class="n">CS_COMMENT</span><span class="p">)</span>
<span class="n">CS_TABLECOLUMNS</span> <span class="o">=</span> <span class="p">(</span><span class="n">CS_UNIQUEID</span><span class="p">,</span> <span class="n">CS_ISDELETED</span><span class="p">,</span> <span class="n">CS_PID</span><span class="p">,</span>
                   <span class="c1"># CS_STATIC,</span>
                   <span class="n">CS_VALUE</span><span class="p">,</span> <span class="n">CS_VALUEERROR</span><span class="p">,</span> <span class="n">CS_FIGUREOFMERIT</span><span class="p">,</span>
                   <span class="n">CS_NMRATOM</span><span class="p">,</span> <span class="n">CS_CHAINCODE</span><span class="p">,</span> <span class="n">CS_SEQUENCECODE</span><span class="p">,</span> <span class="n">CS_RESIDUETYPE</span><span class="p">,</span> <span class="n">CS_ATOMNAME</span><span class="p">,</span>
                   <span class="n">CS_STATE</span><span class="p">,</span> <span class="n">CS_ORPHAN</span><span class="p">,</span>
                   <span class="n">CS_ALLPEAKS</span><span class="p">,</span> <span class="n">CS_SHIFTLISTPEAKSCOUNT</span><span class="p">,</span> <span class="n">CS_ALLPEAKSCOUNT</span><span class="p">,</span>
                   <span class="n">CS_COMMENT</span><span class="p">,</span> <span class="n">CS_OBJECT</span><span class="p">)</span>

<span class="c1"># NOTE:ED - these currently match the original V3 classNames - not ChemShift</span>
<span class="c1">#   it is the name used in the dataframe and in project._getNextUniqueIdValue</span>
<span class="n">CS_CLASSNAME</span> <span class="o">=</span> <span class="s1">&#39;ChemicalShift&#39;</span>
<span class="n">CS_PLURALNAME</span> <span class="o">=</span> <span class="s1">&#39;chemicalShifts&#39;</span>


<div class="viewcode-block" id="ChemicalShiftState"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftState">[docs]</a><span class="k">class</span> <span class="nc">ChemicalShiftState</span><span class="p">(</span><span class="n">DataEnum</span><span class="p">):</span>
    <span class="n">STATIC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CS_STATIC</span>
    <span class="n">DYNAMIC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CS_DYNAMIC</span>
    <span class="n">ORPHAN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">CS_ORPHAN</span></div>


<span class="k">class</span> <span class="nc">_ChemicalShiftListFrame</span><span class="p">(</span><span class="n">DataFrameABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ChemicalShiftList data - as a Pandas DataFrame.</span>
<span class="sd">    CCPNInternal - only for access from ChemicalShiftList</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOT USED YET</span>
    <span class="c1"># Class added to wrap the model data in a core class</span>
    <span class="c1"># functionality can be moved from main class below to here at some point as required</span>
    <span class="c1"># - currently not using undo/redo ability of superclass</span>
    <span class="k">pass</span>


<span class="kn">from</span> <span class="nn">ccpn.core._implementation.Updater</span> <span class="kn">import</span> <span class="n">updateObject</span><span class="p">,</span> <span class="n">UPDATE_POST_OBJECT_INITIALISATION</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.updates.update_3_0_4</span> <span class="kn">import</span> <span class="n">_updateChemicalShiftList_3_0_4_to_3_1_0</span>


<div class="viewcode-block" id="ChemicalShiftList"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList">[docs]</a><span class="nd">@updateObject</span><span class="p">(</span><span class="s1">&#39;3.0.4&#39;</span><span class="p">,</span> <span class="s1">&#39;3.1.0&#39;</span><span class="p">,</span> <span class="n">_updateChemicalShiftList_3_0_4_to_3_1_0</span><span class="p">,</span> <span class="n">UPDATE_POST_OBJECT_INITIALISATION</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ChemicalShiftList</span><span class="p">(</span><span class="n">AbstractWrapperObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An object containing Chemical Shifts. Note: the object is not a (subtype of a) Python list.</span>
<span class="sd">    To access all ChemicalShift objects, use chemicalShiftList.chemicalShifts.</span>

<span class="sd">    A chemical shift list named &#39;default&#39; is used by default for new experiments,</span>
<span class="sd">    and is created if necessary.&quot;&quot;&quot;</span>

    <span class="c1">#: Short class name, for PID.</span>
    <span class="n">shortClassName</span> <span class="o">=</span> <span class="s1">&#39;CL&#39;</span>
    <span class="c1"># Attribute it necessary as subclasses must use superclass className</span>
    <span class="n">className</span> <span class="o">=</span> <span class="s1">&#39;ChemicalShiftList&#39;</span>

    <span class="n">_parentClass</span> <span class="o">=</span> <span class="n">Project</span>

    <span class="c1">#: Name of plural link to instances of class</span>
    <span class="n">_pluralLinkName</span> <span class="o">=</span> <span class="s1">&#39;chemicalShiftLists&#39;</span>

    <span class="c1"># the attribute name used by current</span>
    <span class="n">_currentAttributeName</span> <span class="o">=</span> <span class="s1">&#39;chemicalShiftLists&#39;</span>

    <span class="c1">#: List of child classes.</span>
    <span class="n">_childClasses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Qualified name of matching API class</span>
    <span class="n">_apiClassQualifiedName</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">ShiftList</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">wrappedData</span><span class="p">:</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">ShiftList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span> <span class="o">=</span> <span class="n">wrappedData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="n">defaultName</span> <span class="o">=</span> <span class="s1">&#39;Shifts</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">wrappedData</span><span class="o">.</span><span class="n">serial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setUniqueStringKey</span><span class="p">(</span><span class="n">defaultName</span><span class="p">)</span>

        <span class="c1"># internal lists to hold the current chemicalShifts and deletedChemicalShift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">wrappedData</span><span class="p">)</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN Properties</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_apiShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">ShiftList</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; CCPN ShiftList matching ChemicalShiftList&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;name, regularised as used for id&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">remapSeparators</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Shift list serial number&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">serial</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Project</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Parent (containing) object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;name of ChemicalShiftList. &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set name of ChemicalShiftList.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Measurement unit of ChemicalShiftList. Should always be &#39;ppm&#39;&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">unit</span>

    <span class="nd">@unit</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">autoUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Automatically update Chemical Shifts from assigned peaks - True/False&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">autoUpdate</span>

    <span class="nd">@autoUpdate</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">autoUpdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">autoUpdate</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isSimulated</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;True if the ChemicalShiftList is simulated.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isSimulated</span>

    <span class="nd">@isSimulated</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">isSimulated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isSimulated</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">static</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;True if the ChemicalShiftList is static.</span>
<span class="sd">        Overrides chemicalShift.static&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">static</span>

    <span class="nd">@static</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">static</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">static</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">autoChangeStatic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Prevent further queries&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">autoChangeStatic</span>

    <span class="nd">@autoChangeStatic</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">autoChangeStatic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">autoChangeStatic</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_recalculatePeakShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrResidues</span><span class="p">,</span> <span class="n">shifts</span><span class="p">):</span>
        <span class="c1"># update the assigned nmrAtom chemical shift values - notify the nmrResidues and chemicalShifts</span>
        <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">_static</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">spectra</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">_recalculateShiftValue</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nmr</span> <span class="ow">in</span> <span class="n">nmrResidues</span><span class="p">:</span>
            <span class="n">nmr</span><span class="o">.</span><span class="n">_finaliseAction</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">_finaliseAction</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Spectrum</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;ccpn.Spectra that use ChemicalShiftList to store chemical shifts&quot;&quot;&quot;</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">experiments</span>
                            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">dataSources</span><span class="p">))</span>

    <span class="nd">@spectra</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">spectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_spectra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Spectrum</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]):</span>
        <span class="sd">&quot;&quot;&quot;Set the list of spectra attached to the chemicalShiftList</span>
<span class="sd">        List must be iterable and of type Spectrum or str</span>
<span class="sd">        :param _spectra: Iterable or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_spectra</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_spectra</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.spectra must be an iterable of items of type Spectrum or str&#39;</span><span class="p">)</span>
            <span class="n">getByPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">getByPid</span>
            <span class="n">_spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">getByPid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_spectra</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">_spectra</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.spectra must be an iterable of items of type Spectrum or str&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_spectra</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># add a spectrum/remove a spectrum</span>
        <span class="n">_createSpectra</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_spectra</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span>
        <span class="n">_createCSL</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">spec</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">_createSpectra</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="kc">None</span><span class="p">}</span>
        <span class="n">_deleteSpectra</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">_spectra</span><span class="p">)</span>
        <span class="n">_createNmrAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getNmrAtomsFromSpectra</span><span class="p">(</span><span class="n">_createSpectra</span><span class="p">)</span>  <span class="c1"># new nmrAtoms to add</span>
        <span class="n">_deleteNmrAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getNmrAtomsFromSpectra</span><span class="p">(</span><span class="n">_deleteSpectra</span><span class="p">)</span>  <span class="c1"># old nmrAtoms to update</span>

        <span class="n">_thisNmrAtoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getNmrAtoms</span><span class="p">()</span>  <span class="c1"># current nmrAtoms referenced in shiftLift</span>

        <span class="c1"># nmrAtoms with peakCount = 0 -&gt; these are okay</span>
        <span class="n">_oldNmrAtoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nmr</span> <span class="k">for</span> <span class="n">nmr</span> <span class="ow">in</span> <span class="n">_thisNmrAtoms</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pk</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">nmr</span><span class="o">.</span><span class="n">assignedPeaks</span><span class="p">])</span>
        <span class="n">_newNmrAtoms</span> <span class="o">=</span> <span class="n">_createNmrAtoms</span> <span class="o">-</span> <span class="n">_thisNmrAtoms</span>  <span class="c1"># _oldNmrAtoms &lt;- this skips unassigned :|</span>

        <span class="n">_nmrAtoms</span> <span class="o">=</span> <span class="n">_createNmrAtoms</span> <span class="o">|</span> <span class="n">_deleteNmrAtoms</span> <span class="o">|</span> <span class="n">_oldNmrAtoms</span>  <span class="c1"># do I need to do all these?</span>
        <span class="n">nmrResidues</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nmr</span><span class="o">.</span><span class="n">nmrResidue</span> <span class="k">for</span> <span class="n">nmr</span> <span class="ow">in</span> <span class="n">_nmrAtoms</span><span class="p">)</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">cs</span> <span class="k">for</span> <span class="n">nmrAt</span> <span class="ow">in</span> <span class="n">_nmrAtoms</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">nmrAt</span><span class="o">.</span><span class="n">chemicalShifts</span> <span class="k">if</span> <span class="n">cs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cs</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
                <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recalculatePeakShifts</span><span class="p">,</span> <span class="n">nmrResidues</span><span class="p">,</span> <span class="n">shifts</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">experiments</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_spectra</span><span class="p">)</span>

            <span class="c1"># set the removed spectra to the default (first shiftList) in the project</span>
            <span class="n">firstCSL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">_deleteSpectra</span><span class="p">:</span>
                <span class="n">spec</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="o">=</span> <span class="n">firstCSL</span>

            <span class="c1"># update the chemicalShiftLists that are now empty</span>
            <span class="k">for</span> <span class="n">csl</span> <span class="ow">in</span> <span class="n">_createCSL</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">csl</span><span class="o">.</span><span class="n">spectra</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">csl</span><span class="o">.</span><span class="n">chemicalShifts</span><span class="p">:</span>
                        <span class="n">sh</span><span class="o">.</span><span class="n">_static</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">_newNmrAtoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">newChemicalShift</span><span class="p">(</span><span class="n">nmrAtom</span><span class="o">=</span><span class="n">nmrAtom</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_recalculatePeakShifts</span><span class="p">(</span><span class="n">nmrResidues</span><span class="p">,</span> <span class="n">shifts</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
                <span class="n">addUndoItem</span><span class="p">(</span><span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_recalculatePeakShifts</span><span class="p">,</span> <span class="n">nmrResidues</span><span class="p">,</span> <span class="n">shifts</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_getNmrAtomsFromSpectra</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of nmrAtoms in the supplied spectra</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_newNmr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nmrAtom</span>
                      <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">spectra</span>
                      <span class="k">for</span> <span class="n">pList</span> <span class="ow">in</span> <span class="n">spec</span><span class="o">.</span><span class="n">peakLists</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pList</span><span class="o">.</span><span class="n">isSimulated</span>
                      <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">pList</span><span class="o">.</span><span class="n">peaks</span>
                      <span class="k">for</span> <span class="n">aNmrAtoms</span> <span class="ow">in</span> <span class="n">pk</span><span class="o">.</span><span class="n">assignedNmrAtoms</span>
                      <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">aNmrAtoms</span>
                      <span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="kc">None</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">_newNmr</span>

    <span class="k">def</span> <span class="nf">_getNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of nmrAtoms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">_oldNmrAtoms</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_ISDELETED</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">][</span><span class="n">CS_NMRATOM</span><span class="p">]</span>
            <span class="n">_oldNmr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmr</span><span class="p">)</span> <span class="k">for</span> <span class="n">nmr</span> <span class="ow">in</span> <span class="n">_oldNmrAtoms</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="kc">None</span><span class="p">}</span>  <span class="c1"># remove any Nones</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># dataframe may not have been created yet</span>
            <span class="n">_oldNmr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_oldNmr</span>

    <span class="k">def</span> <span class="nf">_getNmrAtomPids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the list of nmrAtom pids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">_oldNmrAtoms</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_ISDELETED</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">][</span><span class="n">CS_NMRATOM</span><span class="p">]</span>
            <span class="n">_oldNmr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_oldNmrAtoms</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="kc">None</span><span class="p">}</span>  <span class="c1"># remove any Nones</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># dataframe may not have been created yet</span>
            <span class="n">_oldNmr</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_oldNmr</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_oldChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;STUB: hot-fixed later</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the shifts belonging to ChemicalShiftList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span>

<div class="viewcode-block" id="ChemicalShiftList.getChemicalShift"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.getChemicalShift">[docs]</a>    <span class="k">def</span> <span class="nf">getChemicalShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">_includeDeleted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a chemicalShift by nmrAtom or uniqueId</span>
<span class="sd">        Shift is returned as a namedTuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="n">uniqueId</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.getChemicalShift: use either nmrAtom or uniqueId&#39;</span><span class="p">)</span>

        <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
            <span class="c1"># get shift by nmrAtom</span>
            <span class="n">nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="p">(</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.getChemicalShift: nmrAtom must be of type NmrAtom or str&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
                <span class="c1"># search dataframe</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_NMRATOM</span><span class="p">]</span> <span class="o">==</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">uniqueId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get shift by uniqueId</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uniqueId</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.getChemicalShift: uniqueId must be an int&#39;</span><span class="p">)</span>

            <span class="c1"># search dataframe</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.getChemicalShift: bad number of shifts in list&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">uniqueId</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uniqueId</span>
                <span class="n">_shs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sh</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span> <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">_uniqueId</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_shs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_shs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">_includeDeleted</span><span class="p">:</span>
                        <span class="n">_shs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sh</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span> <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">_uniqueId</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">_shs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">_shs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">_shs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.getChemicalShift: shift not found&#39;</span><span class="p">)</span></div>

                <span class="c1"># # this is marginally quicker</span>
                <span class="c1"># _s, _e = 0, len(self._shifts) - 1</span>
                <span class="c1"># _sh = None</span>
                <span class="c1"># while _s &lt;= _e:</span>
                <span class="c1">#     _m = (_s + _e) // 2</span>
                <span class="c1">#     _sh = self._shifts[_m]</span>
                <span class="c1">#     if _sh._uniqueId == uniqueId:</span>
                <span class="c1">#         return _sh</span>
                <span class="c1">#     if _sh._uniqueId &gt; uniqueId:</span>
                <span class="c1">#         _e = _m - 1</span>
                <span class="c1">#     else:</span>
                <span class="c1">#         _s = _m + 1</span>
                <span class="c1">#</span>
                <span class="c1"># raise ValueError(f&#39;{self.className}.getChemicalShift: shift not found&#39;)</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># Implementation functions</span>
    <span class="c1">#=========================================================================================</span>

<div class="viewcode-block" id="ChemicalShiftList.duplicate"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.duplicate">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">includeSpectra</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoUpdate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param includeSpectra: move the spectra to the newly created ChemicalShiftList</span>
<span class="sd">        :param autoUpdate: automatically update according to the project changes.</span>
<span class="sd">        :return: a duplicated copy of itself containing all chemicalShifts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShift</span> <span class="kn">import</span> <span class="n">_newChemicalShift</span> <span class="k">as</span> <span class="n">_newShift</span>

        <span class="c1"># name = _incrementObjectName(self.project, self._pluralLinkName, self.name)</span>
        <span class="n">ncsl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">newChemicalShiftList</span><span class="p">()</span>

        <span class="c1"># duplicate the chemicalShiftList dataframe - remove the deleted shifts (not required)</span>
        <span class="c1"># will copy the correct type if changed to _ChemicalShiftListFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">CS_ISDELETED</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">ncsl</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">ncsl</span><span class="o">.</span><span class="n">static</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># make a new list of uniqueIds</span>
        <span class="n">_newIds</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_getNextUniqueIdValue</span><span class="p">(</span><span class="n">CS_CLASSNAME</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
        <span class="n">df</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]</span> <span class="o">=</span> <span class="n">_newIds</span>
        <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

        <span class="c1"># create the new shift objects</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)):</span>
            <span class="n">_row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

            <span class="c1"># create a new shift with the uniqueId from the dataframe</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="n">_newShift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="n">ncsl</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">_row</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]))</span>
            <span class="n">shift</span><span class="o">.</span><span class="n">_static</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">ncsl</span><span class="o">.</span><span class="n">_shifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>

            <span class="c1"># add the new object to the _pid2Obj dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_finalisePid2Obj</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">)</span>

            <span class="c1"># add the shift to the nmrAtom</span>
            <span class="n">shift</span><span class="o">.</span><span class="n">_updateNmrAtomShifts</span><span class="p">()</span>

        <span class="n">ncsl</span><span class="o">.</span><span class="n">autoUpdate</span> <span class="o">=</span> <span class="n">autoUpdate</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">,</span> <span class="s1">&#39;isSimulated&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">ncsl</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="c1"># setting the spectra will autoUpdate as required</span>
        <span class="n">ncsl</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span> <span class="k">if</span> <span class="n">includeSpectra</span> <span class="k">else</span> <span class="p">()</span></div>
        <span class="c1"># # old chemicalShifts</span>
        <span class="c1"># list(map(lambda cs: cs.copyTo(ncsl), self.chemicalShifts))</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_getAllWrappedData</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Project</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Nmr</span><span class="o">.</span><span class="n">ShiftList</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;get wrappedData (ShiftLists) for all ShiftList children of parent Project</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">_apiNmrProject</span><span class="o">.</span><span class="n">sortedMeasurementLists</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">className</span> <span class="o">==</span> <span class="s1">&#39;ShiftList&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="ChemicalShiftList.rename"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.rename">[docs]</a>    <span class="nd">@renameObject</span><span class="p">()</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename ChemicalShiftList, changing its name and Pid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rename</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getByUniqueId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the shift data from the dataFrame by the uniqueId</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">uniqueId</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._getByUniqueId: error getting row, uniqueId </span><span class="si">{</span><span class="n">uniqueId</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">  -  </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">attribType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the named attribute from the chemicalShift with supplied uniqueId</span>

<span class="sd">        Check the attribute for None, nan, inf, etc., and cast to attribType</span>
<span class="sd">        CCPN Internal - Pandas dataframe changes values after saving through api</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">uniqueId</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">_val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_val</span> <span class="o">!=</span> <span class="n">_val</span><span class="p">))</span> <span class="k">else</span> <span class="n">attribType</span><span class="p">(</span><span class="n">_val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._getAttribute: error getting attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">  -  </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the attribute of the chemicalShift with the supplied uniqueId</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">uniqueId</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._setAttribute: error setting attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">  -  </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">,</span> <span class="n">startName</span><span class="p">,</span> <span class="n">endName</span><span class="p">,</span> <span class="n">attribTypes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the named attributes from the chemicalShift with supplied uniqueId</span>

<span class="sd">        Check the attributes for None, nan, inf, etc., and cast to attribType</span>
<span class="sd">        CCPN Internal - Pandas dataframe changes values after saving through api</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">uniqueId</span><span class="p">,</span> <span class="n">startName</span><span class="p">:</span><span class="n">endName</span><span class="p">]</span>
            <span class="n">_val</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="n">val</span><span class="p">))</span> <span class="k">else</span> <span class="n">attribType</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">attribType</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">_val</span><span class="p">,</span> <span class="n">attribTypes</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_val</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._getAttributes: error getting attributes </span><span class="si">{</span><span class="n">startName</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">endName</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">  -  </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">,</span> <span class="n">startName</span><span class="p">,</span> <span class="n">endName</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the attributes of the chemicalShift with the supplied uniqueId</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">uniqueId</span><span class="p">,</span> <span class="n">startName</span><span class="p">:</span><span class="n">endName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">es</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._setAttributes: error setting attributes </span><span class="si">{</span><span class="n">startName</span><span class="si">}</span><span class="s1">|</span><span class="si">{</span><span class="n">endName</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">  -  </span><span class="si">{</span><span class="n">es</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_undoRedoShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shifts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update the shifts after undo/redo</span>
<span class="sd">        shifts should be a simple, non-nested dict of int:&lt;shift&gt; pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># keep the same shift list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">shifts</span>

    <span class="k">def</span> <span class="nf">_undoRedoDeletedShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deletedShifts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;update to deleted shifts after undo/redo</span>
<span class="sd">        deletedShifts should be a simple, non-nested dict of int:&lt;deletedShift&gt; pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># keep the same deleted shift list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">deletedShifts</span>

    <span class="k">def</span> <span class="nf">_setDeleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the deleted state of the shift</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shift</span><span class="o">.</span><span class="n">_deleted</span> <span class="o">=</span> <span class="n">state</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper method to get the stored dataframe</span>
<span class="sd">        CCPN Internal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">_searchChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uniqueId</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if the nmrAtom/uniqueId already exists in the chemicalShifts dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="n">uniqueId</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._searchChemicalShifts: use either nmrAtom or uniqueId&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
            <span class="c1"># get shift by nmrAtom</span>
            <span class="n">nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="n">NmrAtom</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._searchChemicalShifts: nmrAtom must be of type NmrAtom, str&#39;</span><span class="p">)</span>

            <span class="c1"># search dataframe for single element</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_NMRATOM</span><span class="p">]</span> <span class="o">==</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">uniqueId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get shift by uniqueId</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uniqueId</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">._searchChemicalShifts: uniqueId must be an int - </span><span class="si">{</span><span class="n">uniqueId</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># search dataframe for single element</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

<div class="viewcode-block" id="ChemicalShiftList.delete"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the chemicalShiftList and associated chemicalShifts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.delete: cannot delete the last chemicalShiftList&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
                <span class="n">_oldShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>
                <span class="n">_oldDeletedShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="p">[:]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>  <span class="c1"># not sorted - sort?</span>

                <span class="n">_newShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>
                <span class="n">_newDeletedShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="p">[:]</span>

                <span class="n">sh</span><span class="o">.</span><span class="n">_deleteWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_newDeletedShifts</span><span class="p">,</span> <span class="n">_newShifts</span><span class="p">,</span> <span class="n">_oldDeletedShifts</span><span class="p">,</span> <span class="n">_oldShifts</span><span class="p">)</span>

            <span class="c1"># remember the old spectra for after the actual delete</span>
            <span class="n">_deleteSpectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra</span>

            <span class="c1"># delete the chemicalShiftList</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">()</span>

            <span class="c1"># set the removed spectra to the default (first shiftList) in the project</span>
            <span class="n">firstCSL</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">chemicalShiftLists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">_deleteSpectra</span><span class="p">:</span>
                <span class="n">spec</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="o">=</span> <span class="n">firstCSL</span></div>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN functions</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_restoreObject</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">apiObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subclassed to allow for initialisations on restore, not on creation via newChemicalShiftList</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShift</span> <span class="kn">import</span> <span class="n">_newChemicalShift</span> <span class="k">as</span> <span class="n">_newShift</span>

        <span class="n">chemicalShiftList</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_restoreObject</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">apiObj</span><span class="p">)</span>

        <span class="c1"># create a set of new shift objects linked to the pandas rows - discard deleted</span>
        <span class="n">_data</span> <span class="o">=</span> <span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check that is the new DataFrameABC class, update as required - for later use</span>
            <span class="c1"># if not isinstance(_data, DataFrameABC):</span>
            <span class="c1">#     getLogger().debug(f&#39;updating classType {chemicalShiftList} -&gt; _ChemicalShiftListFrame&#39;)</span>
            <span class="c1">#     _data = _ChemicalShiftListFrame(_data)</span>

            <span class="c1"># remove the deleted shifts, not needed after restore</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_ISDELETED</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CS_STATIC</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="c1"># add new static column if not defined</span>
                <span class="n">_data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">CS_COLUMNS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">CS_STATIC</span><span class="p">),</span> <span class="n">CS_STATIC</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>  <span class="c1"># drop=False)</span>

            <span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_data</span>

            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_data</span><span class="p">)):</span>
                <span class="n">_row</span> <span class="o">=</span> <span class="n">_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

                <span class="c1"># create a new shift with the uniqueId from the old shift</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">_newShift</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">_row</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]))</span>
                <span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_shifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>

                <span class="c1"># add the new object to the _pid2Obj dict</span>
                <span class="n">project</span><span class="o">.</span><span class="n">_finalisePid2Obj</span><span class="p">(</span><span class="n">shift</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">)</span>

                <span class="c1"># restore the nmrAtom, etc., for the new shift</span>
                <span class="n">shift</span><span class="o">.</span><span class="n">_updateNmrAtomShifts</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">chemicalShiftList</span><span class="o">.</span><span class="n">_shifts</span><span class="p">:</span>
                <span class="c1"># ensure that all shifts have the correct value/valueError when first loaded</span>
                <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sh</span><span class="o">.</span><span class="n">_recalculateShiftValue</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">chemicalShiftList</span>

    <span class="c1">#===========================================================================================</span>
    <span class="c1"># new&lt;Object&gt; and other methods</span>
    <span class="c1"># Call appropriate routines in their respective locations</span>
    <span class="c1">#===========================================================================================</span>

<div class="viewcode-block" id="ChemicalShiftList.newChemicalShift"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.newChemicalShift">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">newChemicalShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">valueError</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                         <span class="n">static</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">nmrAtom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Pid</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">chainCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">residueType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">atomName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
                         <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new ChemicalShift within ChemicalShiftList.</span>

<span class="sd">        An nmrAtom can be attached to the shift as required.</span>
<span class="sd">        nmrAtom can be core object, Pid or pid string</span>
<span class="sd">        If attached (chainCode, sequenceCode, residueType, atomName) will be derived from the nmrAtom.pid</span>
<span class="sd">        If nmrAtom is not specified, (chainCode, sequenceCode, residueType, atomName) can be set as string values.</span>
<span class="sd">        A chemicalShift is not static by default (dynamic), i.e., its value will update when there are changes to the assigned peaks.</span>

<span class="sd">        See the ChemicalShift class for details.</span>

<span class="sd">        :param value: float shift value</span>
<span class="sd">        :param valueError: float</span>
<span class="sd">        :param figureOfMerit: float, default = 1.0</span>
<span class="sd">        :param static: bool, default = False</span>
<span class="sd">        :param nmrAtom: nmrAtom as object or pid, or None if not required</span>
<span class="sd">        :param chainCode:</span>
<span class="sd">        :param sequenceCode:</span>
<span class="sd">        :param residueType:</span>
<span class="sd">        :param atomName:</span>
<span class="sd">        :param comment: optional comment string</span>
<span class="sd">        :return: a new ChemicalShift tuple.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span>
            <span class="k">if</span> <span class="n">_nmrAtom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.newChemicalShift: nmrAtom </span><span class="si">{</span><span class="n">_nmrAtom</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>
            <span class="n">nmrAtom</span> <span class="o">=</span> <span class="n">_nmrAtom</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">CS_NMRATOM</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.newChemicalShift: nmrAtom </span><span class="si">{</span><span class="n">nmrAtom</span><span class="si">}</span><span class="s1"> already exists&#39;</span><span class="p">)</span>

        <span class="n">shift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_newChemicalShiftObject</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                                             <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">valueError</span><span class="o">=</span><span class="n">valueError</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="o">=</span><span class="n">figureOfMerit</span><span class="p">,</span>
                                             <span class="n">static</span><span class="o">=</span><span class="n">static</span><span class="p">,</span>
                                             <span class="n">nmrAtom</span><span class="o">=</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="n">chainCode</span><span class="o">=</span><span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="o">=</span><span class="n">sequenceCode</span><span class="p">,</span>
                                             <span class="n">residueType</span><span class="o">=</span><span class="n">residueType</span><span class="p">,</span> <span class="n">atomName</span><span class="o">=</span><span class="n">atomName</span><span class="p">,</span>
                                             <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shift</span></div>

    <span class="nd">@newV3Object</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_newChemicalShiftObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">valueError</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="p">,</span> <span class="n">static</span><span class="p">,</span>
                                <span class="n">nmrAtom</span><span class="p">,</span> <span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">atomName</span><span class="p">,</span> <span class="n">comment</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new pure V3 ChemicalShift object</span>
<span class="sd">        Method is wrapped with create/delete notifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.ChemicalShift</span> <span class="kn">import</span> <span class="n">_getByTuple</span><span class="p">,</span> <span class="n">_newChemicalShift</span> <span class="k">as</span> <span class="n">_newShift</span>

        <span class="c1"># make new tuple - verifies contents</span>
        <span class="n">_nextUniqueId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_getNextUniqueIdValue</span><span class="p">(</span><span class="n">CS_CLASSNAME</span><span class="p">)</span>
        <span class="n">_row</span> <span class="o">=</span> <span class="n">_getByTuple</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">uniqueId</span><span class="o">=</span><span class="n">_nextUniqueId</span><span class="p">,</span>
                           <span class="n">isDeleted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                           <span class="n">static</span><span class="o">=</span><span class="n">static</span><span class="p">,</span>
                           <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">valueError</span><span class="o">=</span><span class="n">valueError</span><span class="p">,</span> <span class="n">figureOfMerit</span><span class="o">=</span><span class="n">figureOfMerit</span><span class="p">,</span>
                           <span class="n">nmrAtom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># MUST be None here and set later</span>
                           <span class="n">chainCode</span><span class="o">=</span><span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="o">=</span><span class="n">sequenceCode</span><span class="p">,</span>
                           <span class="n">residueType</span><span class="o">=</span><span class="n">residueType</span><span class="p">,</span> <span class="n">atomName</span><span class="o">=</span><span class="n">atomName</span><span class="p">,</span>
                           <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
        <span class="c1"># add to dataframe - this is in undo stack and marked as modified</span>
        <span class="c1"># Note the &quot;additional&quot; tuple around _row; needed to match the shape as one row, 12 columns</span>
        <span class="n">_dfRow</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">_row</span><span class="p">,),</span> <span class="n">columns</span><span class="o">=</span><span class="n">CS_COLUMNS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># set as the new subclassed DataFrameABC</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">_dfRow</span>  <span class="c1"># _ChemicalShiftListFrame(_dfRow)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># not particularly fast, but no alternative for now</span>
            <span class="c1"># _data = self._wrappedData.data = self._wrappedData.data.append(_dfRow)  # deprecated</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">_dfRow</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

        <span class="c1"># create new shift object</span>
        <span class="c1"># new Shift only needs chemicalShiftList and uniqueId - properties are linked to dataframe</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="n">_newShift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_uniqueId</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">_nextUniqueId</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
            <span class="c1"># None above should ensure recalculation of shift values from assignments</span>
            <span class="n">shift</span><span class="o">.</span><span class="n">nmrAtom</span> <span class="o">=</span> <span class="n">nmrAtom</span>

        <span class="n">_oldShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">shift</span><span class="p">)</span>
        <span class="n">_newShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>

        <span class="k">with</span> <span class="n">undoBlockWithoutSideBar</span><span class="p">():</span>
            <span class="c1"># add an undo/redo item to recover shifts</span>
            <span class="k">with</span> <span class="n">undoStackBlocking</span><span class="p">()</span> <span class="k">as</span> <span class="n">addUndoItem</span><span class="p">:</span>
                <span class="n">addUndoItem</span><span class="p">(</span><span class="n">undo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_undoRedoShifts</span><span class="p">,</span> <span class="n">_oldShifts</span><span class="p">),</span>
                            <span class="n">redo</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_undoRedoShifts</span><span class="p">,</span> <span class="n">_newShifts</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">shift</span>

<div class="viewcode-block" id="ChemicalShiftList.deleteChemicalShift"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.ChemicalShiftList.ChemicalShiftList.deleteChemicalShift">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">deleteChemicalShift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">NmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">uniqueId</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete a chemicalShift by nmrAtom or uniqueId</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nmrAtom</span> <span class="ow">and</span> <span class="n">uniqueId</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: use either nmrAtom or uniqueId&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">nmrAtom</span><span class="p">:</span>
            <span class="c1"># get shift by nmrAtom</span>
            <span class="n">nmrAtom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="n">NmrAtom</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: nmrAtom must be of type NmrAtom, str&#39;</span><span class="p">)</span>

            <span class="c1"># search dataframe for single element</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_NMRATOM</span><span class="p">]</span> <span class="o">==</span> <span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: bad number of shifts in list&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: nmrAtom </span><span class="si">{</span><span class="n">nmrAtom</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">uniqueId</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get shift by uniqueId</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uniqueId</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: uniqueId must be an int&#39;</span><span class="p">)</span>

            <span class="c1"># search dataframe for single element</span>
            <span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">data</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">_data</span><span class="p">[</span><span class="n">_data</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">]</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: bad number of shifts in list&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: uniqueId </span><span class="si">{</span><span class="n">uniqueId</span><span class="si">}</span><span class="s1"> not found&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">uniqueId</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uniqueId</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_shs</span> <span class="o">:=</span> <span class="p">[</span><span class="n">sh</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span> <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">_uniqueId</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]):</span>
            <span class="c1"># raise an error if there are any assigned peaks</span>
            <span class="n">_val</span> <span class="o">=</span> <span class="n">_shs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">_val</span><span class="o">.</span><span class="n">assignedPeaks</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">className</span><span class="si">}</span><span class="s1">.deleteChemicalShift: cannot delete chemicalShift with assigned peaks&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_deleteChemicalShiftObject</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_deleteChemicalShiftObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the dataframe and handle notifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_oldShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>
        <span class="n">_oldDeletedShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="p">[:]</span>

        <span class="n">uniqueId</span> <span class="o">=</span> <span class="n">rows</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">uniqueId</span>
        <span class="n">_shs</span> <span class="o">=</span> <span class="p">[</span><span class="n">sh</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span> <span class="k">if</span> <span class="n">sh</span><span class="o">.</span><span class="n">_uniqueId</span> <span class="o">==</span> <span class="n">uniqueId</span><span class="p">]</span>
        <span class="n">_val</span> <span class="o">=</span> <span class="n">_shs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">_val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_val</span><span class="p">)</span>  <span class="c1"># not sorted - sort?</span>

        <span class="n">_newShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shifts</span><span class="p">[:]</span>
        <span class="n">_newDeletedShifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deletedShifts</span><span class="p">[:]</span>

        <span class="n">_val</span><span class="o">.</span><span class="n">_deleteWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_newDeletedShifts</span><span class="p">,</span> <span class="n">_newShifts</span><span class="p">,</span> <span class="n">_oldDeletedShifts</span><span class="p">,</span> <span class="n">_oldShifts</span><span class="p">)</span></div>


<span class="c1">#=========================================================================================</span>
<span class="c1"># Connections to parents:</span>
<span class="c1">#=========================================================================================</span>

<span class="k">def</span> <span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Spectrum</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChemicalShiftList</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the chemicalShiftList for the spectrum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_apiDataSource</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span><span class="n">shiftList</span><span class="p">)</span>


<span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chemicalShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Spectrum</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">:</span> <span class="n">ChemicalShiftList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the chemicalShiftList for the spectrum</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_shiftList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chemicalShiftList</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">chemicalShiftList</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_shiftList</span><span class="p">,</span> <span class="n">ChemicalShiftList</span><span class="p">):</span>
        <span class="c1"># add the spectrum to the chemicalShiftList - undo handled in .spectra setter</span>
        <span class="n">_shiftList</span><span class="o">.</span><span class="n">spectra</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_shiftList</span><span class="o">.</span><span class="n">spectra</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span><span class="bp">self</span><span class="p">}</span>

    <span class="k">elif</span> <span class="n">_shiftList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># # set the chemicalShiftList to None - undo handled in .spectra setter</span>
        <span class="c1"># _shiftList = self.chemicalShiftList</span>
        <span class="c1"># if _shiftList:</span>
        <span class="c1">#     _shiftList.spectra = set(_shiftList.spectra) - {self}</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">.chemicalShiftList: cannot set to None&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Don&#39;t raise errors here or you crash-out a perfectly valid project/Nef from loading</span>
        <span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>

        <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not set chemicalShiftList for Spectrum </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">. Invalid ChemicalShiftList.&#39;</span><span class="p">)</span>


<span class="n">Spectrum</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                      <span class="s2">&quot;ccpn.ChemicalShiftList used for ccpn.Spectrum&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">chemicalShiftList</span>


<span class="k">def</span> <span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">PeakList</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ChemicalShiftList</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return the chemicalShiftList for the peak</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shiftList</span><span class="p">)</span>


<span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="n">isProperty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">chemicalShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">PeakList</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ChemicalShiftList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Set the chemicalShiftList for the peak</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_apiPeakList</span><span class="o">.</span><span class="n">shiftList</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">_apiShiftList</span>


<span class="n">PeakList</span><span class="o">.</span><span class="n">chemicalShiftList</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">getter</span><span class="p">,</span> <span class="n">chemicalShiftList</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                                      <span class="s2">&quot;ChemicalShiftList associated with PeakList.&quot;</span><span class="p">)</span>
<span class="k">del</span> <span class="n">getter</span>
<span class="k">del</span> <span class="n">chemicalShiftList</span>


<span class="c1">#=========================================================================================</span>

<span class="nd">@newObject</span><span class="p">(</span><span class="n">ChemicalShiftList</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_newChemicalShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ppm&#39;</span><span class="p">,</span> <span class="n">autoUpdate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">isSimulated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">spectra</span><span class="o">=</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">ChemicalShiftList</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create new ChemicalShiftList.</span>

<span class="sd">    See the ChemicalShiftList class for details.</span>

<span class="sd">    :param name: name for the new chemicalShiftList</span>
<span class="sd">    :param unit: unit type as str, e.g. &#39;ppm&#39;</span>
<span class="sd">    :param autoUpdate: True/False - automatically update chemicalShifts when assignments change</span>
<span class="sd">    :param isSimulated: True/False</span>
<span class="sd">    :param comment: optional user comment</span>
<span class="sd">    :return: a new ChemicalShiftList instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">ChemicalShiftList</span><span class="o">.</span><span class="n">_uniqueName</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># set up call parameters for new api-object</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span>   <span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;autoUpdate&#39;</span><span class="p">:</span> <span class="n">autoUpdate</span><span class="p">,</span> <span class="s1">&#39;isSimulated&#39;</span><span class="p">:</span> <span class="n">isSimulated</span><span class="p">,</span>
          <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">comment</span><span class="p">}</span>

    <span class="n">apiChemicalShiftList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">newShiftList</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apiChemicalShiftList</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to generate new ChemicalShiftList item&#39;</span><span class="p">)</span>

    <span class="c1"># instantiate a new empty dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">CS_COLUMNS</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">CS_UNIQUEID</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="p">)</span>

    <span class="c1"># set as the new subclassed DataFrameABC</span>
    <span class="n">apiChemicalShiftList</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">df</span>  <span class="c1"># _ChemicalShiftListFrame(df)</span>

    <span class="c1"># if spectra:</span>
    <span class="c1">#     # add the spectra to the new chemicalShiftList - moved outside newObject for now</span>
    <span class="c1">#     getByPid = self._project.getByPid</span>
    <span class="c1">#     if (spectra := list(filter(lambda sp: isinstance(sp, Spectrum),</span>
    <span class="c1">#                                map(lambda sp: getByPid(sp) if isinstance(sp, str) else sp, spectra)))):</span>
    <span class="c1">#         # add/transfer the spectra</span>
    <span class="c1">#         result.spectra = spectra</span>
    <span class="c1">#         # dd.update({&#39;experiments&#39;: OrderedSet([spec._wrappedData.experiment for spec in spectra])})</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_getChemicalShiftList</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ppm&#39;</span><span class="p">,</span> <span class="n">autoUpdate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                          <span class="n">isSimulated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">spectra</span><span class="o">=</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="n">ChemicalShiftList</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create new ChemicalShiftList.</span>

<span class="sd">    See the ChemicalShiftList class for details.</span>

<span class="sd">    :param name:</span>
<span class="sd">    :param unit:</span>
<span class="sd">    :param autoUpdate:</span>
<span class="sd">    :param isSimulated:</span>
<span class="sd">    :param comment:</span>
<span class="sd">    :return: a new ChemicalShiftList instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
        <span class="n">getByPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">getByPid</span>
        <span class="n">spectra</span> <span class="o">=</span> <span class="p">[</span><span class="n">getByPid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">]</span>

    <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span>   <span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span> <span class="s1">&#39;autoUpdate&#39;</span><span class="p">:</span> <span class="n">autoUpdate</span><span class="p">,</span> <span class="s1">&#39;isSimulated&#39;</span><span class="p">:</span> <span class="n">isSimulated</span><span class="p">,</span>
          <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">comment</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">spectra</span><span class="p">:</span>
        <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;experiments&#39;</span><span class="p">:</span> <span class="n">OrderedSet</span><span class="p">([</span><span class="n">spec</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">experiment</span> <span class="k">for</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">])})</span>

    <span class="n">apiChemicalShiftList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">getShiftList</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">apiChemicalShiftList</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="c1"># Notifiers</span>
<span class="n">className</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">ShiftList</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
<span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">(</span>  <span class="c1"># (&#39;_finaliseApiRename&#39;, {}, className, &#39;setName&#39;),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;addExperiment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span>
             <span class="s1">&#39;removeExperiment&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;setExperiments&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;addPeakList&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;removePeakList&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;setPeakLists&#39;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
<span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">)},</span>
                              <span class="n">Nmr</span><span class="o">.</span><span class="n">PeakList</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">(),</span> <span class="s1">&#39;setSpecificShiftList&#39;</span><span class="p">)</span>
                             <span class="p">)</span>
<span class="n">className</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">Experiment</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
<span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">((</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;Spectrum&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;setShiftList&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;ChemicalShiftList&#39;</span><span class="p">,</span> <span class="s1">&#39;PeakList&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;setShiftList&#39;</span><span class="p">),</span>
         <span class="p">)</span>
        <span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.ChemicalShiftList</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>