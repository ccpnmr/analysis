
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ccpn.core.NmrAtom &#8212; Python  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/classic.css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.NmrAtom</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpn.core.NmrAtom</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (https://www.ccpn.ac.uk) 2014 - 2022&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Ed Brooksbank, Joanna Fox, Victoria A Higman, Luca Mureddu, Eliza Płoskoń&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Timothy J Ragan, Brian O Smith, Gary S Thompson &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See https://ccpn.ac.uk/software/licensing/&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Skinner, S.P., Fogh, R.H., Boucher, W., Ragan, T.J., Mureddu, L.G., &amp; Vuister, G.W.&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;CcpNmr AnalysisAssign: a flexible platform for integrated NMR analysis&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;J.Biomol.Nmr (2016), 66, 111-124, http://doi.org/10.1007/s10858-016-0060-y&quot;</span><span class="p">)</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: Ed Brooksbank $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2022-07-05 13:20:37 +0100 (Tue, July 05, 2022) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.1.0 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:41 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">ccpn.core.NmrResidue</span> <span class="kn">import</span> <span class="n">NmrResidue</span>
<span class="kn">from</span> <span class="nn">ccpn.core.Project</span> <span class="kn">import</span> <span class="n">Project</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.AbstractWrapperObject</span> <span class="kn">import</span> <span class="n">AbstractWrapperObject</span>
<span class="kn">from</span> <span class="nn">ccpn.core._implementation.AbsorbResonance</span> <span class="kn">import</span> <span class="n">absorbResonance</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib</span> <span class="kn">import</span> <span class="n">Pid</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.Util</span> <span class="kn">import</span> <span class="n">AtomIdTuple</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.api.ccp.nmr</span> <span class="kn">import</span> <span class="n">Nmr</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.lib</span> <span class="kn">import</span> <span class="n">Constants</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Common</span> <span class="kn">import</span> <span class="n">makeIterableList</span>
<span class="kn">from</span> <span class="nn">ccpn.util.decorators</span> <span class="kn">import</span> <span class="n">logCommand</span>
<span class="kn">from</span> <span class="nn">ccpn.util.isotopes</span> <span class="kn">import</span> <span class="n">isotopeCode2Nucleus</span><span class="p">,</span> <span class="n">getIsotopeRecords</span>
<span class="kn">from</span> <span class="nn">ccpn.core.lib.ContextManagers</span> <span class="kn">import</span> <span class="n">newObject</span><span class="p">,</span> <span class="n">renameObject</span><span class="p">,</span> <span class="n">undoBlock</span><span class="p">,</span> <span class="n">ccpNmrV3CoreSetter</span>
<span class="kn">from</span> <span class="nn">ccpn.util.Logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">UnknownIsotopeCode</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>


<div class="viewcode-block" id="NmrAtom"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom">[docs]</a><span class="k">class</span> <span class="nc">NmrAtom</span><span class="p">(</span><span class="n">AbstractWrapperObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;NmrAtom objects are used for assignment. An NmrAtom within an assigned NmrResidue is</span>
<span class="sd">    by definition assigned to the Atom with the same name (if any).</span>

<span class="sd">    NmrAtoms serve as a way of connecting a named nucleus to an observed chemical shift,</span>
<span class="sd">    and peaks are assigned to NmrAtoms. Renaming an NmrAtom (or its containing NmrResidue or</span>
<span class="sd">    NmrChain) automatically updates peak assignments and ChemicalShifts that use the NmrAtom,</span>
<span class="sd">    preserving the link.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#: Short class name, for PID.</span>
    <span class="n">shortClassName</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
    <span class="c1"># Attribute it necessary as subclasses must use superclass className</span>
    <span class="n">className</span> <span class="o">=</span> <span class="s1">&#39;NmrAtom&#39;</span>

    <span class="n">_parentClass</span> <span class="o">=</span> <span class="n">NmrResidue</span>

    <span class="c1">#: Name of plural link to instances of class</span>
    <span class="n">_pluralLinkName</span> <span class="o">=</span> <span class="s1">&#39;nmrAtoms&#39;</span>

    <span class="c1"># the attribute name used by current</span>
    <span class="n">_currentAttributeName</span> <span class="o">=</span> <span class="s1">&#39;nmrAtoms&#39;</span>

    <span class="c1">#: List of child classes.</span>
    <span class="n">_childClasses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Qualified name of matching API class</span>
    <span class="n">_apiClassQualifiedName</span> <span class="o">=</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">Resonance</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>

    <span class="c1"># Internal NameSpace</span>
    <span class="n">_AMBIGUITYCODE</span> <span class="o">=</span> <span class="s1">&#39;_ambiguityCode&#39;</span>
    <span class="n">_ORIGINALNAME</span> <span class="o">=</span> <span class="s1">&#39;_originalName&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">wrappedData</span><span class="p">):</span>

        <span class="c1"># internal lists to hold the current chemicalShifts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chemicalShifts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">wrappedData</span><span class="p">)</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN properties</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_apiResonance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">Resonance</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; CCPN atom matching Atom&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NmrResidue</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Parent (containing) object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">resonanceGroup</span><span class="p">)</span>

    <span class="n">nmrResidue</span> <span class="o">=</span> <span class="n">_parent</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Atom name string (e.g. &#39;HA&#39;) regularised as used for ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">remapSeparators</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_nextKey</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the next available key from _serialDict</span>
<span class="sd">        Limited functionality but helps to get potential Pid of the next _wrapped object</span>
<span class="sd">        In this case Pid element is of the form &#39;@_&lt;num&gt;&#39; but subject to change&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.framework.Application</span> <span class="kn">import</span> <span class="n">getApplication</span>

        <span class="n">_project</span> <span class="o">=</span> <span class="n">getApplication</span><span class="p">()</span><span class="o">.</span><span class="n">project</span>

        <span class="n">_metaName</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_apiClassQualifiedName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">_metaName</span> <span class="o">=</span> <span class="n">_metaName</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="n">_metaName</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;@_</span><span class="si">{</span><span class="n">_project</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">topObject</span><span class="o">.</span><span class="n">_serialDict</span><span class="p">[</span><span class="n">_metaName</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">return</span> <span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_localCcpnSortKey</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Local sorting key, in context of parent.&quot;&quot;&quot;</span>

        <span class="c1"># We want sorting by name, even though Resonances have serials</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_idTuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AtomIdTuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;ID as chainCode, sequenceCode, residueType, atomName namedtuple</span>
<span class="sd">        NB Unlike the _id and key, these do NOT have reserved characters mapped to &#39;^&#39;</span>
<span class="sd">        NB _idTuple replaces empty strings with None&quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">shortName</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">sequenceCode</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">residueType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">AtomIdTuple</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Atom name string (e.g. &#39;HA&#39;)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set Atom name&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">serial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;NmrAtom serial number - set at creation and unchangeable&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">serial</span>

    <span class="c1">#from ccpn.core.Atom import Atom: This will break the import sequence</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Atom&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Atom to which NmrAtom is assigned. NB resetting the atom will rename the NmrAtom&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">getAtom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isotopeCode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;isotopeCode of NmrAtom. Used to facilitate the nmrAtom assignment.&quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isotopeCode</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="n">UnknownIsotopeCode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNKNOWN_VALUE_STRING</span><span class="p">]:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_setIsotopeCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param value:  value must be defined, if not set then can set to arbitrary value see UnknownIsotopeCode definition</span>
<span class="sd">        this means it can still be set at any isotopeCode later, otherwise</span>
<span class="sd">        need to undo or create new nmrAtom</span>

<span class="sd">        CCPNINTERNAL: used in _newNmrAtom, Peak.assignDimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;isotopeCode must be of type string (or None); got </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">getIsotopeRecords</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">+</span><span class="p">[</span><span class="n">UnknownIsotopeCode</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid isotopeCode </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isotopeCode</span> <span class="o">=</span> <span class="n">value</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="n">UnknownIsotopeCode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boundNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NmrAtom&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;NmrAtoms directly bound to this one, as calculated from assignment and</span>
<span class="sd">        NmrAtom name matches (NOT from peak assignment)&quot;&quot;&quot;</span>
        <span class="n">getDataObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">getBoundResonances</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">getDataObj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>

        <span class="n">nmrResidue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrResidue</span>
        <span class="k">if</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">residue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># NmrResidue is unassigned. Add ad-hoc protein interresidue bonds</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="p">(</span><span class="n">nmrResidue</span><span class="o">.</span><span class="n">previousNmrResidue</span><span class="p">,</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">getOffsetNmrResidue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">rx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">na</span> <span class="o">=</span> <span class="n">rx</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">na</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">na</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rx</span> <span class="ow">in</span> <span class="p">(</span><span class="n">nmrResidue</span><span class="o">.</span><span class="n">nextNmrResidue</span><span class="p">,</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">getOffsetNmrResidue</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">rx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">na</span> <span class="o">=</span> <span class="n">rx</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">na</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">na</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">assignedPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s1">&#39;Peak&#39;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;All Peaks assigned to the NmrAtom&quot;&quot;&quot;</span>
        <span class="n">apiResonance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
        <span class="n">apiPeaks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">peakDim</span><span class="o">.</span><span class="n">peak</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">apiResonance</span><span class="o">.</span><span class="n">peakDimContribs</span><span class="p">]</span>
        <span class="n">apiPeaks</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">peakDim</span><span class="o">.</span><span class="n">peak</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">apiResonance</span><span class="o">.</span><span class="n">peakDimContribNs</span><span class="p">]</span>

        <span class="n">data2Obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">data2Obj</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">apiPeaks</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ambiguityCode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the ambiguityCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInternalParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AMBIGUITYCODE</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@_ambiguityCode</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_ambiguityCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the ambiguityCode</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setInternalParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_AMBIGUITYCODE</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_originalName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the originalName</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getInternalParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ORIGINALNAME</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@_originalName</span><span class="o">.</span><span class="n">setter</span>
    <span class="nd">@ccpNmrV3CoreSetter</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_originalName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the originalName</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setInternalParameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ORIGINALNAME</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="NmrAtom.deassign"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom.deassign">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">deassign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset NmrAtom back to its originalName, cutting all assignment links&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="NmrAtom.assignTo"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom.assignTo">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">assignTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">residueType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mergeToExisting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;NmrAtom&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Assign NmrAtom to naming parameters) and return the reassigned result</span>

<span class="sd">        If the assignedTo NmrAtom already exists the function raises ValueError.</span>
<span class="sd">        If mergeToExisting is True it instead merges the current NmrAtom into the target</span>
<span class="sd">        and returns the merged target. NB Merging is NOT undoable</span>

<span class="sd">        WARNING: is mergeToExisting is True, always use in the form &quot;x = x.assignTo(...)&quot;,</span>
<span class="sd">        as the call &#39;x.assignTo(...) may cause the source x object to be deleted.</span>

<span class="sd">        Passing in empty parameters (e.g. chainCode=None) leaves the current value unchanged. E.g.:</span>
<span class="sd">        for NmrAtom NR:A.121.ALA.HA calling with sequenceCode=124 will assign to</span>
<span class="sd">        (chainCode=&#39;A&#39;, sequenceCode=124, residueType=&#39;ALA&#39;, atomName=&#39;HA&#39;)</span>


<span class="sd">        The function works as:</span>

<span class="sd">        nmrChain = project.fetchNmrChain(shortName=chainCode)</span>

<span class="sd">        nmrResidue = nmrChain.fetchNmrResidue(sequenceCode=sequenceCode, residueType=residueType)</span>

<span class="sd">        (or nmrChain.fetchNmrResidue(sequenceCode=sequenceCode) if residueType is None)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">oldPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">longPid</span>
        <span class="n">apiResonance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apiResonance</span>
        <span class="n">apiResonanceGroup</span> <span class="o">=</span> <span class="n">apiResonance</span><span class="o">.</span><span class="n">resonanceGroup</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">sequenceCode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sequenceCode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sequenceCode</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>

            <span class="c1"># set missing parameters to existing values</span>
            <span class="n">chainCode</span> <span class="o">=</span> <span class="n">chainCode</span> <span class="ow">or</span> <span class="n">apiResonanceGroup</span><span class="o">.</span><span class="n">nmrChain</span><span class="o">.</span><span class="n">code</span>
            <span class="n">sequenceCode</span> <span class="o">=</span> <span class="n">sequenceCode</span> <span class="ow">or</span> <span class="n">apiResonanceGroup</span><span class="o">.</span><span class="n">sequenceCode</span>
            <span class="n">residueType</span> <span class="o">=</span> <span class="n">residueType</span> <span class="ow">or</span> <span class="n">apiResonanceGroup</span><span class="o">.</span><span class="n">residueType</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">apiResonance</span><span class="o">.</span><span class="n">name</span>

            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ss</span> <span class="ow">and</span> <span class="n">Pid</span><span class="o">.</span><span class="n">altCharacter</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Character </span><span class="si">%s</span><span class="s2"> not allowed in ccpn.NmrAtom id : </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span>
                                     <span class="o">%</span> <span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">altCharacter</span><span class="p">,</span> <span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>


            <span class="n">oldNmrResidue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrResidue</span>
            <span class="n">nmrChain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">fetchNmrChain</span><span class="p">(</span><span class="n">chainCode</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">residueType</span><span class="p">:</span>
                <span class="n">nmrResidue</span> <span class="o">=</span> <span class="n">nmrChain</span><span class="o">.</span><span class="n">fetchNmrResidue</span><span class="p">(</span><span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nmrResidue</span> <span class="o">=</span> <span class="n">nmrChain</span><span class="o">.</span><span class="n">fetchNmrResidue</span><span class="p">(</span><span class="n">sequenceCode</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="c1"># result is matching NmrAtom, or (if None) self</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No NmrAtom can match, result is self</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">if</span> <span class="n">nmrResidue</span> <span class="ow">is</span> <span class="n">oldNmrResidue</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="c1"># NB self.name can never be returned as None</span>

                    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="c1"># self._wrappedData.name = name or None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">mergeToExisting</span><span class="p">:</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">mergeNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;New assignment clash with existing assignment,&quot;</span>
                                         <span class="s2">&quot; and merging is disallowed&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="c1"># if nmrResidue.getNmrAtom(self.name) is None:</span>
                    <span class="c1">#     if name != self.name:</span>
                    <span class="c1">#         # self._wrappedData.name = name or None</span>
                    <span class="c1">#         self.rename(name or None)</span>
                    <span class="c1">#     # self._apiResonance.resonanceGroup = nmrResidue._apiResonanceGroup</span>
                    <span class="c1">#     self._setApiResonanceGroup(self._apiResonance, nmrResidue)</span>
                    <span class="c1">#</span>
                    <span class="c1"># elif name is None or oldNmrResidue.getNmrAtom(name) is None:</span>
                    <span class="c1">#     if name != self.name:</span>
                    <span class="c1">#         # self._wrappedData.name = name or None</span>
                    <span class="c1">#         self.rename(name or None)</span>
                    <span class="c1">#     # self._apiResonance.resonanceGroup = nmrResidue._apiResonanceGroup</span>
                    <span class="c1">#     self._setApiResonanceGroup(self._apiResonance, nmrResidue)</span>
                    <span class="c1">#</span>
                    <span class="c1"># else:</span>
                    <span class="c1">#     # self._wrappedData.name = None  # Necessary to avoid name clashes</span>
                    <span class="c1">#     self.rename(None)  # Necessary to avoid name clashes</span>
                    <span class="c1">#     self._apiResonance.resonanceGroup = nmrResidue._apiResonanceGroup</span>
                    <span class="c1">#     # self._setApiResonanceGroup(self._apiResonance, nmrResidue)</span>
                    <span class="c1">#     # self._wrappedData.name = name</span>
                    <span class="c1">#     self.rename(name or None)</span>

                    <span class="c1"># Necessary to avoid name clashes - also handles all notifiers</span>
                    <span class="c1">#   is it firing too many now though?</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_apiResonance</span><span class="o">.</span><span class="n">resonanceGroup</span> <span class="o">=</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">_apiResonanceGroup</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">mergeToExisting</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">mergeNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;New assignment clash with existing assignment,&quot;</span>
                                     <span class="s2">&quot; and merging is disallowed&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="NmrAtom.mergeNmrAtoms"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom.mergeNmrAtoms">[docs]</a>    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mergeNmrAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtoms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">]]):</span>
        <span class="n">nmrAtoms</span> <span class="o">=</span> <span class="n">makeIterableList</span><span class="p">(</span><span class="n">nmrAtoms</span><span class="p">)</span>
        <span class="n">nmrAtoms</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">getByPid</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">nmrAtom</span> <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">nmrAtoms</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nmrAtom</span><span class="p">,</span> <span class="n">NmrAtom</span><span class="p">)</span> <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">nmrAtoms</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;nmrAtoms can only contain items of type NmrAtom&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">nmrAtoms</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;nmrAtom cannot be merged with itself&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">nmrAtom</span> <span class="ow">in</span> <span class="n">nmrAtoms</span><span class="p">:</span>
                <span class="n">absorbResonance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmrAtom</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_oldChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns ChemicalShift objects connected to NmrAtom&quot;&quot;&quot;</span>
        <span class="n">getDataObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">getDataObj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">shifts</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_getAttribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Returns contents of api attribute</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="p">,</span> <span class="n">attrName</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="p">,</span> <span class="n">attrName</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;nmrAtom does not have attribute </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attrName</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the chemicalShifts containing the nmrAtom</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chemicalShifts</span><span class="p">)</span>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># Implementation functions</span>
    <span class="c1">#=========================================================================================</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_restoreObject</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">apiObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subclassed to replace unknown isotopCodes&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">_restoreObject</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span> <span class="n">apiObj</span><span class="o">=</span><span class="n">apiObj</span><span class="p">)</span>

        <span class="c1"># Update Unknown to None</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">isotopeCode</span> <span class="o">==</span> <span class="n">UnknownIsotopeCode</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">_setIsotopeCode</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_getAllWrappedData</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">NmrResidue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;get wrappedData (ApiResonance) for all NmrAtom children of parent NmrResidue</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">parent</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">sortedResonances</span><span class="p">()</span>

    <span class="nd">@renameObject</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_setApiName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a serial format name of the form ?@&lt;n&gt; from the current serial number</span>
<span class="sd">        functionality provided by the api</span>
<span class="sd">        CCPN Internal - should only be used during nef import</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oldPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resetIds</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">oldName</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">_makeUniqueName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Generate a unique name in the form @n (e.g. @_123) or @symbol_n (e.g. @H_34)</span>
<span class="sd">        :return the generated name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopeCode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">symbol</span> <span class="o">:=</span> <span class="n">isotopeCode2Nucleus</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopeCode</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;@</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">symbol</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;@_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniqueId</span>
        <span class="k">return</span> <span class="n">_name</span>

    <span class="c1"># Sub-class two methods to get &#39;@&#39; names</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_defaultName</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;@&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_uniqueName</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Subclassed to get the &#39;@&#39; default name behavior&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_id</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">_queryNextUniqueIdValue</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">className</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_defaultName</span><span class="p">(),</span> <span class="n">_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">NmrAtom</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">_uniqueName</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_finaliseAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subclassed to handle associated offsetNMrResidues</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span>
            <span class="c1"># rename the nmrAtom in the chemicalShifts</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_childActions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_renameChemicalShifts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finaliseChildren</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">sh</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShifts</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span>
            <span class="c1"># store the old parent information - may be required for some modules</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oldNmrResidue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmrResidue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oldAssignedPeaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignedPeaks</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;create&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oldNmrResidue</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_oldAssignedPeaks</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_finaliseAction</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="k">return</span>

<div class="viewcode-block" id="NmrAtom.rename"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom.rename">[docs]</a>    <span class="nd">@renameObject</span><span class="p">()</span>
    <span class="nd">@logCommand</span><span class="p">(</span><span class="n">get</span><span class="o">=</span><span class="s1">&#39;self&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rename the NmrAtom, changing its name, Pid, and internal representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makeUniqueName</span><span class="p">()</span>
            <span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Renaming an </span><span class="si">%s</span><span class="s1"> without a specified value. Name set to the auto-generated option: </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">NmrAtom</span><span class="o">.</span><span class="n">_validateStringValue</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">remapSeparators</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;NmrAtom.rename: &quot;</span><span class="si">%s</span><span class="s1">&quot; conflicts with </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">previous</span><span class="p">))</span>

        <span class="c1"># with renameObjectContextManager(self) as addUndoItem:</span>
        <span class="n">isotopeCode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopeCode</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oldPid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pid</span>

        <span class="c1"># clear the isotopeCode so that the name may be changed (model restriction)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isotopeCode</span> <span class="o">=</span> <span class="n">UnknownIsotopeCode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c1"># set isotopeCode to the correct value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">isotopeCode</span> <span class="o">=</span> <span class="n">isotopeCode</span> <span class="k">if</span> <span class="n">isotopeCode</span> <span class="k">else</span> <span class="n">UnknownIsotopeCode</span>  <span class="c1"># self._UNKNOWN_VALUE_STRING</span>

        <span class="c1"># now handled by _finaliseAction</span>
        <span class="c1"># self._childActions.append(self._renameChemicalShifts)</span>
        <span class="c1"># self._finaliseChildren.extend((sh, &#39;change&#39;) for sh in self.chemicalShifts)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">oldName</span><span class="p">,)</span></div>

    <span class="k">def</span> <span class="nf">_renameChemicalShifts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># update chemicalShifts</span>
        <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShifts</span><span class="p">:</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">_renameNmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="NmrAtom.delete"><a class="viewcode-back" href="../../../ccpn/ccpn.core.html#ccpn.core.NmrAtom.NmrAtom.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete self and update the chemicalShift values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_shifts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemicalShifts</span>  <span class="c1"># tuple from property</span>

        <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">_shifts</span><span class="p">:</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">nmrAtom</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># delete the nmrAtom - notifiers handled by decorator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">()</span></div>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># CCPN functions</span>
    <span class="c1">#=========================================================================================</span>

    <span class="k">def</span> <span class="nf">_getAssignedPeakValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">peakLists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">theProperty</span><span class="o">=</span><span class="s1">&#39;ppmPosition&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CCPN internal. Used in ChemicalShift mapping and Relaxation Analysis tools.</span>
<span class="sd">        Convenient routine to avoid nested &quot;for-loops&quot;.</span>
<span class="sd">        Given a set of spectra, get the value of a particular property for the assigned-peak-dimension.</span>
<span class="sd">        Return a dictionary where the spectrum is the key and the value is the list of a given peak property.</span>
<span class="sd">        :param spectra: list of CCPN spectra.</span>
<span class="sd">        :param peakLists: list of CCPN peakLists to use as a sub-filter, otherwise use all available in spectra.</span>
<span class="sd">        :param theProperty: one of (ppmPosition, pointPosition, lineWidth, height, volume). Notes:</span>
<span class="sd">              height and volume are not a dim property but a peak property. Taken here to avoid code duplication.</span>
<span class="sd">        :return: dictionary {obj:list}</span>
<span class="sd">            E.g.: for &lt;NA:A.53.ASN.N&gt;  theProperty=&#39;ppmPosition&#39; it returns</span>
<span class="sd">                {&lt;SP:Tstar-free&gt;: [119.80854378483475], &lt;SP:Tstar-2:0eq&gt;: [119.93958073136751], ...}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">ccpn.core.lib.peakUtils</span> <span class="kn">import</span> <span class="n">_POINTPOSITION</span><span class="p">,</span> <span class="n">_PPMPOSITION</span><span class="p">,</span> <span class="n">_LINEWIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="n">VOLUME</span>

        <span class="k">if</span> <span class="n">peakLists</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">peakLists</span> <span class="o">=</span> <span class="p">[</span><span class="n">pl</span> <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">spectra</span> <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">peakLists</span><span class="p">]</span>

        <span class="n">valuesDict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">contrib</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span><span class="o">.</span><span class="n">peakDimContribs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">contrib</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">peakDim</span> <span class="o">=</span> <span class="n">contrib</span><span class="o">.</span><span class="n">peakDim</span>
            <span class="n">apiPeak</span> <span class="o">=</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">peak</span>
            <span class="k">if</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">isDeleted</span> <span class="ow">or</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">isDeleted</span> <span class="ow">and</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">figOfMerit</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span> <span class="c1">#figure of merit shouldn&#39;t be filtered here!?</span>
                <span class="k">continue</span>
            <span class="n">apiPeakList</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">peakList</span>
            <span class="n">peakList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiPeakList</span><span class="p">]</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="n">peakList</span><span class="o">.</span><span class="n">spectrum</span>
            <span class="k">if</span> <span class="n">peakList</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">peakLists</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">propertyDict</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">_POINTPOSITION</span>  <span class="p">:</span>   <span class="n">peakDim</span><span class="o">.</span><span class="n">position</span><span class="p">,</span>
                            <span class="n">_PPMPOSITION</span>    <span class="p">:</span>   <span class="n">peakDim</span><span class="o">.</span><span class="n">realValue</span><span class="p">,</span>
                            <span class="n">_LINEWIDTH</span>      <span class="p">:</span>   <span class="n">peakDim</span><span class="o">.</span><span class="n">lineWidth</span><span class="p">,</span>
                            <span class="n">HEIGHT</span>          <span class="p">:</span>   <span class="n">apiPeak</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                            <span class="n">VOLUME</span>          <span class="p">:</span>   <span class="n">apiPeak</span><span class="o">.</span><span class="n">volume</span><span class="p">,</span>
                            <span class="p">}</span>
            <span class="n">valuesDict</span><span class="p">[</span><span class="n">spectrum</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">propertyDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">theProperty</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">valuesDict</span>


    <span class="k">def</span> <span class="nf">_recalculateShiftValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spectra</span><span class="p">,</span> <span class="n">simulatedPeakScale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a new shift value from the assignedPeaks</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">apiResonance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>
        <span class="n">sum1</span> <span class="o">=</span> <span class="n">sum2</span> <span class="o">=</span> <span class="n">N</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">peakDims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">peaks</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">contrib</span> <span class="ow">in</span> <span class="n">apiResonance</span><span class="o">.</span><span class="n">peakDimContribs</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">contrib</span><span class="o">.</span><span class="n">isDeleted</span><span class="p">:</span>
                <span class="c1"># Function may be called during PeakDimContrib deletion</span>
                <span class="k">continue</span>

            <span class="n">peakDim</span> <span class="o">=</span> <span class="n">contrib</span><span class="o">.</span><span class="n">peakDim</span>
            <span class="n">apiPeak</span> <span class="o">=</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">peak</span>

            <span class="k">if</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">isDeleted</span> <span class="ow">or</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">isDeleted</span> <span class="ow">or</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">figOfMerit</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">apiPeakList</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">peakList</span>
            <span class="n">spectrum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="p">[</span><span class="n">apiPeakList</span><span class="p">]</span><span class="o">.</span><span class="n">spectrum</span>
            <span class="k">if</span> <span class="n">spectrum</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">spectra</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># NBNB TBD: Old Rasmus comment - peak splittings are not yet handled in V3. TBD add them</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">peakDim</span><span class="o">.</span><span class="n">realValue</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">apiPeak</span><span class="o">.</span><span class="n">figOfMerit</span>

            <span class="k">if</span> <span class="n">apiPeakList</span><span class="o">.</span><span class="n">isSimulated</span><span class="p">:</span>
                <span class="n">weight</span> <span class="o">*=</span> <span class="n">simulatedPeakScale</span>

            <span class="n">peakDims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peakDim</span><span class="p">)</span>
            <span class="n">peaks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">apiPeak</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">vw</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">weight</span>
                <span class="n">sum1</span> <span class="o">+=</span> <span class="n">vw</span>
                <span class="n">sum2</span> <span class="o">+=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">vw</span>
                <span class="n">N</span> <span class="o">+=</span> <span class="n">weight</span>

        <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">sum1</span> <span class="o">/</span> <span class="n">N</span>
            <span class="n">mean2</span> <span class="o">=</span> <span class="n">sum2</span> <span class="o">/</span> <span class="n">N</span>
            <span class="n">sigma2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mean2</span> <span class="o">-</span> <span class="p">(</span><span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span><span class="p">))</span>
            <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma2</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peakDims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span></div>

    <span class="c1">#=========================================================================================</span>
    <span class="c1"># new&lt;Object&gt; and other methods</span>
    <span class="c1"># Call appropriate routines in their respective locations</span>
    <span class="c1">#=========================================================================================</span>


<span class="c1">#=========================================================================================</span>
<span class="c1"># Connections to parents:</span>
<span class="c1">#=========================================================================================</span>


<span class="nd">@newObject</span><span class="p">(</span><span class="n">NmrAtom</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_newNmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">NmrResidue</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">isotopeCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NmrAtom</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create new NmrAtom within NmrResidue.</span>
<span class="sd">    See the NmrAtom class for details</span>

<span class="sd">    :param name: string name of the new nmrAtom; If name is None, generate a default name of form</span>
<span class="sd">                 e.g. &#39;@_123, @H_211&#39;, &#39;@N_45&#39;, ...</span>
<span class="sd">    :param isotopeCode: optional isotope code</span>
<span class="sd">    :param comment: optional string comment</span>
<span class="sd">    :return: a new NmrAtom instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">apiNmrProject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_wrappedData</span>
    <span class="n">resonanceGroup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wrappedData</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Name </span><span class="si">{}</span><span class="s1"> must be of type string (or None)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># generate (temporary) default name, to be changed later after we created the object</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">NmrAtom</span><span class="o">.</span><span class="n">_uniqueName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Check for name clashes</span>
        <span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="n">_name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">remapSeparators</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">previous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;newNmrAtom: name &quot;</span><span class="si">%s</span><span class="s1">&quot; clashes with </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">previous</span><span class="p">))</span>

    <span class="c1"># Create the api object</span>
    <span class="c1"># Always create first with unknown isotopeCode</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;resonanceGroup&#39;</span><span class="p">:</span> <span class="n">resonanceGroup</span><span class="p">,</span> <span class="s1">&#39;isotopeCode&#39;</span><span class="p">:</span> <span class="n">UnknownIsotopeCode</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">_name</span><span class="p">}</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">apiNmrProject</span><span class="o">.</span><span class="n">newResonance</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project</span><span class="o">.</span><span class="n">_data2Obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to generate new NmrAtom item&#39;</span><span class="p">)</span>

    <span class="c1"># Check/set isotopeCode; it has to be set after the creation to avoid API errors.</span>
    <span class="n">result</span><span class="o">.</span><span class="n">_setIsotopeCode</span><span class="p">(</span><span class="n">isotopeCode</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

    <span class="c1"># Set additional optional attributes supplied as kwds arguments</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_fetchNmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">NmrResidue</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">isotopeCode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fetch NmrAtom with name=name, creating it if necessary</span>

<span class="sd">    :param name: string name for new nmrAto if created</span>
<span class="sd">    :return: new or existing nmrAtom</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># resonanceGroup = self._wrappedData</span>

    <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNmrAtom</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">remapSeparators</span><span class="p">))</span> <span class="ow">or</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">newNmrAtom</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">isotopeCode</span><span class="o">=</span><span class="n">isotopeCode</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to generate new NmrAtom item&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_produceNmrAtom</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Project</span><span class="p">,</span> <span class="n">atomId</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">chainCode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">sequenceCode</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">residueType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NmrAtom</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get chainCode, sequenceCode, residueType and atomName from dot-separated atomId or Pid</span>
<span class="sd">    or explicit parameters, and find or create an NmrAtom that matches</span>
<span class="sd">    Empty chainCode gets NmrChain:@- ; empty sequenceCode get a new NmrResidue&quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="n">undoBlock</span><span class="p">():</span>

        <span class="c1"># Get ID parts to use</span>
        <span class="k">if</span> <span class="n">sequenceCode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sequenceCode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sequenceCode</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">atomId</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;_produceNmrAtom: other parameters only allowed if atomId is None&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#TODO: use .fields attribute of Pid instance</span>

                <span class="c1"># Remove colon prefix, if any</span>
                <span class="n">atomId</span> <span class="o">=</span> <span class="n">atomId</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">PREFIXSEP</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Pid</span><span class="o">.</span><span class="n">splitId</span><span class="p">(</span><span class="n">atomId</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">chainCode</span><span class="p">,</span> <span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">params</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;NmrAtom name must be set&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Pid</span><span class="o">.</span><span class="n">altCharacter</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Character </span><span class="si">%s</span><span class="s2"> not allowed in ccpn.NmrAtom.name&quot;</span> <span class="o">%</span> <span class="n">Pid</span><span class="o">.</span><span class="n">altCharacter</span><span class="p">)</span>

        <span class="c1"># Produce chain</span>
        <span class="n">nmrChain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetchNmrChain</span><span class="p">(</span><span class="n">shortName</span><span class="o">=</span><span class="n">chainCode</span> <span class="ow">or</span> <span class="n">Constants</span><span class="o">.</span><span class="n">defaultNmrChainCode</span><span class="p">)</span>
        <span class="n">nmrResidue</span> <span class="o">=</span> <span class="n">nmrChain</span><span class="o">.</span><span class="n">fetchNmrResidue</span><span class="p">(</span><span class="n">sequenceCode</span><span class="o">=</span><span class="n">sequenceCode</span><span class="p">,</span> <span class="n">residueType</span><span class="o">=</span><span class="n">residueType</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">nmrResidue</span><span class="o">.</span><span class="n">fetchNmrAtom</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unable to generate new NmrAtom item&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="c1">#EJB 20181203: moved to NmrResidue</span>
<span class="c1"># NmrResidue.newNmrAtom = _newNmrAtom</span>
<span class="c1"># del _newNmrAtom</span>
<span class="c1"># NmrResidue.fetchNmrAtom = _fetchNmrAtom</span>

<span class="c1">#EJB 20181203: moved to nmrAtom</span>
<span class="c1"># Project._produceNmrAtom = _produceNmrAtom</span>

<span class="c1"># Notifiers:</span>
<span class="c1"># className = Nmr.Resonance._metaclass.qualifiedName()</span>
<span class="c1"># Project._apiNotifiers.extend(</span>
<span class="c1">#         ((&#39;_finaliseApiRename&#39;, {}, className, &#39;setImplName&#39;),</span>
<span class="c1">#          (&#39;_finaliseApiRename&#39;, {}, className, &#39;setResonanceGroup&#39;),</span>
<span class="c1">#          )</span>
<span class="c1">#         )</span>
<span class="k">for</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="n">Nmr</span><span class="o">.</span><span class="n">AbstractPeakDimContrib</span><span class="o">.</span><span class="n">_metaclass</span><span class="o">.</span><span class="n">getNonAbstractSubtypes</span><span class="p">():</span>
    <span class="n">className</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
    <span class="n">Project</span><span class="o">.</span><span class="n">_apiNotifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">((</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="s1">&#39;_modifiedLink&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;classNames&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;NmrAtom&#39;</span><span class="p">,</span> <span class="s1">&#39;Peak&#39;</span><span class="p">)},</span> <span class="n">className</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">),</span>
             <span class="p">)</span>
            <span class="p">)</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Python  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ccpn.core.NmrAtom</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright .
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>