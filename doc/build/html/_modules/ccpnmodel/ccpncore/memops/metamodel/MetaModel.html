<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ccpnmodel.ccpncore.memops.metamodel.MetaModel &mdash; Python  documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="Python  documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ccpnmodel.ccpncore.memops.metamodel.MetaModel</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Module Documentation here</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Licence, Reference and Credits</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) CCPN project (http://www.ccpn.ac.uk) 2014 - 2017&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Wayne Boucher, Ed Brooksbank, Rasmus H Fogh, Luca Mureddu, Timothy J Ragan &amp; Geerten W Vuister&quot;</span><span class="p">)</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CCPN licence. See http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpnLicense for licence text&quot;</span><span class="p">)</span>
<span class="n">__reference__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;For publications, please use reference from http://www.ccpn.ac.uk/v3-software/downloads/license&quot;</span><span class="p">,</span>
               <span class="s2">&quot;or ccpnmodel.ccpncore.memops.Credits.CcpNmrReference&quot;</span><span class="p">)</span>

<span class="c1">#=========================================================================================</span>
<span class="c1"># Last code modification</span>
<span class="c1">#=========================================================================================</span>
<span class="n">__modifiedBy__</span> <span class="o">=</span> <span class="s2">&quot;$modifiedBy: CCPN $&quot;</span>
<span class="n">__dateModified__</span> <span class="o">=</span> <span class="s2">&quot;$dateModified: 2017-07-07 16:33:21 +0100 (Fri, July 07, 2017) $&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;$Revision: 3.0.b5 $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Created</span>
<span class="c1">#=========================================================================================</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;$Author: CCPN $&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;$Date: 2017-04-07 10:28:48 +0000 (Fri, April 07, 2017) $&quot;</span>
<span class="c1">#=========================================================================================</span>
<span class="c1"># Start of code</span>
<span class="c1">#=========================================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">NBNB This code must work for python 2,1 up to and including python 3.x</span>
<span class="sd">DO NOT normalise, as the code is loaded into ObjectDomain (Jython 2.1)</span>

<span class="sd">MetaModel Implementation information:</span>

<span class="sd">- allowedTags define the allowed tags, and the allowed ranges of their values.</span>
<span class="sd">See memops.metamodel.TaggedValues for further information</span>

<span class="sd">- parameterData give information for setting, checking and writing MetaModel </span>
<span class="sd">attributes. It is used for attributes that may be given as input parameters -</span>
<span class="sd">internal implementation attributes are set explicitly.</span>
<span class="sd">parameterData has the following legal tags:</span>

<span class="sd">- &#39;default&#39; describes the default setting of a parameter.</span>
<span class="sd">  It is an actual value, not a string representation.</span>
<span class="sd">  Anything without a default is a mandatory input parameter.</span>
<span class="sd">  </span>
<span class="sd">- &#39;type&#39; is either a Python class or type (for direct type checking),</span>
<span class="sd">   or a string typeCode for cases where special checking is needed.</span>
<span class="sd">   The legal string typeCodes are: Boolean,  Token, StringDict, and content.</span>
<span class="sd">   The latter is used for private implementation attributes, to prevent</span>
<span class="sd">   overwriting.</span>
<span class="sd">   If &#39;type&#39; is not set, the parameter can be of any type (&#39;object&#39;). In practice</span>
<span class="sd">   there will generally be some kind of type checking in the checkValid function.</span>
<span class="sd">   An example would be the value constants (see below).</span>

<span class="sd">- &#39;namelist&#39;. Allowed only for type == &#39;content&#39;. Content is stored in a shared</span>
<span class="sd">  dictionary (elementDict). The namelist is the name of the attribute that holds</span>
<span class="sd">  the relevant list of names to extract a subset from the elementDict. E.g. the</span>
<span class="sd">  parameter &#39;classes&#39; will have as a &#39;namelist&#39; attribute the list of contained</span>
<span class="sd">  class names.</span>

<span class="sd">- &#39;hicard&#39; is the maximum number of objects. Default is 1. Any other number,</span>
<span class="sd">including unlimited (infinity), means this is a list.</span>

<span class="sd">- &#39;enumeration&#39; means the parameter must be within the enumerated list of values</span>

<span class="sd">- &#39;isFixed&#39; means that the parameter must be identical to its default</span>

<span class="sd">- &#39;setterFunc&#39; is the name of a function that is called on setting of the </span>
<span class="sd">MetamodelElement attribute, instead of the standard setting code. It serves</span>
<span class="sd">for attributes/links that needs more complex actions than just setting a value.</span>
<span class="sd">if is is set to &#39;unsettable&#39;, the attribute may not be set.</span>

<span class="sd">- &#39;getterFunc&#39; is the name of a function that is called on getting of the </span>
<span class="sd">MetamodelElement attribute, instead of the standard getting code. It serves</span>
<span class="sd">for attributes/links that needs more complex actions than just getting a value</span>

<span class="sd">__setattr__ and __getattr__ take care of type checking, and information hiding.</span>
<span class="sd">Other checking is done only in checkValid.</span>


<span class="sd">Implementation attributes are in principle private, and start with &#39;__&#39;</span>
<span class="sd">following the standard Python convention. Also following standard Python</span>
<span class="sd">the private attributes can be accessed from the outside, and sometimes are.</span>
<span class="sd">Non-implementation attributes are generally kept in the normal __dict__, </span>
<span class="sd">and are exported directly. Collections and dictionaries, which can not be </span>
<span class="sd">exported directly, are kept in the __dataDict dictionary.</span>
<span class="sd">Contained elements are kept in the __elementDict or __constraints dictionaries.</span>
<span class="sd">New attributes can be freely defined. These are kept in the __dict__ as for</span>
<span class="sd">normal Python objects.</span>
<span class="sd">The _tempData dictionary has no parameterData record and is treated as a </span>
<span class="sd">&#39;new attribute&#39;. It is used for temporary information storage during</span>
<span class="sd">object creation. For valid objects it must be empty.</span>

<span class="sd">Some of the business rules for MetaClass parameters are enforced in the </span>
<span class="sd">finaliseMetaClass function.</span>

<span class="sd">#############################################################################</span>

<span class="sd">Value constants:</span>

<span class="sd">MetaDataType.enumeration, MetaConstant.value, MetaAttribute.defaultValue and</span>
<span class="sd">MetaParameter.defaultValue are all value constants, and must be of MetaDataType</span>
<span class="sd">type. They are passed in as python values (not strings). The implementation</span>
<span class="sd">checks their validity using MetaDataType.isValid.</span>

<span class="sd">#############################################################################</span>

<span class="sd">General rules:</span>

<span class="sd">- The MetaModelElement.isImplicit attribute is used for elements that are</span>
<span class="sd">generated automatically in the course of code generation. By definition all</span>
<span class="sd">information in these elements can be derived from other, non-temporary</span>
<span class="sd">elements. Implicit elements are not written to disk when the model is stored.</span>

<span class="sd">- A number of elements, mainly operations, are generated automatically. </span>
<span class="sd">Accordingly, name clashes may appear only during code generation, and possibly</span>
<span class="sd">for certain implementations only. To avoid duplication there is no up-front</span>
<span class="sd">check against such name clashes, and it is not known for sure if the model is</span>
<span class="sd">valid in this respect until all implementation generations have been tried.</span>

<span class="sd">#############################################################################</span>

<span class="sd">Names:</span>

<span class="sd"> - Element names are of type Token. This means they must be made of digits, </span>
<span class="sd"> lower and upper case letters, and underscore, and may not start with a digit.</span>
<span class="sd"> </span>
<span class="sd"> - Some names have length limits: MetaClass names, </span>
<span class="sd"> ClassElement names, and package shortNames. See relevant checkValid for details</span>
<span class="sd"> </span>
<span class="sd"> - Names that start with underscore (&#39;_&#39;) are valid only for implicit elements.</span>
<span class="sd"> Autogenerated elements may start with underscore.</span>
<span class="sd"> Implementation attributes, functions etc. should start with underscore</span>
<span class="sd"> </span>
<span class="sd"> - As a matter of style, the names of AbstractDataTypes, constants, exceptions</span>
<span class="sd"> and packages not containing other packages should start with upper case, </span>
<span class="sd"> and names of AbstractValues and MetaOperations should start with lower case.</span>
<span class="sd"> Except for MetaOperations, no element name should contain an underscore.</span>
<span class="sd"> </span>
<span class="sd"> - Some names may conflict with naming rules in certain implementations or</span>
<span class="sd"> programming languages. These are mapped to different names. Where possible the</span>
<span class="sd"> mapping is used only internally in the implementation, but there may be cases</span>
<span class="sd"> (like Python reserved words) that require changing the publicly  visible name.</span>
<span class="sd"> The usename attribute is intended for such renaming. It is  temporary, intended</span>
<span class="sd"> for use by ModelAdapt, and is reset when packages are reset. Usename attributes</span>
<span class="sd"> are ignored in model comparison if ignoreImplicit  is set to True.</span>
<span class="sd"> TODO Usename is not yet in use in the generation machinery</span>

<span class="sd">#############################################################################</span>
<span class="sd">   </span>
<span class="sd">Packages:</span>

<span class="sd">  Packages serve to organise both the Model description, the API code,</span>
<span class="sd">  and the data storage. </span>
<span class="sd">  All elements of the data model are contained in packages.</span>
<span class="sd">  All packages are ultimately contained in a single, topmost package,</span>
<span class="sd">  currently called RootPackage (the name is set in ImpConstants). The name of</span>
<span class="sd">  this package is omitted in qualified package names.</span>
<span class="sd">  Package memops.Implementation (name may change in later versions), is reserved</span>
<span class="sd">  for the implementation, and must be imported by all other packages.</span>
<span class="sd">  </span>
<span class="sd">  Packages are linked to each other through the following relationships:</span>

<span class="sd">  - Containment:</span>
<span class="sd">   Package A contains package B.</span>
<span class="sd">   A package P that contains other packages can contain nothing else, and does</span>
<span class="sd">   not correspond to Model, API Code or Data files. Packages such as P serve</span>
<span class="sd">   only to organise the other packages and are implemented as a directory</span>
<span class="sd">   structure for Model and code files. Packages that contain other packages</span>
<span class="sd">   cannot import or be imported by other packages. </span>

<span class="sd">  - Import:  Importing a package makes it known to the importing package, but</span>
<span class="sd">   the two remain distinct and do not share a namespace (for Code) or mix their</span>
<span class="sd">   data in the same file (for Data). Code from imported packages are implemented</span>
<span class="sd">   with &#39;import otherPackage&#39; in Python. Elements from the imported packages can</span>
<span class="sd">   be used in most ways at the Code level. The only exception is that a class</span>
<span class="sd">   cannot have subclasses in another package if it is non-abstract or involved</span>
<span class="sd">   in a link. Abstract, derived, and implementation links are exempt from this</span>
<span class="sd">   rule.</span>

<span class="sd">   If package A imports package B, B is in A.importedPackages, and  A is in</span>
<span class="sd">   B.accessedPackages. Links that cross package boundaries must be navigable</span>
<span class="sd">   from the importing package to the imported package, and may be navigable both</span>
<span class="sd">   ways. If navigable both ways, information about the link (at both model, code</span>
<span class="sd">   and data level) are kept solely in the importing package. When</span>
<span class="sd">   loading a package of data in a file implementation, loading of imported</span>
<span class="sd">   packages of data are  triggered automatically. Links that are mandatory</span>
<span class="sd">   (locard != 0) or frozen  (changeablility == frozen) must be towards an</span>
<span class="sd">   imported (rather than accessed) package.</span>

<span class="sd">#############################################################################</span>
<span class="sd"> </span>
<span class="sd"> Constraints:</span>

<span class="sd"> - Constraints may be used for all ConstrainedElements, except MetaParameters.</span>

<span class="sd"> - Constraints may not be attached to derived elements</span>

<span class="sd"> - Constraints are evaluated in check_valid and also before modifying the </span>
<span class="sd">  data in modifier functions (set and add/remove)</span>

<span class="sd"> - Constraints attached to MetaClasses and MetaDataObjTypes are evaluated only</span>
<span class="sd">  in check_valid.</span>

<span class="sd"> - Constraint codeStubs are given in the manner of tagged values. The precise</span>
<span class="sd"> rules for values may vary slightly by language</span>
<span class="sd">. For Python they are given as </span>
<span class="sd">  python code strings, correctly indented starting flush left, with two spaces </span>
<span class="sd">  indent, and may not contain multiline strings. Note that the rules for code</span>
<span class="sd">  stubs are not checked in the checkValid function. Their correctness as code</span>
<span class="sd">  can be checked only on compilation/testing of the final API.</span>
<span class="sd">  The code may make use of &#39;self&#39; and &#39;value&#39; or their language equivalents.</span>
<span class="sd">  For Constraints on MetaDataTypes only &#39;value&#39; may be used, For constraints</span>
<span class="sd">  on MetaClasses and MetaDataObjTypes only &#39;self&#39; may be used.</span>

<span class="sd"> - Constraints where &#39;self&#39; is allowed are always evaluated on fully formed </span>
<span class="sd"> objects in a legal state. They may therefore assume the existence of any </span>
<span class="sd"> mandatory attributes and links etc. It is recommended to prefer constraints</span>
<span class="sd"> that are evaluated in modifier operations, i.e. to use MetaClass and</span>
<span class="sd"> MetaDataObjType constraints only if nothing else will serve.</span>
<span class="sd"> Constraints on attributes that make use only of &#39;value&#39; should ideally be</span>
<span class="sd"> avoided in  favour of creating constrained data types - this allows</span>
<span class="sd"> verification of the values as an alternative to try-except, at least in </span>
<span class="sd"> principle</span>

<span class="sd"> - Constraints on ClassElements with hicard != 1 are evaluated for each</span>
<span class="sd"> individual object in the collection (&#39;value&#39; is set successively to each</span>
<span class="sd"> object rather than to the set of objects).Constraints on the collection as</span>
<span class="sd"> such must be implemented as constraints on the containing MetaClass or</span>
<span class="sd"> MetaDataObjType.</span>
<span class="sd"> </span>
<span class="sd"> The following rules are at least partially verified in checkValid:</span>
<span class="sd"> </span>
<span class="sd"> - There can be no constraints on derived links or parent/child links.</span>

<span class="sd"> - Constraints on roles across package boundaries must be on the importing side.</span>

<span class="sd"> - For intra-package links, Constraints for one-to-many (or many-to-one)</span>
<span class="sd">  binavigable links must be located so they constrain the -to-one link. For</span>
<span class="sd">  other binavigable links constraints can be put on either side of the</span>
<span class="sd">  association, but all constraints must be on the same side. The location of the</span>
<span class="sd">  constraint in the Model makes no difference to its evaluation.</span>

<span class="sd"> - Constraints may be given in two different notations:</span>
<span class="sd">  1) a string that when executed sets the variable &#39;isValid&#39; to a truth value</span>
<span class="sd">  and that contains the string &#39;isValid&#39;</span>
<span class="sd">  2) a single line that evaluates to a truth value and that does not contain</span>
<span class="sd">  the string &#39;isValid&#39;.</span>

<span class="sd">#############################################################################</span>

<span class="sd">Organisation of Objects and Classes:</span>

<span class="sd">Except for multiple inheritance (see below), all classes must be a subclass of</span>
<span class="sd">the topmost base class  (currently called MemopsObject). NonAbstract classes in</span>
<span class="sd">the Implementation package must further be subclasses of ImplementationObject,</span>
<span class="sd">while all classes outside Implementation must be subclasses of DataObject. All</span>
<span class="sd">MetaDataObjTypes must be subclasses of MemopsDataTypeObject.</span>

<span class="sd">All non-abstract classes have a link to another class called the parent class.</span>
<span class="sd">This link must be mandatory (1..1) and frozen, and defined as a composition</span>
<span class="sd">link in UML (filled black diamond). UML composition is used only for this </span>
<span class="sd">purpose. The name of the link can be anything. </span>
<span class="sd">The set of parent-child links form a tree rooted in the MemopsRoot class; a </span>
<span class="sd">MemopsRoot object has no parent and has no UML composition link.</span>

<span class="sd">Subtypes of TopObject are children of the MemopsRoot object; all other</span>
<span class="sd">classes except MemopsRoot are children of a class in the same package.</span>

<span class="sd">All classes (abstract or not) with a non-abstract parent link must have a</span>
<span class="sd">main key, unless the parent-child link is  one-to-one. This main key is a set of</span>
<span class="sd">attributes and/or links of the whose value identifies it uniquely among the</span>
<span class="sd">objects with the same class and the same parent object. The parent-child links</span>
<span class="sd">define a unique path from the Project object to each object, and knowing the</span>
<span class="sd">main keys allows you to chose the right object at each step on the path. The</span>
<span class="sd">precise rules for parent and main keys in the presence of inheritance are</span>
<span class="sd">described below.</span>

<span class="sd">Rules governing parents and keys:</span>

<span class="sd"> - All non-abstract classes have a parent, except for class Project. </span>
<span class="sd">   The parent-child links form a tree.</span>

<span class="sd"> - Parent-child links may be either one-to-many or one-to-one.</span>
<span class="sd">   The latter are referred to as &#39;only children&#39;.</span>

<span class="sd"> - All classes with a non-abstract parent have a main key, except for only</span>
<span class="sd">   children. Only children have no main key.</span>

<span class="sd"> - The local key (&#39;main key&#39;) of each object must define it uniquely within the</span>
<span class="sd">  link to its parent object.</span>

<span class="sd"> - The local key consists of an attribute, a link, or an ordered tuple of </span>
<span class="sd">  attributes and links.</span>

<span class="sd"> - Only attributes and links belonging to a class can be used as keys for</span>
<span class="sd">  the class. These may originally have been defined in either the class or a</span>
<span class="sd">  superclass.</span>

<span class="sd"> - All attributes and links partaking in a local key must be frozen non-derived,</span>
<span class="sd"> and mandatory, and locard must be equal to hicard. Cardinality 0..1 is </span>
<span class="sd"> forbidden, even though it could in theory be accommodated. Links to classes in</span>
<span class="sd"> accessed (i.e. not imported) packages are not allowed as keys.</span>
<span class="sd"> </span>
<span class="sd"> - TopObject keys may only contain attributes and links to other TopObjects</span>

<span class="sd"> - The global key (&#39;key&#39;) of an object is a list concatenating the local keys</span>
<span class="sd"> of itself and all its parents, starting at root level and going down.</span>

<span class="sd"> - The combination of class name, and global key must be a unique</span>
<span class="sd"> object identifier. Each object and non-abstract class must have a key.</span>

<span class="sd"> - The key serves to provide a unique identifying string for each object, for</span>
<span class="sd">  use in both GUI, object printing, and interfile references.</span>

<span class="sd"> - An abstract superclass may have a key defined. If it does not, the subclasses</span>
<span class="sd">  have individual definitions for their keys. These keys need bear no </span>
<span class="sd">  relationship to each other.</span>

<span class="sd"> - Parent-child links between two abstract classes may be abstract. These links</span>
<span class="sd">  are overridden by links between the subclasses of the abstract classes.</span>
<span class="sd">  Abstract classes may have abstract one-way parent links to non-abstract </span>
<span class="sd">  classes.</span>

<span class="sd"> - Keys and parents cannot be overridden in subclasses. It follows that if a</span>
<span class="sd">  superclass has a key (parent link), that key (parent link) is the same for </span>
<span class="sd">  its subclasses. An abstract class can have a key even if it does not have a </span>
<span class="sd">  parent..</span>

<span class="sd"> - A class may not have two different child classes (including subclasses) with</span>
<span class="sd">  the same name.</span>

<span class="sd">#############################################################################</span>

<span class="sd">Cardinalities:</span>

<span class="sd">Attributes with hicard == 1 must be isUnique=True, isOrdered=False</span>

<span class="sd">In the current implementation, two-way links must have isUnique=True at</span>
<span class="sd">both ends. This could be relaxed, but the code generation machinery does not</span>
<span class="sd">currently support it correctly.</span>

<span class="sd">To allow for (presumed) problems with database implementations, two-way links</span>
<span class="sd">are not allowed to have isOrdered=True at both ends.</span>

<span class="sd">There are no limitations on attributes, one-way links, derived links, or</span>
<span class="sd">Implementation links.</span>

<span class="sd">#############################################################################</span>
<span class="sd">  </span>
<span class="sd">Rules governing inheritance:</span>

<span class="sd"> - Multiple inheritance is allowed, as follows:</span>
<span class="sd">The base class for MetaClasses is MemopsObject; </span>
<span class="sd">The base class for MetaDataTypeObjects is MemopsDataTypeObject.</span>
<span class="sd">Inheritance follows the Python model: depth-first, following the order of</span>
<span class="sd"> supertypes. Diamond inheritance is handled by keeping only the last </span>
<span class="sd"> occurrence in the list of supertypes for any class.</span>
<span class="sd">Each class can have at most one direct superclass that inherits from </span>
<span class="sd"> the base.</span>
<span class="sd">If present this class must be first in the list of supertypes.</span>
<span class="sd">Non-abstract MetaClasses and MetaDataTypeObjects must descend from the base.</span>
<span class="sd">Only MetaClasses that descend from the base may participate in non-abstract </span>
<span class="sd">links.</span>
<span class="sd">Only classes that descend from the base may have elements that override</span>
<span class="sd"> elements of other classes.</span>
<span class="sd">The first supertype in the list is returned as obj.supertype (derived) and </span>
<span class="sd"> obj.getSupertype().</span>
<span class="sd">For languages that do not allow multiple inheritance (possibly for all </span>
<span class="sd"> languages) classes that do not descend from the base are merged into their </span>
<span class="sd"> subclasses before code generation starts.</span>
<span class="sd">  </span>
<span class="sd"> - Superclasses involved in links can not have subclasses in other packages, </span>
<span class="sd">  unless the links are abstract, derived, or implementation,</span>
<span class="sd"> </span>
<span class="sd"> - Non-abstract MetaDataObjTypes may not have subtypes in other packages. </span>
<span class="sd">  </span>
<span class="sd"> - Most metaAttributes and metaLinks are present in both a type and its</span>
<span class="sd">  supertype. Contained elements (AbstractValues and MetaOperations) and</span>
<span class="sd">  MetaConstraints are only present in the Element where they belong, but are</span>
<span class="sd">  valid for all subtypes as well. Functions that get elements by name will</span>
<span class="sd">  automatically look in all supertypes till it finds the desired element.</span>
<span class="sd">  Functions that get lists of elements come in two versions, &#39;get&#39; and</span>
<span class="sd">  &#39;getAll&#39;. The &#39;get&#39; version (in Python replaced by the standard obj.attr</span>
<span class="sd">  syntax) will get only the elements contained directly, while the getAll</span>
<span class="sd">  version gets elements from both the object and its supertype objects.</span>

<span class="sd"> - Operations may override each other. The name and number of parameters must be</span>
<span class="sd">  the same, except for constructors. Most attributes must be the same in the</span>
<span class="sd">  overriding and overridden operations, but container, guid, documentation, and</span>
<span class="sd">  code stubs may be different. Tagged values must be the same, but the</span>
<span class="sd">  overriding operation and its parameters may have extra tagged values.</span>
<span class="sd">  Parameter defaults may also differ. The rules for MetaOperation targets depend</span>
<span class="sd">  on their type. For targets of ClassElement type the target of the overriding</span>
<span class="sd">  operation must override the target of the overridden operation. For</span>
<span class="sd">  MetaParameter valueTypes the type of the overriding parameter must be a</span>
<span class="sd">  subtype of the type of the overridden parameter.</span>

<span class="sd"> - Associations and roles may be overridden only if they are defined as </span>
<span class="sd">  abstract.</span>
<span class="sd">  The cardinality of the overriding element must be a subset of the</span>
<span class="sd">  cardinality of the overridden.</span>
<span class="sd">  If the abstract element has high-cardinality different from one, the</span>
<span class="sd">  overriding element must also have high-cardinality different from one.</span>
<span class="sd">  The valueType of the overriding element must be a subtype of the </span>
<span class="sd">  valueType of the overridden. Overriding attributes may have a defaultValue</span>
<span class="sd">  if the overridden attribute does not, but may not override actual default </span>
<span class="sd">  values.</span>
<span class="sd">  Otherwise all parameters except &#39;isAbstract&#39;, &#39;container&#39;, &#39;documentation&#39;, </span>
<span class="sd">  &#39;changeability&#39;, &#39;isDerived&#39;, &#39;guid&#39;, and &#39;constraints&#39; must be the same for </span>
<span class="sd">  abstract and overriding association. Constraints and tagged values defined </span>
<span class="sd">  for the overridden attribute are inherited down and may not be overridden.</span>
<span class="sd">  The overriding role may have extra constraints and tagged values.</span>
<span class="sd">  </span>
<span class="sd">  There are extra rules for overriding of Associations:</span>
<span class="sd">  Abstract associations must be overridden in all non-abstract subclasses,</span>
<span class="sd">  and abstract roles must be contained in abstract classes. </span>
<span class="sd">  The overriding associations must be between subclasses of these classes.</span>
<span class="sd">  Unless both the overridden role is one-way, the otherRoles must override </span>
<span class="sd">  each other like the roles. Note that an abstract one-way association may </span>
<span class="sd">  be overriddden by a two-way association.</span>
<span class="sd"> </span>
<span class="sd"> - MetaParameters may override each other without restraint if both are</span>
<span class="sd"> implicit. Otherwise most attributes must be identical. The two may differ in</span>
<span class="sd"> container (obviously), the overriding parameter may have extra</span>
<span class="sd"> tagged values, and the its valueType may be a subtype of the one it is </span>
<span class="sd"> overriding.</span>
<span class="sd"> The cardinality of the overriding element must be a subset of the</span>
<span class="sd"> cardinality of the overridden.</span>
<span class="sd"> If the abstract element has high-cardinality different from one, the</span>
<span class="sd"> overriding element must also have high-cardinality different from one.</span>
<span class="sd"> The MetaParameter rules apply equally to parameters of MetaExceptions</span>
<span class="sd"> and their supertypes, and to parameters of MetaOperations and the</span>
<span class="sd"> MetaOperations they override.</span>
<span class="sd">  </span>
<span class="sd"> </span>
<span class="sd">#############################################################################</span>

<span class="sd"> Special cases:</span>
<span class="sd"> </span>
<span class="sd"> - The isAutomatic attribute in ClassElement is used for attributes or links</span>
<span class="sd"> that are set automatically by the implementation, but that must then be stored</span>
<span class="sd"> and loaded normally. Currently it is used only for &#39;serial&#39;, but timestamps </span>
<span class="sd"> would be an obvious case.</span>
<span class="sd"> </span>
<span class="sd"> - The attribute name &#39;serial&#39; (given in serial_attribute) is used for object</span>
<span class="sd"> serial numbers. The code for handling this is hardwired. Attributes with this</span>
<span class="sd"> name are illegal in DataObjTypes.</span>
<span class="sd"> Attributes with this name must be of type Int, cardinality 1..1, </span>
<span class="sd"> isAutomatic == True, and changeability = frozen.</span>
<span class="sd"> </span>
<span class="sd">#############################################################################</span>

<span class="sd"> Rules for operations :</span>
<span class="sd"> </span>
<span class="sd"> - The legal opTypes for public functions are given in </span>
<span class="sd"> memops.metamodel.OpTypes.operationData</span>
<span class="sd"> opTypes are divided in groups &#39;query&#39;, &#39;modify&#39;, &#39;create&#39;, &#39;delete&#39; and</span>
<span class="sd"> &#39;other&#39;.</span>
<span class="sd"> </span>
<span class="sd"> Operations have a &#39;target&#39; that describes what the operation is acting on.  </span>
<span class="sd"> Operations that are linked to attributes and roles (e.g. get, set, add, remove,</span>
<span class="sd"> findFirst, findAll) have the attribute or role as target. The role or attribute</span>
<span class="sd"> must belong to the class itself. Factory functions(opType &#39;new&#39;) have the class</span>
<span class="sd"> being created as target.  There are also a number of functions that operate on</span>
<span class="sd"> the object containing  them (opTypes &#39;init&#39;, and the &#39;delete&#39; and &#39;checkValid&#39;</span>
<span class="sd"> opTypes); these have the containing class as target. They generally have the</span>
<span class="sd"> same name as their opType and are not inherited. All operations mentioned so</span>
<span class="sd"> far are generated automatically, but may be overridden by handwritten</span>
<span class="sd"> alternatives. Operations of these types may not be entered where there is no</span>
<span class="sd"> autogenerated version to override.</span>

<span class="sd"> There are also operations that can only be entered by hand and have no</span>
<span class="sd"> autogenerated equivalent. These have the opTypes &#39;otherQuery&#39;, &#39;otherModify&#39;,</span>
<span class="sd"> &#39;otherCreate&#39;, &#39;otherDelete&#39;, and &#39;other&#39;. For technical reasons to do with</span>
<span class="sd"> the implementation of fine-grained access control, these functions have</span>
<span class="sd"> themselves.as targets.</span>
<span class="sd"> </span>
<span class="sd"> - Operation subOpTypes distinguish operation variants. This is intended</span>
<span class="sd"> for languages that allow several overloaded operations with the same name but</span>
<span class="sd"> different calling interfaces. </span>
<span class="sd"> </span>
<span class="sd"> - Names of operations with attribute or role targets and of factory functions</span>
<span class="sd"> are generally made by concatenating the opType and the target name (with first</span>
<span class="sd"> letter in upper case). These are inherited. </span>

<span class="sd"> - Operations are given in the following circumstances:</span>
<span class="sd">  &#39;get&#39; functions: for all elements. For derived elements the function must</span>
<span class="sd">  be explicitly defined.</span>
<span class="sd">  &#39;set&#39; functions: for all elements except parent/child links and derived </span>
<span class="sd">  unchangeable elements. For derived changeable elements the function must</span>
<span class="sd">  be explicitly defined. Unchangeable elements, links where the other end is </span>
<span class="sd">  unchangeable, and automatic elements all have private set functions; these</span>
<span class="sd">  will throw an error unless isReading or override are set when they are called.</span>
<span class="sd">  They are intended for use by the implementation only. </span>
<span class="sd">  - &#39;add&#39; functions: for all elements with hicard != 1</span>
<span class="sd">   with the same exceptions as for &#39;set&#39;</span>
<span class="sd">  - &#39;remove&#39; functions: for all elements with hicard != 1</span>
<span class="sd">   with the same exceptions as for &#39;set&#39;</span>
<span class="sd">  - &#39;sorted&#39;: for all elements with hicard != 1 and isOrdered==False</span>
<span class="sd">    These functions return a sorted list of the linked-to objects.</span>
<span class="sd">    For child links the list is sorted by local key,</span>
<span class="sd">    in other cases by (class, fullKey).</span>
<span class="sd">  - &#39;findFirst&#39; functions: for all roles or DataObjType attributes </span>
<span class="sd">    with hicard != 1 without exception</span>
<span class="sd">  - &#39;findAll&#39; functions: for all roles or DataObjType attributes </span>
<span class="sd">     with hicard != 1 without exception</span>
<span class="sd">  findFirst returns the first element fitting the search criteria. For </span>
<span class="sd">  unordered collections the function may return any element that fulfills</span>
<span class="sd">  the search criteria.</span>
<span class="sd">  findAll returns a list of all elements fitting the criteria.</span>
<span class="sd">  For implementations with access control the &#39;find&#39; commands will ignore </span>
<span class="sd">  objects where the caller does not have appropriate permission, whereas</span>
<span class="sd">  &#39;get&#39; will either return all objects or throw an error.</span>

<span class="sd"> - Operations will only be given explicitly in the UML model where they differ</span>
<span class="sd">  from the autogenerated norm. They will be fully specified, except that </span>
<span class="sd">  parameters will be given explicitly only for the &#39;other&#39; opTypes.</span>
<span class="sd">  Any operation given explicitly in the model will be non-autogenerated.</span>
<span class="sd">  The code must be given in the codeStubs attribute.</span>

<span class="sd"> - Code stub rules may differ between languages. Python code stubs are given </span>
<span class="sd">  as a string, correctly indented starting flush left, with two spaces indent. </span>
<span class="sd">  code:python will not work correctly with </span>
<span class="sd">  multiline strings, as the indentation is modified by adding initial spaces. </span>
<span class="sd">  The code is intended to be transformed into a method of the class, and uses </span>
<span class="sd">  &#39;self&#39; as normal for such methods. Note that the rules for code</span>
<span class="sd"> stubs, are not checked in the checkValid function. Their correctness as code</span>
<span class="sd"> can be checked only on compilation/testing of the final API.</span>
<span class="sd">  For operations that return a value the code must set a parameter called</span>
<span class="sd">  &#39;result&#39; (or its language equivalent) to the desired value.</span>
<span class="sd">  As a matter of style single-input-parameter functions of &#39;other&#39; opType should</span>
<span class="sd">  have the parameter called &#39;value&#39;.</span>

<span class="sd"> - The ComplexDataType attribute constructorCodeStubs contains code stubs to</span>
<span class="sd">  add to the class constructor. The code stub is added after the end of object </span>
<span class="sd">  creation but before the validation check. It is intended to handle </span>
<span class="sd">  creation of mandatory child objects, and other operations that modify the</span>
<span class="sd">  data. It is not executed if isReading==True or override == True.</span>
<span class="sd">  Syntax as for MetaOperation code stubs. It is illegal for abstract </span>
<span class="sd">  ComplexDataTypes.</span>
<span class="sd">  postConstructorCode works like constructorCodeStubs but are</span>
<span class="sd">  executed at the end of the function, after notifiers and undo are called.</span>

<span class="sd"> - The MetaClass attribute destructorCodeStubs contains code stubs to</span>
<span class="sd">  add to the class destructor. The code is added during checking of which</span>
<span class="sd">  objects to delete, before any data are changed, and should not modify the data</span>
<span class="sd">  either. It is intended to constrain when objects may legally be deleted. </span>
<span class="sd">  Syntax as for MetaOperation code stubs. It is illegal for abstract </span>
<span class="sd">  Classes.</span>
<span class="sd">  postDestructorCode works like destructorCode, but is executed immediately </span>
<span class="sd">  before the object is actually deleted. It serves to make changes in other</span>
<span class="sd">  objects.</span>

<span class="sd"> - Operations with opTypes that are normally autogenerated may not have explicit</span>
<span class="sd"> parameters; Metaparameters in these cases are generated automatically.</span>
<span class="sd"> </span>
<span class="sd"> Optional parameters are those with cardinality 0..1. These can only be input</span>
<span class="sd"> parameters. If no explicit default value is given, the default is automatically</span>
<span class="sd"> set to None. Default parameters are stored as actual values (not strings).</span>
<span class="sd"> </span>
<span class="sd"> Parameters of collection type (hicard != 1) may be optional if a default </span>
<span class="sd"> value is provided. </span>
<span class="sd"> </span>
<span class="sd">#############################################################################</span>

<span class="sd"> Rules for code tagged values :</span>
<span class="sd"> </span>
<span class="sd"> Code stubs are used in Constraints, Operations and in ComplexDataTypes</span>
<span class="sd"> (constructor and destructor code). code stubs are always StringDicts.</span>
<span class="sd"> The dictionary key may consist of up to three parts, with a colon (&#39;:&#39;)</span>
<span class="sd"> as separator. The three parts are interpreted as </span>
<span class="sd"> &#39;language:implementation:variant&#39;</span>
<span class="sd"> The same rules are used for DataType.typeCodes</span>
<span class="sd"> </span>
<span class="sd">#############################################################################</span>

<span class="sd"> Derived classes:</span>
<span class="sd"> </span>
<span class="sd"> Derived classes are not stored, but are generated on the fly from information</span>
<span class="sd"> stored elsewhere, for compatibility or convenience. They were introduced to</span>
<span class="sd"> allow the ccp.molecule.MolStructure.Coord class to be used for compatibility</span>
<span class="sd"> after coordinate data were moved to matrices. </span>
<span class="sd"> Attributes and roles of a derived class, must be either derived or </span>
<span class="sd"> Implementation, except for the parent link and keys. </span>
<span class="sd"> The modeller must make handcoded operations for all link getters that get </span>
<span class="sd"> the class so that class instances are created at need. Also the factory </span>
<span class="sd"> creator function must be written to retrieve existing instances if present </span>
<span class="sd"> instead of creating new ones. Other functions related to the link are </span>
<span class="sd"> generated as normal, and will make use of the handcoded getter functions.</span>
<span class="sd"> </span>
<span class="sd">#############################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># imports:</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">TaggedValues</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">OpTypes</span>
<span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Constants</span> <span class="k">as</span> <span class="n">metaConstants</span>


<span class="n">infinity</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">infinity</span>
<span class="n">IntType</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">IntType</span>
<span class="n">StringType</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">StringType</span>
<span class="n">TupleType</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">TupleType</span>
<span class="n">sentinel</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">sentinel</span>
<span class="n">MemopsError</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">MemopsError</span>



<span class="c1"># Python 2.1 dual-use constants</span>

<span class="k">try</span><span class="p">:</span>
  <span class="n">junk</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="n">junk</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
  <span class="nb">globals</span><span class="p">()[</span><span class="s1">&#39;True&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="mi">0</span>
  <span class="nb">globals</span><span class="p">()[</span><span class="s1">&#39;False&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">True</span>

<span class="n">booleans</span> <span class="o">=</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

<div class="viewcode-block" id="transferGuid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.transferGuid">[docs]</a><span class="k">def</span> <span class="nf">transferGuid</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">targetContainer</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Make new guid for obj when copied into a new container, e.g.</span>
<span class="sd">  for inheriting down an element.</span>
<span class="sd">  guid is deterministic, being composed of object and container guid</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">return</span> <span class="s1">&#39;__&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">obj</span><span class="o">.</span><span class="n">guid</span><span class="p">,</span> <span class="n">targetContainer</span><span class="o">.</span><span class="n">guid</span><span class="p">))</span></div>


<span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># model comparison functions</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="compareModels"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.compareModels">[docs]</a><span class="k">def</span> <span class="nf">compareModels</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">,</span> <span class="n">elementPairings</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Compare two models assuming same guid means same element</span>
<span class="sd">  </span>
<span class="sd">  model1 and model2 may be either MetaModelElements or file names</span>
<span class="sd">  </span>
<span class="sd">  elementPairings are pairs of guids (model1, model2) that are set to</span>
<span class="sd">  be identical even though the guids differ. Necessary e.g. when an </span>
<span class="sd">  element is divided among subclasses, or several elements are merged in</span>
<span class="sd">  a new superclass.</span>
<span class="sd">  </span>
<span class="sd">  If ignoreImplicit implicit elements and the usename tag are ignored</span>
<span class="sd">  </span>
<span class="sd">  NBNB TBD May need reworking to allow for inherited-down elements</span>
<span class="sd">  (using originalGuid)</span>
<span class="sd">  </span>
<span class="sd">  Returns dictionary : {</span>
<span class="sd">  &#39;dict1&#39;:     &#39;guid:element&#39; dictionary for model 1</span>
<span class="sd">  &#39;dict2&#39;:     &#39;guid:element&#39; dictionary for model 2</span>
<span class="sd">  &#39;unique1:    set of elements found only in model1</span>
<span class="sd">  &#39;unique2:    set of elements found only in model2</span>
<span class="sd">  &#39;differ&#39;:    dictionary of &#39;guid:list-of-tag&#39; of </span>
<span class="sd">               which tags differ for which guids</span>
<span class="sd">  &#39;namematch&#39;: dictionary of &#39;qualifiedName:list-of-tag&#39; of</span>
<span class="sd">               which tags differ for unique objects with identical names</span>
<span class="sd">               but different guids</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

  <span class="c1"># check for identical models</span>
  <span class="n">top1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">topPackage</span><span class="p">()</span>
  <span class="n">top2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">topPackage</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">top1</span> <span class="ow">is</span> <span class="n">top2</span><span class="p">:</span>
    <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> are from the same model&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="n">model2</span><span class="p">))</span>

  <span class="c1"># set up</span>
  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">dict1</span> <span class="o">=</span> <span class="n">makeObjDict</span><span class="p">(</span><span class="n">top1</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="p">)</span>
  <span class="n">result</span><span class="p">[</span><span class="s1">&#39;dict1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">dict2</span> <span class="o">=</span> <span class="n">makeObjDict</span><span class="p">(</span><span class="n">top2</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="p">)</span>
  <span class="n">result</span><span class="p">[</span><span class="s1">&#39;dict2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">differ</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;differ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">namematch</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;namematch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">unique1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

  <span class="c1"># check elementPairings</span>
  <span class="n">dicts</span> <span class="o">=</span> <span class="p">(</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">elementPairings</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">guids</span> <span class="ow">in</span> <span class="n">elementPairings</span><span class="p">:</span>

      <span class="c1"># check element pairs are consistent with models</span>
      <span class="c1"># NB simply skip if there is a mismatch - we may have a valid  pair where one of the</span>
      <span class="c1"># halves have been deleted in a later model</span>
      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ii</span>
        <span class="n">guid</span> <span class="o">=</span> <span class="n">guids</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">guid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">[</span><span class="n">ii</span><span class="p">]:</span>
          <span class="c1"># raise MemopsError(</span>
          <span class="c1">#   &quot;%s from elementPairings not found in model %s &quot; % (guid, ii))</span>
          <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;WARNING from compareModels: </span><span class="si">%s</span><span class="s2"> from elementPairings not found in model </span><span class="si">%s</span><span class="s2"> &quot;</span>
                 <span class="o">%</span> <span class="p">(</span><span class="n">guid</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
          <span class="k">break</span>
        <span class="k">if</span> <span class="n">guid</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">[</span><span class="n">jj</span><span class="p">]:</span>
          <span class="c1"># raise MemopsError(</span>
          <span class="c1">#   &quot;%s (%s) from elementPairings found in model %s &quot; % (</span>
          <span class="c1">#     guid, dicts[jj][guid], jj))</span>
          <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;WARNING from compareModels: </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) from elementPairings found in model </span><span class="si">%s</span><span class="s2"> &quot;</span>
                 <span class="o">%</span> <span class="p">(</span><span class="n">guid</span><span class="p">,</span> <span class="n">dicts</span><span class="p">[</span><span class="n">jj</span><span class="p">][</span><span class="n">guid</span><span class="p">],</span> <span class="n">ii</span><span class="p">))</span>
          <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>

        <span class="c1"># check diffs and append</span>
        <span class="n">diffs</span> <span class="o">=</span> <span class="n">compareElements</span><span class="p">(</span><span class="n">dict1</span><span class="p">[</span><span class="n">guids</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">guids</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                <span class="n">ignoreImplicit</span><span class="o">=</span><span class="n">ignoreImplicit</span><span class="p">)</span>
        <span class="n">differ</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">guids</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">guids</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">diffs</span><span class="p">))</span>

    <span class="c1"># clean element dicts</span>
    <span class="k">for</span> <span class="n">guids</span> <span class="ow">in</span> <span class="n">elementPairings</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dicts</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">guids</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>

  <span class="c1"># compare models</span>
  <span class="k">for</span> <span class="n">guid</span><span class="p">,</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">qName</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span>
    <span class="n">ee2</span> <span class="o">=</span> <span class="n">dict2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">guid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ee2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># no match</span>
      <span class="n">unique1</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># same guid found in both models</span>
      <span class="k">del</span> <span class="n">dict2</span><span class="p">[</span><span class="n">guid</span><span class="p">]</span>

      <span class="c1"># compare elements</span>
      <span class="n">diffs</span> <span class="o">=</span> <span class="n">compareElements</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">ee2</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="o">=</span><span class="n">ignoreImplicit</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">diffs</span><span class="p">:</span>
        <span class="n">differ</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ee</span><span class="o">.</span><span class="n">guid</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">guid</span><span class="p">,</span> <span class="n">diffs</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ee</span><span class="o">.</span><span class="n">guid</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING </span><span class="si">%s</span><span class="s1"> has no guid&#39;</span> <span class="o">%</span> <span class="n">ee</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">)</span>

    <span class="c1"># check for name matches</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">ee2b</span> <span class="o">=</span> <span class="n">top2</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="n">qName</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">ee2b</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">ee2b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">ee2b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ee2</span><span class="p">:</span>
      <span class="c1"># name match without guid match</span>
      <span class="n">diffs</span> <span class="o">=</span> <span class="n">compareElements</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">ee2b</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="o">=</span><span class="n">ignoreImplicit</span><span class="p">)</span>
      <span class="n">diffs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>
      <span class="n">namematch</span><span class="p">[</span><span class="n">qName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">diffs</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">guid</span><span class="p">,</span> <span class="n">ee2b</span><span class="o">.</span><span class="n">guid</span><span class="p">)</span>

  <span class="c1"># complete result and return</span>
  <span class="n">result</span><span class="p">[</span><span class="s1">&#39;unique1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unique1</span>
  <span class="n">result</span><span class="p">[</span><span class="s1">&#39;unique2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

  <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">&#39;End comparing models, time used </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

  <span class="c1">#</span>
  <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="compareElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.compareElements">[docs]</a><span class="k">def</span> <span class="nf">compareElements</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">ee2</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; compare two MetaModelElements. Returns list of tags that differ.</span>
<span class="sd">  Language-specific values are only compared for language &#39;language&#39;</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># tagged values that are skipped as irrelevant</span>
  <span class="n">ignoreTagVals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;repositoryTag&#39;</span><span class="p">,</span> <span class="s1">&#39;repositoryId&#39;</span><span class="p">,</span> <span class="s1">&#39;docDiagramNames&#39;</span><span class="p">,</span> <span class="s1">&#39;packageGroup&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;isDraft&#39;</span><span class="p">,</span> <span class="s1">&#39;isReferenceData&#39;</span><span class="p">])</span>

  <span class="c1"># dictionaries with language</span>
  <span class="n">languageCoded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;typeCodes&#39;</span><span class="p">,</span> <span class="s1">&#39;codeStubs&#39;</span><span class="p">,</span> <span class="s1">&#39;constructorCodeStubs&#39;</span><span class="p">,</span> <span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">,</span><span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">])</span>

  <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

  <span class="n">clazz</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">__class__</span>
  <span class="k">if</span> <span class="n">ee2</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">clazz</span><span class="p">:</span>

    <span class="n">elems</span> <span class="o">=</span> <span class="p">[</span><span class="n">ee</span><span class="p">,</span> <span class="n">ee2</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pData</span> <span class="ow">in</span> <span class="n">clazz</span><span class="o">.</span><span class="n">parameterData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

      <span class="c1"># set up</span>
      <span class="n">hicard</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hicard&#39;</span><span class="p">)</span>
      <span class="n">pType</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
        <span class="k">continue</span>

      <span class="k">if</span> <span class="n">ignoreImplicit</span> <span class="ow">and</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;usename&#39;</span><span class="p">:</span>
        <span class="k">continue</span>

      <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">tag</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">hicard</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isLink&#39;</span><span class="p">):</span>
            <span class="c1"># NB the &#39;and&#39; guards against x being None</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">((</span><span class="n">vals</span> <span class="ow">and</span> <span class="n">vals</span><span class="o">.</span><span class="n">guid</span><span class="p">),)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="n">vals</span><span class="p">,)</span>

        <span class="k">elif</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isLink&#39;</span><span class="p">):</span>
          <span class="c1"># multilink - sort before comparison</span>
          <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">guid</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
          <span class="n">vals</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

      <span class="c1"># modify tagged values to remove irrelevant differences:</span>
      <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;taggedValues&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
          <span class="n">dd</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">ignoreTagVals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">dd</span><span class="p">:</span>
              <span class="k">del</span> <span class="n">dd</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span>

      <span class="c1"># compare values - language-specific codes</span>
      <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">languageCoded</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">)</span> <span class="o">==</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
          <span class="k">continue</span>

      <span class="c1"># do compare</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
          <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">break</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="c1"># elements are from different classes</span>
    <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ee</span><span class="o">.</span><span class="n">guid</span> <span class="o">!=</span> <span class="n">ee2</span><span class="o">.</span><span class="n">guid</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;guid&#39;</span><span class="p">)</span>


  <span class="c1">#</span>
  <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="makeObjDict"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.makeObjDict">[docs]</a><span class="k">def</span> <span class="nf">makeObjDict</span><span class="p">(</span><span class="n">rootElement</span><span class="p">,</span> <span class="n">ignoreImplicit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">crucialOnly</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; make a guid:element dictionary</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">rootElement</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">crucialOnly</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">MetaOperation</span><span class="p">):</span>
      <span class="k">continue</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ignoreImplicit</span> <span class="ow">and</span> <span class="n">ee</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">):</span>
      <span class="n">result</span><span class="p">[</span><span class="n">ee</span><span class="o">.</span><span class="n">guid</span><span class="p">]</span> <span class="o">=</span> <span class="n">ee</span>
      <span class="n">ll</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span> <span class="n">ConstrainedElement</span><span class="p">):</span>
        <span class="n">ll</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
  <span class="c1">#</span>
  <span class="k">return</span> <span class="n">result</span></div>


<span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># consistency checking functions</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="finaliseMetaClass"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.finaliseMetaClass">[docs]</a><span class="k">def</span> <span class="nf">finaliseMetaClass</span><span class="p">(</span><span class="n">clazz</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Enforces  some of the design rules for MetaClasses and their parameters,</span>
<span class="sd">  and sets some derived parameter attributes</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># lists of supported values</span>
  <span class="n">allowedParTags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span>
                    <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">TupleType</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                    <span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span> <span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span>
                    <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span> <span class="s1">&#39;isLink&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span> <span class="p">}</span>

  <span class="n">miscParTypes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">)</span>

  <span class="n">pythonParTypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">StringType</span><span class="p">,</span> <span class="n">IntType</span><span class="p">)</span>

  <span class="n">unTypedPars</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">MetaDataType</span><span class="p">,</span> <span class="s1">&#39;enumeration&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">MetaAttribute</span><span class="p">,</span> <span class="s1">&#39;defaultValue&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">MetaParameter</span><span class="p">,</span> <span class="s1">&#39;defaultValue&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">MetaConstant</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">),</span>
  <span class="p">)</span>

  <span class="k">for</span> <span class="n">pName</span><span class="p">,</span> <span class="n">pData</span> <span class="ow">in</span> <span class="n">clazz</span><span class="o">.</span><span class="n">parameterData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="c1"># check parameter tags and value types</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

      <span class="k">try</span><span class="p">:</span>
        <span class="n">parType</span> <span class="o">=</span> <span class="n">allowedParTags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: illegal tag </span><span class="si">%s</span><span class="s2"> for parameter </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pName</span><span class="p">))</span>

      <span class="k">if</span> <span class="n">parType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">parType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: tag </span><span class="si">%s</span><span class="s2"> for parameter </span><span class="si">%s</span><span class="s2"> has illegal value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pName</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

      <span class="c1"># special checks</span>


    <span class="c1"># Booleans</span>
    <span class="k">if</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isFixed&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">):</span>
      <span class="c1"># NBNB we use sentinel to check that there is a value in the dictionaru</span>
      <span class="c1"># We can not use &#39;in pData&#39;, because we must conform to Python 2.1</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: tag isFixed for parameter </span><span class="si">%s</span><span class="s2"> has illegal value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pName</span><span class="p">,</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isFixed&#39;</span><span class="p">)))</span>

    <span class="c1"># &#39;type&#39; tag</span>
    <span class="n">myType</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nameList&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">myType</span> <span class="o">!=</span> <span class="s1">&#39;content&#39;</span> <span class="ow">or</span> <span class="n">pName</span> <span class="o">==</span> <span class="s1">&#39;constraints&#39;</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: parameter </span><span class="si">%s</span><span class="s2"> is not standard content but has &#39;namelist&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pName</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">myType</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="n">pName</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unTypedPars</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: parameter </span><span class="si">%s</span><span class="s2"> has no explicit type &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pName</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">myType</span> <span class="ow">in</span> <span class="n">miscParTypes</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">myType</span> <span class="o">==</span> <span class="s1">&#39;StringDict&#39;</span> <span class="ow">and</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hicard&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: tag </span><span class="si">%s</span><span class="s2"> for parameter </span><span class="si">%s</span><span class="s2"> is StringDict but has hicard </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pName</span><span class="p">,</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hicard&#39;</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">myType</span> <span class="ow">in</span> <span class="n">pythonParTypes</span><span class="p">:</span>
      <span class="k">pass</span>

    <span class="k">elif</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">myType</span><span class="p">,</span> <span class="n">MetaModelElement</span><span class="p">):</span>
      <span class="n">pData</span><span class="p">[</span><span class="s1">&#39;isLink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>



    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: parameter </span><span class="si">%s</span><span class="s2"> has unsupported type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">clazz</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pName</span><span class="p">,</span> <span class="n">myType</span><span class="p">))</span></div>


<span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># classes</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="MetaModelElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement">[docs]</a><span class="k">class</span> <span class="nc">MetaModelElement</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Base class for all MetaModel elements</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1"># input parameters</span>

    <span class="c1"># NB container type must be set outside class definition</span>
    <span class="s1">&#39;container&#39;</span><span class="p">:{},</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;usename&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;getUsename&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">},</span>
    <span class="s1">&#39;guid&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;documentation&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;taggedValues&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span>
    <span class="s1">&#39;isImplicit&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
  <span class="p">}</span>

  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaModelElement&#39;</span><span class="p">]</span>

  <span class="c1"># attribute used for guid uniqueness check</span>
  <span class="n">guidDict</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; getattr.</span>
<span class="sd">    There are four classes of gettable attributes</span>
<span class="sd">    1) Those stored in the __dict__, where this functions is not called</span>
<span class="sd">       This includes those that start with &#39;__&#39; and have their names mangled.</span>
<span class="sd">       These may or may not have a parameterData record</span>
<span class="sd">    2) Those with a getterFunc</span>
<span class="sd">    3) Those with type == &#39;content&#39;, that are stored in the elementDict</span>
<span class="sd">    4) Collections and dictionaries that are stored in the __dataDict and are </span>
<span class="sd">       copied on exit</span>
<span class="sd">       </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="n">pData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> object has no attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="c1"># defined attribute</span>
    <span class="n">getterFunc</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;getterFunc&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">getterFunc</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">getterFunc</span><span class="p">)()</span>

    <span class="k">elif</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;constraints&#39;</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="n">ll</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># get named elements from elementDict</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__elementDict</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pData</span><span class="p">[</span><span class="s1">&#39;namelist&#39;</span><span class="p">])]</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="n">tag</span><span class="p">])</span>
      <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> object </span><span class="si">%s</span><span class="s2"> has no attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">tag</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

    <span class="n">pData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pData</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># non-defined parameters</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># check parameter type</span>
      <span class="n">pType</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
      <span class="n">hicard</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hicard&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">setterFunc</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">setterFunc</span> <span class="o">==</span> <span class="s1">&#39;unsettable&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Tried to set implementation attribute </span><span class="si">%s</span><span class="s2"> in class </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

      <span class="k">elif</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Tried to set content attribute </span><span class="si">%s</span><span class="s2"> in class </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

      <span class="k">elif</span> <span class="n">setterFunc</span><span class="p">:</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">setterFunc</span><span class="p">)(</span><span class="n">value</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;StringDict&#39;</span><span class="p">:</span>
        <span class="c1"># copy to avoid sharing internal objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># copy to avoid sharing internal objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; basic init. NB only parameters with parameterData records can be set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set up</span>
    <span class="n">parameterData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span>

    <span class="c1"># Set implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__elementDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_tempData</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># check attributes necessary for normal error handling</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Tried to create </span><span class="si">%s</span><span class="s2"> without a name&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">)</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span>
        <span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">rootPackageName</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Tried to create </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> without a container&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>

    <span class="c1"># set parameters</span>
    <span class="c1"># set order (name and container needed for error handling)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parameterData</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">ll</span>
    <span class="c1"># set values</span>
    <span class="n">nFound</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">val</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
        <span class="n">nFound</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">pData</span> <span class="o">=</span> <span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;unsettable&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1"># check for undefined parameters</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">-</span> <span class="n">nFound</span>
    <span class="k">if</span> <span class="n">nn</span><span class="p">:</span>
      <span class="n">ll2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">: Input parameters contained </span><span class="si">%s</span><span class="s2"> undefined names:</span>
<span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">ll2</span><span class="p">))</span>

    <span class="c1"># set link from container</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
    <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MetaConstraint</span><span class="p">):</span>
        <span class="n">containerDict</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">containerDict</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">__elementDict</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">containerDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> already has </span><span class="si">%s</span><span class="s2"> named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">containerDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>


  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; give ID string for MetaModelElement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

<div class="viewcode-block" id="MetaModelElement.qualifiedName"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.qualifiedName">[docs]</a>  <span class="k">def</span> <span class="nf">qualifiedName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get qualified name of MetaElement relative to topmost package (&#39;root&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">container</span>

    <span class="c1"># special case: RootPackage</span>
    <span class="k">if</span> <span class="n">cc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># normal cases</span>
    <span class="k">while</span> <span class="n">cc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ee</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="n">ee</span> <span class="o">=</span> <span class="n">cc</span>
      <span class="n">cc</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">container</span>

    <span class="n">ll</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaModelElement.getUsename"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.getUsename">[docs]</a>  <span class="k">def</span> <span class="nf">getUsename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;getter for semiderived attribute usename</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;usename&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="MetaModelElement.metaObjFromQualName"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.metaObjFromQualName">[docs]</a>  <span class="k">def</span> <span class="nf">metaObjFromQualName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; find MetaObject given qualified name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">namePath</span> <span class="o">=</span> <span class="n">qname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>

    <span class="c1"># find result</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topPackage</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">namePath</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;No MetaObject corresponding to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">qname</span><span class="p">)</span>

    <span class="c1"># final step - account for MetaConstraints</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">namePath</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ConstrainedElement</span><span class="p">):</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;No MetaObject corresponding to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">qname</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MetaModelElement.topPackage"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.topPackage">[docs]</a>  <span class="k">def</span> <span class="nf">topPackage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; return root package (topmost container)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">while</span> <span class="n">result</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">container</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MetaModelElement.addTaggedValue"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.addTaggedValue">[docs]</a>  <span class="k">def</span> <span class="nf">addTaggedValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add tagged value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> tagged value tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> tagged value </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="n">allowedTags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allowedTags</span>
    <span class="n">allowedVals</span> <span class="o">=</span> <span class="n">allowedTags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">allowedVals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">allowedVals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowedVals</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> tag </span><span class="si">%s</span><span class="s2"> has illegal value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="s1">&#39;taggedValues&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaModelElement.removeTaggedValue"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.removeTaggedValue">[docs]</a>  <span class="k">def</span> <span class="nf">removeTaggedValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing tagged value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="s1">&#39;taggedValues&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataDict</span><span class="p">[</span><span class="s1">&#39;taggedValues&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no tagged value </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaModelElement.canAccess"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.canAccess">[docs]</a>  <span class="k">def</span> <span class="nf">canAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; check if target is accessible from self</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pp1</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pp1</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">):</span>
      <span class="n">pp1</span> <span class="o">=</span> <span class="n">pp1</span><span class="o">.</span><span class="n">container</span>

    <span class="n">pp2</span> <span class="o">=</span> <span class="n">target</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pp2</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">):</span>
      <span class="n">pp2</span> <span class="o">=</span> <span class="n">pp2</span><span class="o">.</span><span class="n">container</span>

    <span class="k">if</span> <span class="n">pp1</span> <span class="ow">is</span> <span class="n">pp2</span> <span class="ow">or</span> <span class="n">pp2</span> <span class="ow">in</span> <span class="n">pp1</span><span class="o">.</span><span class="n">importedPackages</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">False</span></div>

  <span class="k">def</span> <span class="nf">_getCloningDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get dictionary of parameters as input for making</span>
<span class="sd">    a copy of self.</span>
<span class="sd">    </span>
<span class="sd">    NB called from subclasses but should not be called from the outside</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">pName</span><span class="p">,</span> <span class="n">pData</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">parameterData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

      <span class="k">if</span> <span class="n">pName</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">):</span>
        <span class="k">pass</span>

      <span class="k">elif</span> <span class="p">(</span><span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span> <span class="ow">or</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s1">&#39;setterFunc&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;unsettable&#39;</span><span class="p">):</span>
        <span class="k">pass</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">pName</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pName</span><span class="p">)</span>

    <span class="n">tagVals</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;taggedValues&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tagVals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;originalGuid&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">tagVals</span><span class="p">[</span><span class="s1">&#39;originalGuid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guid</span>

    <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="MetaModelElement.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaModelElement.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid. Recursively checks contents</span>
<span class="sd">    Includes general attribute checks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
    <span class="k">if</span> <span class="n">container</span><span class="p">:</span>
      <span class="c1"># container link check</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MetaConstraint</span><span class="p">):</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">__elementDict</span>
      <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way container link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (1)?&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="c1"># general parameter checks</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">pData</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

      <span class="c1"># set up</span>
      <span class="n">pType</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
      <span class="n">enumeration</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enumeration&#39;</span><span class="p">)</span>

      <span class="c1"># unsettable (implementation) parameters</span>
      <span class="k">if</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
        <span class="k">continue</span>

      <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

      <span class="c1"># default values</span>
      <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">):</span>
        <span class="c1"># Always OK.</span>
        <span class="c1"># This check takes care of fixed parameters, </span>
        <span class="c1"># optional attributes that are set to None, etc.</span>
        <span class="k">continue</span>

      <span class="k">elif</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isFixed&#39;</span><span class="p">):</span>
        <span class="c1"># check fixed parameters</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - wrong value </span><span class="si">%s</span><span class="s2"> for fixed attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

      <span class="c1"># string dictionaries</span>
      <span class="k">if</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;StringDict&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">StringType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-string or empty key </span><span class="si">%s</span><span class="s2"> in StringDict </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">val</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">StringType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-string or empty value </span><span class="si">%s</span><span class="s2"> in StringDict </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
        <span class="k">continue</span>

      <span class="c1"># single or list (for further processing):</span>
      <span class="n">hicard</span> <span class="o">=</span> <span class="n">pData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hicard&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>

      <span class="k">elif</span> <span class="n">hicard</span> <span class="o">!=</span> <span class="n">infinity</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">hicard</span><span class="p">:</span>
        <span class="c1"># hicard check</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> - more than </span><span class="si">%s</span><span class="s2"> elements in value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">hicard</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


      <span class="c1"># Booleans and other enumerated types</span>
      <span class="k">if</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;Boolean&#39;</span><span class="p">:</span>
        <span class="n">enumeration</span> <span class="o">=</span> <span class="n">booleans</span>

      <span class="k">if</span> <span class="n">enumeration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> not among allowed values&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">continue</span>

      <span class="c1"># string types</span>
      <span class="k">if</span> <span class="n">pType</span> <span class="o">==</span> <span class="n">StringType</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">StringType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> is empty or not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

      <span class="k">elif</span> <span class="n">pType</span> <span class="o">==</span> <span class="s1">&#39;Token&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">StringType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> is empty or not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
          <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">validNameChars</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> contains illegal character </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">char</span><span class="p">))</span>

          <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> starts with a digit&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

      <span class="c1"># special exception - supertype of MemopsObject</span>
      <span class="k">elif</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;supertypes&#39;</span><span class="p">,</span> <span class="s1">&#39;supertype&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;MemopsObject&#39;</span><span class="p">:</span>
        <span class="k">pass</span>

        <span class="c1"># special exception - supertype of MemopsObject</span>
      <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;subtypes&#39;</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ComplexDataType&#39;</span><span class="p">:</span>
        <span class="k">pass</span>

        <span class="c1"># other cases:</span>
      <span class="k">elif</span> <span class="n">pType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">pType</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> should be type </span><span class="si">%s</span><span class="s2"> for attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pType</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="c1"># specific checks for MetaModelElement attributes      </span>

    <span class="c1"># name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
      <span class="c1"># autogenerated elements can be assumed to be OK</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">underscore</span> <span class="ow">and</span>
          <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">id_attribute</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">lastid_attribute</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: name </span><span class="si">%s</span><span class="s2"> of non-implicit element starts with &#39;_&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">underscore</span> <span class="ow">in</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                                 <span class="n">MetaOperation</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">MetaConstraint</span><span class="p">)):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> contains underscore&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check correct guid format</span>
    <span class="n">guid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guid</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s2">&quot;&quot;&quot;&amp;&#39;&quot;&lt;&gt;&quot;&quot;&quot;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">guid</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: guid </span><span class="si">%s</span><span class="s2"> contains illegal character </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">guid</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">char</span><span class="p">)))</span>
    <span class="c1"># check guid uniqueness</span>
    <span class="n">guidDict</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">guidDict</span>
    <span class="k">if</span> <span class="n">guidDict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">competitor</span> <span class="o">=</span> <span class="n">guidDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">guid</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">competitor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: guid </span><span class="si">%s</span><span class="s2"> duplicates guid of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guid</span><span class="p">,</span> <span class="n">competitor</span><span class="p">))</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="n">guidDict</span><span class="p">[</span><span class="n">guid</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

      <span class="c1"># _tempData dictionary</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempData</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - _tempData dictionary is not emptied, keys are </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempData</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>


    <span class="c1"># recursive contents check:</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__elementDict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way container link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (2)?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span></div></div>

<span class="c1"># NB required as class is not defined inside itself</span>
<span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaModelElement</span>

<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="ConstrainedElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ConstrainedElement">[docs]</a><span class="k">class</span> <span class="nc">ConstrainedElement</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for elements </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>

  <span class="c1"># implementation parameters</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">}</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;ConstrainedElement&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">ConstrainedElement</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Attempt to create istance of abstract class ConstrainedElement&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__constraints</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Set implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;constraints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="ConstrainedElement.getAllConstraints"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ConstrainedElement.getAllConstraints">[docs]</a>  <span class="k">def</span> <span class="nf">getAllConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Not really necessary here, but in some subclasses it is overridden.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span></div>

<div class="viewcode-block" id="ConstrainedElement.getConstraint"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ConstrainedElement.getConstraint">[docs]</a>  <span class="k">def</span> <span class="nf">getConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get contraint by name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConstrainedElement.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ConstrainedElement.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># validity check constraints</span>
    <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__constraints</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">constraint</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">constraint</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way container link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (3)?&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="HasParameters"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasParameters">[docs]</a><span class="k">class</span> <span class="nc">HasParameters</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for elements that have parameters , </span>
<span class="sd">  i.e. MetaOperations and MetaExceptions</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;parameters&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_HasParameters__parameterNames&#39;</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;visibility&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">visibility_enumeration</span><span class="p">,</span>
                                      <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">public_visibility</span><span class="p">,</span>
                                      <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;HasParameters&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">HasParameters</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Attempt to create istance of abstract class HasParameters&quot;</span><span class="p">)</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__parameterNames</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="HasParameters.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasParameters.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span></div></div>


<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="HasSupertype"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype">[docs]</a><span class="k">class</span> <span class="nc">HasSupertype</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot; Abstract class to provide supertype/subtype functionality</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
      <span class="s2">&quot;Attempt to create istance of abstract class HasSupertype&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="HasSupertype.getSupertype"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.getSupertype">[docs]</a>  <span class="k">def</span> <span class="nf">getSupertype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get supertype (derived attribute)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="HasSupertype.setSupertypes"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.setSupertypes">[docs]</a>  <span class="k">def</span> <span class="nf">setSupertypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertypes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; setter for link supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># first clean up</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;supertypes&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># then reset internal list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># now put in data</span>
    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">supertypes</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addSupertype</span><span class="p">(</span><span class="n">supertype</span><span class="p">)</span></div>

<div class="viewcode-block" id="HasSupertype.removeSupertype"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.removeSupertype">[docs]</a>  <span class="k">def</span> <span class="nf">removeSupertype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; remove supertype/subtypes link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">ll</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">supertype</span><span class="p">)</span>
      <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Attempt to remove non-existing supertype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">))</span></div>

<div class="viewcode-block" id="HasSupertype.addSupertype"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.addSupertype">[docs]</a>  <span class="k">def</span> <span class="nf">addSupertype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; add supertype/subtypes link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">supertype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">ll</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">supertype</span><span class="p">)</span>
      <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Attempt to add pre-existing supertype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">))</span></div>

<div class="viewcode-block" id="HasSupertype.getAllSupertypes"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.getAllSupertypes">[docs]</a>  <span class="k">def</span> <span class="nf">getAllSupertypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; recursively get list of self and all its supertypes</span>
<span class="sd">    self is the first element of the list.</span>
<span class="sd">    Search is depth-first and repects order of individual supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lists</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">self</span><span class="p">]]</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">indices</span><span class="p">:</span>
      <span class="n">ind</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">obj</span> <span class="o">=</span> <span class="n">lists</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span>

      <span class="c1"># handling of diamond inheritance - python style</span>
      <span class="c1"># A class is included only in the last place it appears</span>
      <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

      <span class="n">ind</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">ind</span><span class="p">:</span>
        <span class="n">indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ind</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">lists</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>

      <span class="n">ll</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>
        <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ll</span><span class="p">))</span>

    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="HasSupertype.getAllSubtypes"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.getAllSubtypes">[docs]</a>  <span class="k">def</span> <span class="nf">getAllSubtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; recursively get list of self and all its subtypes</span>
<span class="sd">    self is the first element of the list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">])</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="HasSupertype.getNonAbstractSubtypes"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.getNonAbstractSubtypes">[docs]</a>  <span class="k">def</span> <span class="nf">getNonAbstractSubtypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; recursively get list of self and all its non-abstract subtypes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">ll</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ll</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">]</span></div>

<div class="viewcode-block" id="HasSupertype.getAllElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.HasSupertype.getAllElements">[docs]</a>  <span class="k">def</span> <span class="nf">getAllElements</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clazz</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; utility function - to get all elements, possibly only of a given type</span>
<span class="sd">    </span>
<span class="sd">    NB should be private in languages that support the concept.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>
    <span class="n">ll</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># get all elements</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">elements</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="p">)</span>

    <span class="c1"># return sorted list</span>
    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">clazz</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">clazz</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="AbstractDataType"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractDataType">[docs]</a><span class="k">class</span> <span class="nc">AbstractDataType</span><span class="p">(</span><span class="n">ConstrainedElement</span><span class="p">,</span> <span class="n">HasSupertype</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for abstract data types </span>
<span class="sd">  (classes, simple and complex dataypes) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;isRoot&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;isLeaf&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;isAbstract&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;visibility&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">visibility_enumeration</span><span class="p">,</span>
                   <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">public_visibility</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;supertype&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span> <span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;getSupertype&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;supertypes&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;setSupertypes&#39;</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;subtypes&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;AbstractDataType&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">AbstractDataType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Attempt to create istance of abstract class AbstractDataType&quot;</span><span class="p">)</span>

    <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># implementation attributes</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subtypes&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;supertypes&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="AbstractDataType.getConstraint"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractDataType.getConstraint">[docs]</a>  <span class="k">def</span> <span class="nf">getConstraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get constraint called name</span>
<span class="sd">    Return None if nothing found</span>
<span class="sd">    </span>
<span class="sd">    Recursively search supertypes till you find constraint</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="AbstractDataType.getAllConstraints"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractDataType.getAllConstraints">[docs]</a>  <span class="k">def</span> <span class="nf">getAllConstraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get all constraints, including those from supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">allSupertypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>
    <span class="n">allSupertypes</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">:</span>
      <span class="n">constraints</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">supertype</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="p">)</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constraints</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="n">ll</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">]</span></div>

<div class="viewcode-block" id="AbstractDataType.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractDataType.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isRoot</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">supertypes</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is root but has supertypes&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supertypes</span><span class="p">:</span>

      <span class="c1"># abstract class cannot have non-abstract supertype</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">supertype</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Abstract </span><span class="si">%s</span><span class="s2"> has non-abstract supertype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">))</span>

      <span class="c1"># package access check</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">supertype</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access supertype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">))</span>

      <span class="c1"># check two-way link</span>
      <span class="k">if</span> <span class="n">complete</span><span class="p">:</span>
        <span class="c1"># NB check is too slow to be done routinely</span>
        <span class="k">if</span> <span class="n">supertype</span><span class="o">.</span><span class="n">subtypes</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Two-way supertype link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (1)?&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">supertype</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="c1"># check that abstract classes have subclasses</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNonAbstractSubtypes</span><span class="p">():</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING - </span><span class="si">%s</span><span class="s2">: abstract type lacks non-abstract subtypes&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="n">subtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtypes</span>

    <span class="c1"># leaf cannot have subtypes</span>
    <span class="k">if</span> <span class="n">subtypes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLeaf</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is leaf but has subtypes&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># name style</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">uppercase</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with upper case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check two-way link</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">subtypes</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">supertypes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way supertype link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (2)?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="AbstractValue"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractValue">[docs]</a><span class="k">class</span> <span class="nc">AbstractValue</span><span class="p">(</span><span class="n">ConstrainedElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for abstract values (parameters, attributes, and roles) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;locard&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;hicard&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isOrdered&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isUnique&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;AbstractValue&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">AbstractValue</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Attempt to create istance of abstract class AbstractValue&quot;</span><span class="p">)</span>

    <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="AbstractValue.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.AbstractValue.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ConstrainedElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># limits to locard and hicard</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: locard </span><span class="si">%s</span><span class="s2"> &lt; 0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="n">infinity</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard </span><span class="si">%s</span><span class="s2"> &lt; 1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span><span class="p">))</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard </span><span class="si">%s</span><span class="s2"> &lt; locard </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">))</span>

    <span class="c1"># check unique and ordered NBNB TBD more rules to be added later, </span>
    <span class="c1"># maybe elsewhere</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;isOrdered&#39;</span><span class="p">,</span> <span class="s1">&#39;isUnique&#39;</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">default</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> must be </span><span class="si">%s</span><span class="s2"> for hicard==1&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">default</span><span class="p">))</span>

    <span class="c1"># name style</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">lowercase</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with lower case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="ClassElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ClassElement">[docs]</a><span class="k">class</span> <span class="nc">ClassElement</span><span class="p">(</span><span class="n">AbstractValue</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class class elements (attributes and roles) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">AbstractValue</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;visibility&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                                      <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">visibility_enumeration</span><span class="p">,</span>
                                      <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">public_visibility</span><span class="p">,</span>
                                      <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isAbstract&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;changeability&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">changeability_enumeration</span><span class="p">,</span>
                                         <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">changeable</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isDerived&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isImplementation&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;isAutomatic&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;baseName&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">AbstractValue</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;ClassElement&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="n">ClassElement</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;Attempt to create istance of abstract class ClassElement&quot;</span><span class="p">)</span>

    <span class="n">AbstractValue</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

<div class="viewcode-block" id="ClassElement.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ClassElement.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeObjName</span><span class="p">]))</span>

    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">baseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseName</span>

    <span class="c1"># check name length</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxTagLength</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: name </span><span class="si">%s</span><span class="s2"> longer than </span><span class="si">%s</span><span class="s2"> characters&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxTagLength</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxTagLength</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: baseName </span><span class="si">%s</span><span class="s2"> longer than </span><span class="si">%s</span><span class="s2"> characters&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">baseName</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxTagLength</span><span class="p">))</span>

    <span class="n">AbstractValue</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># check changeability</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">add_only</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: changeability </span><span class="si">%s</span><span class="s2"> not implemented yet&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span><span class="p">))</span>

    <span class="c1"># check baseName usage.</span>

    <span class="k">if</span> <span class="n">baseName</span> <span class="o">!=</span> <span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> hicard is 1 but baseName </span><span class="si">%s</span><span class="s2"> differs from name </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># give warning for dissimilar name and basename:</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="n">nn</span><span class="p">]</span> <span class="o">!=</span> <span class="n">baseName</span><span class="p">[:</span><span class="n">nn</span><span class="p">]:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, </span><span class="si">%s</span><span class="s2"> baseName </span><span class="si">%s</span><span class="s2"> dissimilar to name </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>


    <span class="c1"># get temporary info for operations (avoids repeated getattr calls</span>
    <span class="n">tempOpInfo</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">getAllOperations</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="bp">self</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">opSubType</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">tempOpInfo</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">op</span><span class="o">.</span><span class="n">opType</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">))</span>

    <span class="c1"># check derived elements:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span><span class="p">:</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is both derived and automatic&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is both derived and Implementation&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="c1"># check for getter:</span>
      <span class="n">getters</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tempOpInfo</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;get&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">getters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;derived </span><span class="si">%s</span><span class="s2"> lacks getFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">elif</span> <span class="n">getters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;derived </span><span class="si">%s</span><span class="s2"> lacks explicit getFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="c1"># check for setter</span>
      <span class="n">setters</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tempOpInfo</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">]</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">setters</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;derived unchangeable </span><span class="si">%s</span><span class="s2"> has setFunction&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

      <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">setters</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;derived changeable </span><span class="si">%s</span><span class="s2"> lacks setFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">setters</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;derived changeable </span><span class="si">%s</span><span class="s2"> lacks explicit setFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check implementation elements:</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">:</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is both automatic and Implementation&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="c1"># check for getter:</span>
      <span class="n">getters</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tempOpInfo</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;get&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
      <span class="k">if</span> <span class="n">getters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Implementation </span><span class="si">%s</span><span class="s2"> has explicit getFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Implementation </span><span class="si">%s</span><span class="s2"> is not frozen&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># special check on Base class elements</span>
      <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="n">Base</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;override&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: ClassElement of </span><span class="si">%s</span><span class="s2"> must be Implementation or Derived&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

      <span class="c1"># check automatic elements:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span><span class="p">:</span>

        <span class="n">setters</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tempOpInfo</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">setters</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;automatic </span><span class="si">%s</span><span class="s2"> has explicit setFunction&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;remove&#39;</span><span class="p">):</span>
          <span class="n">ops</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tempOpInfo</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">tag</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">ops</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is automatic or frozen and has </span><span class="si">%s</span><span class="s2">Function&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="c1"># NBNB TBD we do not check for &#39;add&#39; and &#39;remove&#39; functions here, as</span>
    <span class="c1"># they should be done as &#39;get, add, set&#39;</span>

    <span class="c1"># special case - check attribute called &#39;serial&#39; </span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">serial_attribute</span><span class="p">:</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MetaAttribute</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: name &#39;serial&#39; reserved for attribute&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: name &#39;serial&#39; only allowed inside MetaClass&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Int&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: &#39;serial&#39; attribute must be type &#39;Int&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="n">serialValues</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;isAutomatic&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;changeability&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">,</span>
                      <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;locard&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">}</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">serialValues</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> must be </span><span class="si">%s</span><span class="s2">, was </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="c1"># check overriding</span>
    <span class="n">allSupertypes</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>
    <span class="n">mayNotOverride</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Base</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
      <span class="n">superElem</span> <span class="o">=</span> <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">superElem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">superElem</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but types are different&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">superElem</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="c1"># classes without supertype cannot override or be overridden</span>
        <span class="k">if</span> <span class="n">mayNotOverride</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">superElem</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Name clash between </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> - classes do not descend from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">superElem</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

        <span class="c1"># superElem must be abstract</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">superElem</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides non-abstract </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

        <span class="n">parameterData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">parameterData</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s1">&#39;isAbstract&#39;</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span>
            <span class="s1">&#39;changeability&#39;</span><span class="p">,</span> <span class="s1">&#39;isDerived&#39;</span><span class="p">,</span> <span class="s1">&#39;otherRole&#39;</span><span class="p">):</span>
            <span class="c1"># NB different changeability is only allowed because the</span>
            <span class="c1"># overridden role has to be abstract</span>
            <span class="k">continue</span>

          <span class="k">if</span> <span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
            <span class="k">continue</span>

          <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
          <span class="n">superval</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">superval</span><span class="p">:</span>
            <span class="k">pass</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;defaultValue&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">superval</span><span class="p">:</span>
            <span class="c1"># attributes only</span>
            <span class="k">pass</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;locard&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">superval</span> <span class="o">&gt;</span> <span class="n">val</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: locard </span><span class="si">%s</span><span class="s2"> lower than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">superval</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overriding </span><span class="si">%s</span><span class="s2">: hicard must be 1 in both or neither&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">superval</span> <span class="o">==</span> <span class="n">infinity</span><span class="p">:</span>
              <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">infinity</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard infinity higher than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>
              <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">superval</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard </span><span class="si">%s</span><span class="s2"> higher than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;taggedValues&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">superval</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vv</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: tagged value </span><span class="si">%s</span><span class="s2"> not the same as in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">tt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;valueType&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">superval</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">superval</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;memops.Implementation.Any&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but valueType </span><span class="si">%s</span><span class="s2"> is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">superval</span><span class="p">))</span>

          <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but differs for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="k">if</span> <span class="n">superElem</span><span class="o">.</span><span class="n">getConstraint</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> constraint </span><span class="si">%s</span><span class="s2"> overrides inherited constraint&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="ComplexDataType"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType">[docs]</a><span class="k">class</span> <span class="nc">ComplexDataType</span><span class="p">(</span><span class="n">AbstractDataType</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Abstract superclass of MetaClass and MetaDataObjType</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">AbstractDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;constructorCodeStubs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">}</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;attributes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_ComplexDataType__attributeNames&#39;</span><span class="p">}</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;operations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_ComplexDataType__operationNames&#39;</span><span class="p">}</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;ComplexDataType&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Set implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__attributeNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__operationNames</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ComplexDataType.addConstructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.addConstructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addConstructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add constructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;constructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="ComplexDataType.removeConstructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.removeConstructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removeConstructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing ConstructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;constructorCodeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                                    <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;constructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no ConstructorCodeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="ComplexDataType.inheritDown"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.inheritDown">[docs]</a>  <span class="k">def</span> <span class="nf">inheritDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Copy all contained elements and constraints down to subtypes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_getCloningDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">subtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtypes</span><span class="p">:</span>
          <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtype</span>
          <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferGuid</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
          <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;roles&#39;</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">isImplementation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">otherRole</span><span class="p">:</span>
          <span class="n">dd</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_getCloningDict</span><span class="p">()</span>
          <span class="k">for</span> <span class="n">subtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtypes</span><span class="p">:</span>
            <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtype</span>
            <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferGuid</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: attempt to inherit down non-implementation or two-way role&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">obj</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">operations</span><span class="p">:</span>
      <span class="n">dd</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_getCloningDict</span><span class="p">()</span>
      <span class="n">target</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">target</span>
      <span class="k">for</span> <span class="n">subtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtypes</span><span class="p">:</span>

        <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subtype</span>
        <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferGuid</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
        <span class="n">newObj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">dd</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
          <span class="n">container</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">container</span>
          <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="n">container</span><span class="p">:</span>
            <span class="n">newObj</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">subtype</span>
          <span class="k">elif</span> <span class="n">target</span> <span class="ow">is</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">newObj</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">newObj</span>
          <span class="k">elif</span> <span class="n">target</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="n">container</span><span class="p">:</span>
            <span class="n">newObj</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">subtype</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
          <span class="n">dd2</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">_getCloningDict</span><span class="p">()</span>
          <span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newObj</span>
          <span class="n">dd2</span><span class="p">[</span><span class="s1">&#39;guid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transferGuid</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">newObj</span><span class="p">)</span>
          <span class="n">par</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">dd2</span><span class="p">)</span></div>

<div class="viewcode-block" id="ComplexDataType.getElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.getElement">[docs]</a>  <span class="k">def</span> <span class="nf">getElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get contained element called name</span>
<span class="sd">    Return None if nothing found</span>
<span class="sd">    </span>
<span class="sd">    Recursively search supertypes till you find element</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">None</span></div>

  <span class="c1"># synonym functions</span>
  <span class="n">getAttribute</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getOperation</span> <span class="o">=</span> <span class="n">getElement</span>

<div class="viewcode-block" id="ComplexDataType.getAllAttributes"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.getAllAttributes">[docs]</a>  <span class="k">def</span> <span class="nf">getAllAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get contained atttributes, including those from supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllElements</span><span class="p">(</span><span class="n">clazz</span><span class="o">=</span><span class="n">MetaAttribute</span><span class="p">)</span></div>

<div class="viewcode-block" id="ComplexDataType.getAllOperations"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.getAllOperations">[docs]</a>  <span class="k">def</span> <span class="nf">getAllOperations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get contained operations, including those from supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllElements</span><span class="p">(</span><span class="n">clazz</span><span class="o">=</span><span class="n">MetaOperation</span><span class="p">)</span></div>

<div class="viewcode-block" id="ComplexDataType.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.ComplexDataType.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># check code</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;constructorCode&#39;</span><span class="p">,):</span>
      <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Stubs&#39;</span><span class="o">%</span><span class="n">tag</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">code</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Abstract ComplexDataType </span><span class="si">%s</span><span class="s2"> has special constructor&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">codeTags</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span>
        <span class="k">for</span> <span class="n">codeTag</span> <span class="ow">in</span> <span class="n">code</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="c1"># check code tags</span>
          <span class="k">if</span> <span class="n">codeTag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codeTags</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Illegal </span><span class="si">%s</span><span class="s2">Stubs tag </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">codeTag</span><span class="p">))</span>

    <span class="c1"># check uniqueness of Operations signatures:</span>
    <span class="n">opCheckDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllOperations</span><span class="p">():</span>
      <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">opType</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">opSubType</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">opCheckDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Class has another operation with opType,opSubType,target </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">tt</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">opCheckDict</span><span class="p">[</span><span class="n">tt</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1"># Now check presence of an opSubType=None variant for all operations.</span>
    <span class="k">for</span> <span class="n">opType</span><span class="p">,</span> <span class="n">opSubType</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">opCheckDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">opSubType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">opCheckDict</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">opType</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">target</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">: opType,opSubType,target is </span><span class="si">%s</span><span class="s2">.</span>
<span class="s2">MetaOperation with opSubType:None not found&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="n">opType</span><span class="p">,</span> <span class="n">opSubType</span><span class="p">,</span> <span class="n">target</span><span class="p">)))</span>

    <span class="c1"># check presence of non-overridden abstract attributes and operations</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllAttributes</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not abstract but has abstract attr </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllOperations</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">op</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not abstract but has abstract operation </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="MetaPackage"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage">[docs]</a><span class="k">class</span> <span class="nc">MetaPackage</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for elements </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;isRoot&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;isLeaf&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;isAbstract&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;visibility&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">visibility_enumeration</span><span class="p">,</span>
                   <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">public_visibility</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;shortName&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;importedPackages&#39;</span><span class="p">:{</span><span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;setImportedPackages&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;default&#39;</span><span class="p">:[],</span> <span class="p">},</span>
     <span class="s1">&#39;accessedPackages&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;classes&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__classNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;dataTypes&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__dataTypeNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;dataObjTypes&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__dataObjTypeNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;constants&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__constantNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;exceptions&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__exceptionNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;containedPackages&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaPackage__containedPackageNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;topObjectClass&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaPackage&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Set implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__containedPackageNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__classNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__dataObjTypeNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__dataTypeNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__exceptionNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__constantNames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># finish link from container</span>
    <span class="n">container</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">container</span><span class="o">.</span><span class="n">__containedPackageNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="c1"># check container circularity</span>
    <span class="n">metaUtil</span><span class="o">.</span><span class="n">checkLinkCircularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="MetaPackage.setImportedPackages"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage.setImportedPackages">[docs]</a>  <span class="k">def</span> <span class="nf">setImportedPackages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">importedPackages</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; setter for link importedPackages</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># first clean up</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># then reset internal list</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># now put in data</span>
    <span class="k">for</span> <span class="n">importedPackage</span> <span class="ow">in</span> <span class="n">importedPackages</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">addImportedPackage</span><span class="p">(</span><span class="n">importedPackage</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaPackage.addImportedPackage"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage.addImportedPackage">[docs]</a>  <span class="k">def</span> <span class="nf">addImportedPackage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add imported package (two-way link)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check parameter type</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">importedPackage</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: addImportedPackage parameter should be MetaPackage, was </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">))</span>

    <span class="n">importedPackages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]</span>
    <span class="n">accessedPackages</span> <span class="o">=</span> <span class="n">importedPackage</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span>
      <span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">importedPackage</span> <span class="ow">in</span> <span class="n">importedPackages</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: addImportedPackage, </span><span class="si">%s</span><span class="s2"> already imported&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span> <span class="ow">in</span> <span class="n">accessedPackages</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: addImportedPackage, </span><span class="si">%s</span><span class="s2"> already accesssed&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">))</span>

    <span class="c1"># make change</span>
    <span class="n">importedPackages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">importedPackage</span><span class="p">)</span>
    <span class="n">accessedPackages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaPackage.removeImportedPackage"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage.removeImportedPackage">[docs]</a>  <span class="k">def</span> <span class="nf">removeImportedPackage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing importedPackage</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">importedPackages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">importedPackage</span> <span class="ow">in</span> <span class="n">importedPackages</span><span class="p">:</span>
      <span class="n">accessedPackages</span> <span class="o">=</span> <span class="n">importedPackage</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span>
        <span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span>
      <span class="n">accessedPackages</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: removeImportedPackage, </span><span class="si">%s</span><span class="s2"> was not imported&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">importedPackage</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaPackage.getElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage.getElement">[docs]</a>  <span class="k">def</span> <span class="nf">getElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get contained element called name</span>
<span class="sd">    Return None if nothing found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

  <span class="c1"># synonym functions</span>
  <span class="n">getClass</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getConstant</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getContainedPackage</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getDataObjType</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getDataType</span> <span class="o">=</span> <span class="n">getElement</span>
  <span class="n">getException</span> <span class="o">=</span> <span class="n">getElement</span>

<div class="viewcode-block" id="MetaPackage.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaPackage.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span> <span class="nn">ccpnmodel.ccpncore.memops.metamodel</span> <span class="kn">import</span> <span class="n">Util</span> <span class="k">as</span> <span class="n">metaUtil</span>

    <span class="n">importedPackages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]</span>
    <span class="n">accessedPackages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span>

    <span class="c1"># check containment circularity</span>
    <span class="n">metaUtil</span><span class="o">.</span><span class="n">checkLinkCircularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">)</span>

    <span class="c1"># check two-way import/access link</span>
    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">importedPackages</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;accessedPackages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way import/access link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> broken. Bug (1)?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">accessedPackages</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">pp</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way import/access link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> broken. Bug (2)?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pp</span><span class="p">))</span>

    <span class="c1"># check for &#39;None&#39;; container</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># root package. Check name</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">rootPackageName</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Root package named </span><span class="si">%s</span><span class="s2">, must be </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">rootPackageName</span><span class="p">))</span>

      <span class="c1"># initialise guid uniqueness check</span>
      <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">guidDict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c1"># Root package clean up after guid uniqueness check</span>
      <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">guidDict</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># check mandatory packages and get implementation package</span>
    <span class="n">RootPackage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topPackage</span><span class="p">()</span>
    <span class="n">ModellingPackage</span> <span class="o">=</span> <span class="n">RootPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ModellingPackage</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;No package </span><span class="si">%s</span><span class="s2"> found&quot;</span> <span class="o">%</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">)</span>

    <span class="n">Impl</span> <span class="o">=</span> <span class="n">ModellingPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Impl</span><span class="p">,</span> <span class="n">MetaPackage</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;No Implementation package found&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">Impl</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Implementation package </span><span class="si">%s</span><span class="s2"> may not import other packages&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__containedPackageNames</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Implementation package &#39;</span><span class="si">%s</span><span class="s2">&#39; must contain no other packages&quot;</span> <span class="o">%</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">)</span>

      <span class="c1"># check Implementation classes used elsewhere</span>
      <span class="n">tag</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeObjName</span>
      <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">cc</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">MetaDataObjType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Implementation package &#39;</span><span class="si">%s</span><span class="s2">&#39; does not contain MetaDataObjType </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationClassNames</span><span class="p">:</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cc</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Implementation package &#39;</span><span class="si">%s</span><span class="s2">&#39; does not contain class </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

      <span class="c1"># check special roles:</span>
      <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">dataRootName</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">tag2</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="n">metaConstants</span><span class="o">.</span><span class="n">repositoryRole</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">packageLocatorRole</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cc</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">tag2</span><span class="p">),</span> <span class="n">MetaRole</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;MemopsRoot class &#39;</span><span class="si">%s</span><span class="s2">&#39; does not contain role </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">tag2</span><span class="p">))</span>

    <span class="c1"># check container packages:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__containedPackageNames</span><span class="p">:</span>

      <span class="k">if</span> <span class="n">accessedPackages</span> <span class="ow">or</span> <span class="n">importedPackages</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Packages containing other packages can not import or access&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,))</span>

      <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__classNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataObjTypeNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataTypeNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exceptionNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__constantNames</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Packages containing other packages can contain nothing else&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,))</span>

      <span class="c1"># check shortName</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: branch package has shortName&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="c1"># name style check:</span>
      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">lowercase</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with lower case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">elif</span> <span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">__classNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataObjTypeNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dataTypeNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__exceptionNames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">__constantNames</span><span class="p">):</span>
      <span class="c1"># leaf package - NB package could be empty, hence the elif</span>

      <span class="c1"># check shortName</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: leaf package lacks a shortName&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxShortNameLength</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: shortName </span><span class="si">%s</span><span class="s2"> longer than </span><span class="si">%s</span><span class="s2"> characters&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortName</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxShortNameLength</span><span class="p">))</span>

      <span class="c1"># check TopObject </span>
      <span class="n">hasNonAbstract</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="n">topObjects</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">TopObjClass</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">topObjClassName</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">clazz</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">clazz</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="n">hasNonAbstract</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">clazz</span><span class="o">.</span><span class="n">supertype</span> <span class="ow">is</span> <span class="n">TopObjClass</span><span class="p">:</span>
          <span class="n">topObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clazz</span><span class="p">)</span>

      <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Impl</span> <span class="ow">and</span> <span class="n">hasNonAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">topObjects</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: has non-abstract classes but lacks TopObject&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">topObjects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: has several TopObjects: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topObjects</span><span class="p">))</span>

      <span class="c1"># check package importing</span>
      <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Impl</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">importedPackages</span>
        <span class="k">if</span> <span class="n">Impl</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;package </span><span class="si">%s</span><span class="s2"> does not import the Implementation package&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

      <span class="c1"># name style check:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">uppercase</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with upper case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">RootPackage</span><span class="p">:</span>
      <span class="c1"># special checks for root package, and for entire model</span>

      <span class="c1"># check for cycles in import/access for packages. </span>
      <span class="c1"># and in supertypes/subtypes for classes</span>
      <span class="c1"># Done centrally for speed</span>
      <span class="n">leafPackages</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">dataTypes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">dataObjTypes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">exceptions</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">pp</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
        <span class="n">ll2</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">containedPackages</span>
        <span class="k">if</span> <span class="n">ll2</span><span class="p">:</span>
          <span class="n">ll</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ll2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">leafPackages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>

        <span class="n">classes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span>
        <span class="n">dataTypes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">)</span>
        <span class="n">dataObjTypes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">dataObjTypes</span><span class="p">)</span>
        <span class="n">exceptions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">exceptions</span><span class="p">)</span>

      <span class="n">metaUtil</span><span class="o">.</span><span class="n">topologicalSortSubgraph</span><span class="p">(</span><span class="n">leafPackages</span><span class="p">,</span> <span class="s1">&#39;importedPackages&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="p">(</span><span class="n">classes</span><span class="p">,</span> <span class="n">dataTypes</span><span class="p">,</span> <span class="n">dataObjTypes</span><span class="p">,</span> <span class="n">exceptions</span><span class="p">):</span>
        <span class="n">metaUtil</span><span class="o">.</span><span class="n">topologicalSortSubgraph</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span> <span class="s1">&#39;supertypes&#39;</span><span class="p">)</span>

      <span class="c1"># checks for diamond multiple inheritance and inheritance order</span>
      <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeObjName</span><span class="p">):</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">ss</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>

          <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> inherits twice from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ss</span><span class="p">))</span>

          <span class="n">dd</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
          <span class="n">subtypes</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">subtypes</span>
          <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">xx</span> <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">subtypes</span> <span class="k">if</span>
                 <span class="n">xx</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">tmp</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: classes should have </span><span class="si">%s</span><span class="s2"> as first supertype&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>

          <span class="n">ll</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">subtypes</span><span class="p">)</span></div></div>

<span class="c1"># must be done here after end of class definition</span>
<span class="n">MetaPackage</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;importedPackages&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
<span class="n">MetaPackage</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;accessedPackages&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
<span class="n">MetaPackage</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaClass"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass">[docs]</a><span class="k">class</span> <span class="nc">MetaClass</span><span class="p">(</span><span class="n">ComplexDataType</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for normal Classes</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ComplexDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;isSingleton&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;partitionsChildren&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;isDerived&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;keyNames&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">StringType</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span>
                 <span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;getKeyNames&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:[],</span> <span class="p">},</span>
     <span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span>
     <span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span>
     <span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span>
     <span class="s1">&#39;roles&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;namelist&#39;</span><span class="p">:</span><span class="s1">&#39;_MetaClass__roleNames&#39;</span><span class="p">,</span> <span class="p">},</span>
     <span class="s1">&#39;parentRole&#39;</span><span class="p">:{</span><span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;getParentRole&#39;</span><span class="p">,</span> <span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaClass&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Set implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__roleNames</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaPackage__classNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="c1"># topObjectClass - special case of Implementation package</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">dataRootName</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span>
      <span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">):</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="MetaClass.addKeyName"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.addKeyName">[docs]</a>  <span class="k">def</span> <span class="nf">addKeyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; add mainkey name to list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keyNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;keyNames&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">keyNames</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> keyName </span><span class="si">%s</span><span class="s2"> is already in list&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">elif</span> <span class="ow">not</span> <span class="n">keyNames</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKeyNames</span><span class="p">():</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> keyNames is defined in superclass&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">keyNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaClass.removeKeyName"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.removeKeyName">[docs]</a>  <span class="k">def</span> <span class="nf">removeKeyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; remove mainkey name from list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keyNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;keyNames&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">keyNames</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKeyNames</span><span class="p">():</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> keyNames is defined in superclass&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">elif</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyNames</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> keyName </span><span class="si">%s</span><span class="s2"> is not in list&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">keyNames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaClass.getKeyNames"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getKeyNames">[docs]</a>  <span class="k">def</span> <span class="nf">getKeyNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get keyNames list, from class or a superclass</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
      <span class="c1"># NB ComplexDataType - the topmost superclass has no &#39;keyNames&#39; attribute</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keyNames&#39;</span><span class="p">,</span> <span class="p">[])</span>
      <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">[:]</span></div>

<div class="viewcode-block" id="MetaClass.addDestructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.addDestructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addDestructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add destructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaClass.removeDestructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.removeDestructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removeDestructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing DestructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                                   <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no DestructorCodeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaClass.addPostConstructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.addPostConstructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addPostConstructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add postConstructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaClass.addPostDestructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.addPostDestructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addPostDestructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add destructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaClass.removePostConstructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.removePostConstructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removePostConstructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing PostConstructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                                    <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no PostConstructorCodeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaClass.removePostDestructorCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.removePostDestructorCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removePostDestructorCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing DestructorCodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
      <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no postDestructorCodeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

  <span class="n">getRole</span> <span class="o">=</span> <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">getElement</span>

<div class="viewcode-block" id="MetaClass.delete"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.delete">[docs]</a>  <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; remove links to other MetaElements, check that delete is legal.</span>
<span class="sd">    Intended for elements specific to some implementation</span>
<span class="sd">    NB delete does not cascade.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check for presence of roles</span>
    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">isImplementation</span> <span class="ow">and</span> <span class="n">role</span><span class="o">.</span><span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># allowed</span>
        <span class="k">pass</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Attempt to delete </span><span class="si">%s</span><span class="s2">, class has non-implementation roles&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># clear supertype/subtype links</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtypes</span><span class="p">:</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">removeSupertype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supertypes</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">removeSupertype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="c1"># clear container links</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
    <span class="n">container</span><span class="o">.</span><span class="n">_MetaPackage__classNames</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">container</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

    <span class="c1">#remove container from contents, </span>
    <span class="c1">#to ensure you get an error message irf they are picked up</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
      <span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="MetaClass.getAllRoles"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getAllRoles">[docs]</a>  <span class="k">def</span> <span class="nf">getAllRoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get contained roles, including those from supertypes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllElements</span><span class="p">(</span><span class="n">clazz</span><span class="o">=</span><span class="n">MetaRole</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaClass.getParentRole"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getParentRole">[docs]</a>  <span class="k">def</span> <span class="nf">getParentRole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get class on other side of parent role</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parentRole&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MetaClass.getParentClass"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getParentClass">[docs]</a>  <span class="k">def</span> <span class="nf">getParentClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get class on other side of parent role</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
      <span class="n">parentRole</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parentRole&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">valueType</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="MetaClass.getChildRoles"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getChildRoles">[docs]</a>  <span class="k">def</span> <span class="nf">getChildRoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get child roles</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">()</span> <span class="k">if</span>
            <span class="n">x</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">child_hierarchy</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetaClass.getClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get roles and attributes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span></div>

<div class="viewcode-block" id="MetaClass.getAllClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getAllClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getAllClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get all roles and attributes, included inherited ones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllAttributes</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">()</span></div>

<div class="viewcode-block" id="MetaClass.getSingleClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getSingleClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getSingleClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get roles and attributes with hicard == 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetaClass.getAllSingleClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getAllSingleClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getAllSingleClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get roles and attributes with hicard == 1, included inherited ones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAllAttributes</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">())</span> <span class="k">if</span>
            <span class="n">x</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetaClass.getMultipleClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getMultipleClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getMultipleClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get roles and attributes with hicard != 1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAttributes</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRoles</span><span class="p">())</span> <span class="k">if</span>
            <span class="n">x</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetaClass.getAllMultipleClassElements"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.getAllMultipleClassElements">[docs]</a>  <span class="k">def</span> <span class="nf">getAllMultipleClassElements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; get all roles and attributes with hicard != 1, included inherited ones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAllAttributes</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">())</span> <span class="k">if</span>
            <span class="n">x</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetaClass.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaClass.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get constant objects</span>
    <span class="n">RootPackage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">topPackage</span><span class="p">()</span>
    <span class="n">ModellingPackage</span> <span class="o">=</span> <span class="n">RootPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span>
      <span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">)</span>
    <span class="n">Impl</span> <span class="o">=</span> <span class="n">ModellingPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">)</span>
    <span class="n">Base</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">)</span>
    <span class="n">DataRoot</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">dataRootName</span><span class="p">)</span>
    <span class="n">DataObject</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">dataObjClassName</span><span class="p">)</span>
    <span class="n">ImplObject</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">implObjClassName</span><span class="p">)</span>
    <span class="n">TopObject</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">topObjClassName</span><span class="p">)</span>

    <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># check derived classes</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span><span class="p">:</span>
      <span class="n">keyNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKeyNames</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">isImplementation</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">keyNames</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Element </span><span class="si">%s</span><span class="s2"> of derived class </span><span class="si">%s</span><span class="s2"> neither derived, implementation nor a key&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="n">role</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">or</span> <span class="n">role</span><span class="o">.</span><span class="n">isImplementation</span> <span class="ow">or</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">keyNames</span> <span class="ow">or</span> <span class="n">role</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentRole</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Element </span><span class="si">%s</span><span class="s2"> of derived class </span><span class="si">%s</span><span class="s2"> neither derived, implementation nor a key&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="n">otherRole</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">otherRole</span>

        <span class="k">if</span> <span class="n">otherRole</span><span class="p">:</span>
          <span class="c1"># check that links to derived class have manual getters</span>
          <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getAllOperations</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">op</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="n">otherRole</span> <span class="ow">and</span> <span class="n">op</span><span class="o">.</span><span class="n">opType</span> <span class="o">==</span> <span class="s1">&#39;get&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">):</span>
              <span class="k">break</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;Link </span><span class="si">%s</span><span class="s2"> to derived class </span><span class="si">%s</span><span class="s2"> must have manually defined &#39;get&#39; function&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">otherRole</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
        <span class="n">parentClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentRole</span><span class="o">.</span><span class="n">valueType</span>
        <span class="n">factoryFunction</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">getOperation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>
                                                <span class="n">inClass</span><span class="o">=</span><span class="n">parentClass</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">factoryFunction</span> <span class="ow">or</span> <span class="n">factoryFunction</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Derived class </span><span class="si">%s</span><span class="s2"> must have manually defined factory function&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check keyNames</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getKeyNames</span><span class="p">():</span>
      <span class="n">keyElement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">keyElement</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> keyName </span><span class="si">%s</span><span class="s2"> is not an element in the class&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">changeability</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> key </span><span class="si">%s</span><span class="s2"> is changeable&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">isDerived</span><span class="p">:</span>
        <span class="c1"># in order to speed up checking and facilitate database impl.</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> key </span><span class="si">%s</span><span class="s2"> is derived&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">:</span>
        <span class="c1"># in order to speed up checking and facilitate database impl.</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> key </span><span class="si">%s</span><span class="s2"> is Implementation element&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">locard</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> key </span><span class="si">%s</span><span class="s2"> does not have n..n cardinality&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keyElement</span><span class="p">,</span> <span class="n">MetaRole</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">keyElement</span><span class="o">.</span><span class="n">valueType</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: key </span><span class="si">%s</span><span class="s2"> is link into nonacessible package&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span>
              <span class="n">TopObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">TopObject</span> <span class="ow">in</span> <span class="n">keyElement</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: key </span><span class="si">%s</span><span class="s2"> is link to non-topObject&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="c1"># check name length</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxClassNameLength</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: name </span><span class="si">%s</span><span class="s2"> longer than </span><span class="si">%s</span><span class="s2"> characters&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">maxClassNameLength</span><span class="p">))</span>

    <span class="c1"># check that child class names do not conflict with each other</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">child_hierarchy</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">getNonAbstractSubtypes</span><span class="p">():</span>

          <span class="n">cname</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">name</span>
          <span class="n">val</span> <span class="o">=</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cname</span><span class="p">,</span> <span class="n">sentinel</span><span class="p">)</span>

          <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has two child classes named </span><span class="si">%s</span><span class="s2">;</span><span class="se">\n</span><span class="s2"> links are </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">cname</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

          <span class="k">else</span><span class="p">:</span>
            <span class="n">dd</span><span class="p">[</span><span class="n">cname</span><span class="p">]</span> <span class="o">=</span> <span class="n">role</span>

    <span class="c1"># get parentRole</span>
    <span class="n">parentRole</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentRole</span>
    <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

      <span class="c1"># set parentClass</span>
      <span class="n">parentClass</span> <span class="o">=</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">valueType</span>

      <span class="k">if</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-Abstract class with one-way parentRole&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">otherRole</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># check for only children with key.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyNames</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: only child has keyNames: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyNames</span><span class="p">))</span>
      <span class="k">elif</span> <span class="ow">not</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyNames</span><span class="p">:</span>
        <span class="c1"># check that classes with parentRole also have mainKey</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: class with parentRole lacks keyNames&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">parentClass</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># remove very top class as that is a DataObjType</span>
    <span class="n">allSupertypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span> <span class="k">if</span>
                     <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;ComplexDataType&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">Base</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract class is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="n">Impl</span><span class="p">:</span>
      <span class="c1"># Implementation package </span>

      <span class="k">if</span> <span class="n">ImplObject</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract Implementation class is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">ImplObject</span><span class="p">))</span>

      <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">parentClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DataRoot</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: has incorrect parentClass </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentClass</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">DataRoot</span><span class="p">:</span>
        <span class="c1"># DataRoot</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitionsChildren</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> does not have partitionsChildren True&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DataRoot</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: subType of </span><span class="si">%s</span><span class="s2"> has parentRole </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">DataRoot</span><span class="p">,</span> <span class="n">parentRole</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">topObjectClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has topObjectClass </span><span class="si">%s</span><span class="s2">, should be </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Impl</span><span class="p">,</span> <span class="n">DataRoot</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">TopObject</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitionsChildren</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> does not have partitionsChildren True&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TopObject</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

      <span class="k">if</span> <span class="n">DataObject</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract class is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DataObject</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">otherRole</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">implementation</span><span class="p">]:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: class with non-implementation or two-way role is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">DataObject</span><span class="p">))</span>

      <span class="k">if</span> <span class="n">TopObject</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">:</span>
        <span class="c1"># TopObject</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">parentRole</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: TopObject has no parentRole&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">parentClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DataRoot</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: TopObject has incorrect parentClass </span><span class="si">%s</span><span class="s2">, should be </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">parentClass</span><span class="p">,</span> <span class="n">DataRoot</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">otherRole</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: TopObject is is an only child&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">DataRoot</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">():</span>
          <span class="c1"># check existence of currentRole</span>
          <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">valueType</span> <span class="ow">in</span> <span class="n">allSupertypes</span> <span class="ow">and</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span>
            <span class="s1">&#39;current&#39;</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: TopObject is not pointed to by a &#39;current&#39; link&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Normal class</span>

        <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">parentClass</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: has parentClass </span><span class="si">%s</span><span class="s2"> from different package&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">parentClass</span><span class="p">))</span>

    <span class="c1"># check that links are not inherited across package boundaries</span>
    <span class="c1"># except for certain one-way links</span>
    <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DataObject</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span> <span class="k">if</span>
          <span class="n">x</span><span class="o">.</span><span class="n">otherRole</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">]:</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSubtypes</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: has both roles and out-of-package subclasses:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">ll</span><span class="p">))</span>

    <span class="c1"># check that non-abstract class has parentRole and mainkey</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="n">DataRoot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">parentRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract class lacks parentRole&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyNames</span> <span class="ow">and</span> <span class="n">parentRole</span><span class="o">.</span><span class="n">otherRole</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract class lacks keyNames and is not only child&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,))</span>

    <span class="c1"># check partitionsChildren behaves correctly</span>
    <span class="c1"># NB must not be checked for ComplexDataType class</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitionsChildren</span><span class="p">:</span>
      <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">allSupertypes</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">partitionsChildren</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not partition children, but its superclass(es) do:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">ll</span><span class="p">))</span>

    <span class="c1"># check parent role cyclicity</span>
    <span class="n">sup</span> <span class="o">=</span> <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">while</span> <span class="n">sup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">low</span> <span class="o">=</span> <span class="n">sup</span>
      <span class="n">sup</span> <span class="o">=</span> <span class="n">low</span><span class="o">.</span><span class="n">getParentClass</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">sup</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is (indirectly) its own parentClass&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># All non-abstract classes must be under root</span>
    <span class="k">if</span> <span class="n">DataRoot</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">DataRoot</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not descend from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DataRoot</span><span class="p">))</span>

    <span class="c1"># check presence of non-overridden abstract roles</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllRoles</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not abstract but has abstract role </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># check code</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;destructorCodeStubs&#39;</span><span class="p">,</span> <span class="s1">&#39;postDestructorCodeStubs&#39;</span><span class="p">,</span> <span class="s1">&#39;postConstructorCodeStubs&#39;</span><span class="p">):</span>
      <span class="n">destructorCode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">destructorCode</span><span class="p">:</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Abstract class </span><span class="si">%s</span><span class="s2"> has special destructor or constructor&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">codeTags</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span>
        <span class="k">for</span> <span class="n">codeTag</span> <span class="ow">in</span> <span class="n">destructorCode</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="c1"># check code tags</span>
          <span class="k">if</span> <span class="n">codeTag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codeTags</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Illegal </span><span class="si">%s</span><span class="s2"> tag </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">codeTag</span><span class="p">))</span>

    <span class="c1"># check special &#39;serial&#39; attribute</span>
    <span class="n">serial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">serial_attribute</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">serial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="n">MetaAttribute</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - non-MetaAttribute named </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">serial</span><span class="p">,</span> <span class="n">serial</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

      <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">serial</span><span class="o">.</span><span class="n">isAutomatic</span> <span class="ow">or</span> <span class="n">serial</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">serial</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">serial</span><span class="o">.</span><span class="n">changeability</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span> <span class="ow">or</span> <span class="n">serial</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;Int&#39;</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2">:</span>
<span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39; attribute must be Int, automatic, non-changeable and 1..1&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="n">serial</span><span class="p">,</span> <span class="n">serial</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></div></div>

<span class="c1">#</span>
<span class="n">MetaClass</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertype&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaClass</span>
<span class="n">MetaClass</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaClass</span>
<span class="n">MetaClass</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaClass</span>
<span class="n">MetaPackage</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaClass</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaDataObjType"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataObjType">[docs]</a><span class="k">class</span> <span class="nc">MetaDataObjType</span><span class="p">(</span><span class="n">ComplexDataType</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for complex data objects</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ComplexDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;isChangeable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span>
                                   <span class="s1">&#39;getterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;getIsChangeable&#39;</span><span class="p">,</span> <span class="p">}</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaDataObjType&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaPackage__dataObjTypeNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MetaDataObjType.getIsChangeable"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataObjType.getIsChangeable">[docs]</a>  <span class="k">def</span> <span class="nf">getIsChangeable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllAttributes</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">changeability</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="c1">#</span>
    <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="MetaDataObjType.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataObjType.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">BaseDataType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
      <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
       <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span>
       <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeObjName</span><span class="p">]))</span>

    <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># check changeability</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isChangeable</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2"> has changeable attribute - </span>
<span class="s2">       Changeable MetaDataObjTypes not implemented&quot;&quot;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check inheritance across package boundaries </span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
      <span class="n">pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
      <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSubtypes</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pp</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has out-of-package subtypes </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll</span><span class="p">))</span>

    <span class="c1"># check supertypes</span>
    <span class="k">if</span> <span class="n">BaseDataType</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: non-abstract DataObjType is not subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">BaseDataType</span><span class="p">))</span></div></div>

<span class="c1">#</span>
<span class="n">MetaDataObjType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertype&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataObjType</span>
<span class="n">MetaDataObjType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataObjType</span>
<span class="n">MetaDataObjType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataObjType</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaDataType"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataType">[docs]</a><span class="k">class</span> <span class="nc">MetaDataType</span><span class="p">(</span><span class="n">AbstractDataType</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for data types</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">AbstractDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;isOpen&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;enumeration&#39;</span><span class="p">:{</span><span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:[],</span> <span class="p">},</span>
                        <span class="s1">&#39;length&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">IntType</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;typeCodes&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaDataType&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaPackage__dataTypeNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MetaDataType.addTypeCode"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataType.addTypeCode">[docs]</a>  <span class="k">def</span> <span class="nf">addTypeCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add typeCode</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> typeCode tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> typeCode </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;typeCodes&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaDataType.removeTypeCode"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataType.removeTypeCode">[docs]</a>  <span class="k">def</span> <span class="nf">removeTypeCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing TypeCode</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;typeCodes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                         <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;typeCodes&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no typeCode </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaDataType.isValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataType.isValid">[docs]</a>  <span class="k">def</span> <span class="nf">isValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This function is needed because value constants</span>
<span class="sd">    must be checked for validity as part of the MetaModel.</span>
<span class="sd">    NB for enumerations values must be added to the enumeration</span>
<span class="sd">    before the check works.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># check value in enumeration</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span><span class="p">:</span>
      <span class="c1"># closed enumeration</span>
      <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">enumeration</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c1"># check special check function - or just correct PythonType</span>
    <span class="n">baseType</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeModule</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">typeCodes</span><span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">baseType</span><span class="p">,</span> <span class="s1">&#39;isValid&#39;</span><span class="p">):</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">baseType</span><span class="p">,</span> <span class="s1">&#39;isValid&#39;</span><span class="p">)(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pythonType</span> <span class="o">=</span> <span class="n">baseType</span><span class="o">.</span><span class="n">PythonType</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pythonType</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c1"># check length</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ConstrainedElement__constraints</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>

        <span class="n">code</span> <span class="o">=</span> <span class="n">constraint</span><span class="o">.</span><span class="n">codeStubs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;python&#39;</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">re</span>

        <span class="n">containsWhitespace</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;\s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
        <span class="n">containsNonAlphanumeric</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z0-9_]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">:</span><span class="n">string</span><span class="p">,</span>
              <span class="s1">&#39;containsWhitespace&#39;</span><span class="p">:</span><span class="n">containsWhitespace</span><span class="p">,</span>
              <span class="s1">&#39;containsNonAlphanumeric&#39;</span><span class="p">:</span><span class="n">containsNonAlphanumeric</span><span class="p">,</span>
              <span class="s1">&#39;NaN&#39;</span><span class="p">:</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)}</span>

        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="n">isValid</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;isValid&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="n">isValid</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">dd</span><span class="p">,</span> <span class="n">dd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># NBNB TBD: check with Rasmus</span>
          <span class="c1">#exec code in dd</span>
          <span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">dd</span><span class="p">)</span>
          <span class="n">isValid</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;isValid&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isValid</span><span class="p">:</span>
          <span class="k">return</span> <span class="bp">False</span>

    <span class="k">except</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Error checking constraints in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>
      <span class="k">raise</span>

    <span class="c1">#</span>
    <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="MetaDataType.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaDataType.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AbstractDataType</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="n">enumeration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enumeration&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">enumeration</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> isOpen set to </span><span class="si">%s</span><span class="s2"> for non-enumeration&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isOpen</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ee</span> <span class="ow">in</span> <span class="n">enumeration</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">ee</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : Illegal enumeration value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">(),</span> <span class="n">ee</span><span class="p">))</span>

    <span class="c1"># check single inheritance</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supertypes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has more than one supertype&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span></div></div>


<span class="c1">#</span>
<span class="n">MetaDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertype&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataType</span>
<span class="n">MetaDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataType</span>
<span class="n">MetaDataType</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaDataType</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaException"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaException">[docs]</a><span class="k">class</span> <span class="nc">MetaException</span><span class="p">(</span><span class="n">HasParameters</span><span class="p">,</span> <span class="n">HasSupertype</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for exceptions </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">HasParameters</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;scope&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">scope_enumeration</span><span class="p">,</span>
             <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">instance_level</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;supertype&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;setSupertype&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span> <span class="s1">&#39;supertypes&#39;</span><span class="p">:{</span><span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;subtypes&#39;</span><span class="p">:{</span><span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;unsettable&#39;</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">HasParameters</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaException&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">HasParameters</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># implementation attributes</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;subtypes&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;supertypes&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">dd</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaPackage__exceptionNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

  <span class="n">getElement</span> <span class="o">=</span> <span class="n">ComplexDataType</span><span class="o">.</span><span class="n">getElement</span>

  <span class="n">getParameter</span> <span class="o">=</span> <span class="n">getElement</span>

<div class="viewcode-block" id="MetaException.getAllParameters"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaException.getAllParameters">[docs]</a>  <span class="k">def</span> <span class="nf">getAllParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllElements</span><span class="p">(</span><span class="n">clazz</span><span class="o">=</span><span class="n">MetaParameter</span><span class="p">)</span></div>


<div class="viewcode-block" id="MetaException.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaException.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">HasParameters</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

    <span class="c1"># check single inheritance</span>
    <span class="n">supertypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supertypes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">supertypes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has more than one supertype&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">supertypes</span><span class="p">:</span>
      <span class="n">supertype</span> <span class="o">=</span> <span class="n">supertypes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

      <span class="c1"># package access check</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">supertype</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access supertype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">supertype</span><span class="p">))</span>

      <span class="c1"># check two-way link</span>
      <span class="k">if</span> <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way supertype link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (3)?&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">supertype</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

    <span class="c1"># name style</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">uppercase</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with upper case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># check two-way link</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">supertype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;Two-way supertype link </span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2"> is broken. Bug (4)?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>

    <span class="c1"># checks on Parameters.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>

      <span class="c1"># return parameters</span>
      <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span>
              <span class="n">x</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">return_direction</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: more than one return parameter : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">]))</span></div></div>

        <span class="c1"># must be set here, after the class definition</span>


<span class="n">MetaException</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertype&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaException</span>
<span class="n">MetaException</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;supertypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaException</span>
<span class="n">MetaException</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;subtypes&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaException</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaOperation"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation">[docs]</a><span class="k">class</span> <span class="nc">MetaOperation</span><span class="p">(</span><span class="n">HasParameters</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for operations </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">HasParameters</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ComplexDataType</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;scope&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">scope_enumeration</span><span class="p">,</span>
             <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">instance_level</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;codeStubs&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">},</span>
    <span class="s1">&#39;exceptions&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">MetaException</span><span class="p">,</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:[],</span> <span class="p">},</span>
    <span class="s1">&#39;isQuery&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;isAbstract&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;opType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
              <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="nb">tuple</span><span class="p">(</span><span class="n">OpTypes</span><span class="o">.</span><span class="n">operationData</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="p">},</span>
    <span class="s1">&#39;opSubType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">MetaModelElement</span><span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">HasParameters</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaOperation&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">HasParameters</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># implementation attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_ComplexDataType__operationNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="MetaOperation.addCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.addCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add codeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported  codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>


<div class="viewcode-block" id="MetaOperation.removeCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.removeCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removeCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing codeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                         <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no codeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaOperation.getElement"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.getElement">[docs]</a>  <span class="k">def</span> <span class="nf">getElement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Get contained element called name</span>
<span class="sd">    Return None if nothing found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

  <span class="n">getParameter</span> <span class="o">=</span> <span class="n">getElement</span>

<div class="viewcode-block" id="MetaOperation.addException"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.addException">[docs]</a>  <span class="k">def</span> <span class="nf">addException</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add exception to exceptions list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exceptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">isinstance</span><span class="p">(</span><span class="n">MetaException</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> is not a MetaException&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - exception </span><span class="si">%s</span><span class="s2"> is already in list&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="n">exceptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetaOperation.removeException"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.removeException">[docs]</a>  <span class="k">def</span> <span class="nf">removeException</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing exception</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exceptions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">exceptions</span><span class="p">:</span>
      <span class="n">exceptions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - has no exception </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaOperation.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaOperation.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NBNB Some things are checked only in ModelAdapt</span>
    <span class="c1"># ops with targetTag != masterOp must replace an autogenerated operation </span>
    <span class="c1"># and must conform to the rules for this operation</span>

    <span class="n">IC</span> <span class="o">=</span> <span class="n">metaConstants</span>

    <span class="n">implPackage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span>
      <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">IC</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span> <span class="n">IC</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="n">implPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">IC</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="n">implPackage</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">IC</span><span class="o">.</span><span class="n">baseDataTypeObjName</span><span class="p">)</span>

    <span class="n">HasParameters</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

    <span class="c1"># check code</span>
    <span class="n">codeTags</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span>
    <span class="k">for</span> <span class="n">codeTag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># check code tags</span>
      <span class="k">if</span> <span class="n">codeTag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codeTags</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Ilegal codeStub tag </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codeTag</span><span class="p">))</span>

    <span class="c1"># exception package access check</span>
    <span class="k">for</span> <span class="n">exception</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;exceptions&#39;</span><span class="p">]:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access exception </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">))</span>

    <span class="c1"># name style</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">lowercase</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with lower case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># opType dependent checks</span>
    <span class="c1"># check valid opType</span>
    <span class="n">opType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opType</span>
    <span class="n">opTypeInfo</span> <span class="o">=</span> <span class="n">OpTypes</span><span class="o">.</span><span class="n">operationData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opType</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">opTypeInfo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Illegal optype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opType</span><span class="p">))</span>

    <span class="n">targetTag</span> <span class="o">=</span> <span class="n">opTypeInfo</span><span class="p">[</span><span class="s1">&#39;targetTag&#39;</span><span class="p">]</span>

    <span class="c1"># check isQuery fits opType</span>
    <span class="k">if</span> <span class="n">opTypeInfo</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;other&#39;</span><span class="p">:</span>
      <span class="c1"># Operations with isQuery are allowed on deleted objects.</span>
      <span class="c1"># That was the deciding factor in letting isQuery be optional</span>
      <span class="c1"># for &#39;other&#39; operations</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">opTypeInfo</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="s1">&#39;otherQuery&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isQuery</span><span class="p">)):</span>
        <span class="c1"># Queries *must* be isQuery. Other opTypes may not, &#39;other&#39; may choose</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has group == </span><span class="si">%s</span><span class="s2"> but isQuery == </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">opTypeInfo</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isQuery</span><span class="p">))</span>

    <span class="c1"># check for explicit parameters</span>
    <span class="k">if</span> <span class="n">targetTag</span> <span class="o">!=</span> <span class="s1">&#39;masterOp&#39;</span><span class="p">:</span>
      <span class="c1"># only masterOp target is allowed explicit parameters</span>
      <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">par</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> with opType </span><span class="si">%s</span><span class="s2"> has explicit parameter </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opType</span><span class="p">,</span> <span class="n">par</span><span class="p">))</span>

    <span class="c1"># check target</span>
    <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span>

    <span class="c1"># check target type</span>
    <span class="n">targetTypes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ClassElement&#39;</span><span class="p">:</span><span class="n">ClassElement</span><span class="p">,</span> <span class="s1">&#39;MetaRole&#39;</span><span class="p">:</span><span class="n">MetaRole</span><span class="p">,</span>
                   <span class="s1">&#39;MetaAttribute&#39;</span><span class="p">:</span><span class="n">MetaAttribute</span><span class="p">,</span> <span class="s1">&#39;ChildClass&#39;</span><span class="p">:</span><span class="n">MetaClass</span><span class="p">,</span>
                   <span class="s1">&#39;container&#39;</span><span class="p">:</span><span class="n">ComplexDataType</span><span class="p">,</span> <span class="s1">&#39;masterOp&#39;</span><span class="p">:</span><span class="n">MetaOperation</span><span class="p">,</span> <span class="p">}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">targetTypes</span><span class="p">[</span><span class="n">targetTag</span><span class="p">]):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target </span><span class="si">%s</span><span class="s2"> does not fit target type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">targetTag</span><span class="p">))</span>

    <span class="c1"># type specific checks</span>
    <span class="k">if</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;container&#39;</span><span class="p">:</span>
      <span class="c1"># container target</span>
      <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target </span><span class="si">%s</span><span class="s2"> differs from op container </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;masterOp&#39;</span><span class="p">:</span>
      <span class="c1"># masterOp target</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opSubType</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target should be operation itself, is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">target</span><span class="o">.</span><span class="n">opType</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opType</span> <span class="ow">or</span> <span class="n">target</span><span class="o">.</span><span class="n">target</span> <span class="o">!=</span> <span class="n">target</span> <span class="ow">or</span> <span class="n">target</span><span class="o">.</span><span class="n">opSubType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target should be opType=None version of operation, is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;ChildClass&#39;</span><span class="p">:</span>
      <span class="c1"># ChildClass target</span>
      <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">getParentClass</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target should be childclass of </span><span class="si">%s</span><span class="s2">, is </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># ClassElement target</span>
      <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">container</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: target </span><span class="si">%s</span><span class="s2"> must be element of same class as op or a superclass&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

    <span class="c1"># special case - findFirst and findAll</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">opType</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;findFirst&#39;</span><span class="p">,</span> <span class="s1">&#39;findAll&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">valueType</span><span class="p">,</span>
                                                          <span class="n">MetaDataType</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> or operation has Datatype attribute target </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">opType</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

    <span class="c1"># check overriding of elements</span>
    <span class="n">allSupertypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>
    <span class="n">mayNotOverride</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Base</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
      <span class="n">superElem</span> <span class="o">=</span> <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">superElem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">superElem</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but types are different&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">superElem</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>

        <span class="c1"># classes without supertype cannot override or be overridden</span>
        <span class="k">if</span> <span class="n">mayNotOverride</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">superElem</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;Name clash between </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2"> - classes do not descend from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">superElem</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

        <span class="n">parameterData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">parameterData</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

          <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s1">&#39;codeStubs&#39;</span><span class="p">,</span> <span class="s1">&#39;isAbstract&#39;</span><span class="p">,</span> <span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">):</span>
            <span class="k">continue</span>

          <span class="k">if</span> <span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
            <span class="k">continue</span>

          <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
          <span class="n">superval</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

          <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">superval</span><span class="p">:</span>
            <span class="k">pass</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;container&#39;</span><span class="p">:</span>
              <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;masterOp&#39;</span><span class="p">:</span>
              <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">targetTag</span> <span class="o">==</span> <span class="s1">&#39;ChildClass&#39;</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but </span><span class="si">%s</span><span class="s2"> operations may not be overridden&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opType</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
              <span class="c1"># ClassElement target - superval must be overridden by val</span>
              <span class="k">if</span> <span class="n">superval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">supertype</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but target </span><span class="si">%s</span><span class="s2"> does not override </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">superval</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;taggedValues&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">superval</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vv</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but tagged value </span><span class="si">%s</span><span class="s2"> differs&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">tt</span><span class="p">))</span>

          <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but differs for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opType</span> <span class="o">!=</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span>
          <span class="c1"># parameter inheritance</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">superElem</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but number of parameters is different&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

    <span class="c1"># checks on Parameters.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">:</span>
      <span class="c1"># input parameters</span>
      <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span>
              <span class="n">x</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">in_direction</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isImplicit</span> <span class="ow">and</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">implPackage</span><span class="p">:</span>
          <span class="c1"># warn of unusual names, but exclude implPackage to keep number down</span>
          <span class="k">print</span><span class="p">(</span>
            <span class="s2">&quot;WARNING, </span><span class="si">%s</span><span class="s2">: single input parameter is not named &#39;value&#39; but </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

      <span class="n">foundOptional</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">taggedValues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isSubdivided&#39;</span><span class="p">):</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">par</span> <span class="ow">is</span> <span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">taggedValues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isSubdivided&#39;</span><span class="p">):</span>
              <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided KeywordValue parameter </span><span class="si">%s</span><span class="s2"> is not the last input parameter&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
              <span class="k">elif</span> <span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided Two KeywordValue parameters </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided parameter </span><span class="si">%s</span><span class="s2"> is not the last input parameter&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

          <span class="k">elif</span> <span class="n">par</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided parameter </span><span class="si">%s</span><span class="s2"> is not the last input parameter&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="k">elif</span> <span class="p">((</span>
                    <span class="n">par</span><span class="o">.</span><span class="n">locard</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">par</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">par</span><span class="o">.</span><span class="n">defaultValue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
          <span class="c1"># optional parameter. NB the or statement is currently superflous</span>
          <span class="c1"># but we might allow defaults for hicard!= 1 later</span>
          <span class="n">foundOptional</span> <span class="o">=</span> <span class="n">par</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># mandatory parameter - must come first</span>
          <span class="k">if</span> <span class="n">foundOptional</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: mandatory parameter </span><span class="si">%s</span><span class="s2"> appears after optional </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">foundOptional</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="c1"># return parameters</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameters</span> <span class="k">if</span>
            <span class="n">x</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">return_direction</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">pars</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">opTypeInfo</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;modify&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: modifier has return parameter&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: more than one return parameter : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pars</span><span class="p">]))</span></div></div>


<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaRole"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaRole">[docs]</a><span class="k">class</span> <span class="nc">MetaRole</span><span class="p">(</span><span class="n">ClassElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for roles (link ends) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ClassElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaClass</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;scope&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">scope_enumeration</span><span class="p">,</span>
             <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">instance_level</span><span class="p">,</span> <span class="s1">&#39;isFixed&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;valueType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">MetaClass</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;aggregation&#39;</span><span class="p">:{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">aggregation_enumeration</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;hierarchy&#39;</span><span class="p">:{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">hierarchy_enumeration</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;otherRole&#39;</span><span class="p">:{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;setterFunc&#39;</span><span class="p">:</span><span class="s1">&#39;setOtherRole&#39;</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;partitionsChildren&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;forceUndoNotify&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;noDeleteIfSet&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ClassElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaRole&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">ClassElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaClass__roleNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hierarchy&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">parent_hierarchy</span><span class="p">:</span>

      <span class="c1"># set container parentRole</span>
      <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;parentRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

<div class="viewcode-block" id="MetaRole.setOtherRole"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaRole.setOtherRole">[docs]</a>  <span class="k">def</span> <span class="nf">setOtherRole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; set otherRole link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;otherRole&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - attempt to unset (partially) set otherRole&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">else</span><span class="p">:</span>

      <span class="n">reverse</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;otherRole&#39;</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="n">value</span> <span class="ow">and</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
        <span class="c1">#we are already set up</span>
        <span class="k">return</span>

      <span class="k">elif</span> <span class="n">current</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># NB value and self may be the same, but this still works</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">value</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># set container.container.topObjectClass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="ow">in</span> <span class="p">(</span>
          <span class="n">metaConstants</span><span class="o">.</span><span class="n">parent_hierarchy</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">child_hierarchy</span><span class="p">):</span>
          <span class="n">packages</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">packages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">packages</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
              <span class="n">obj</span> <span class="o">=</span> <span class="n">objs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
              <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">parent_hierarchy</span><span class="p">:</span>
                <span class="c1"># out-of-package parent role - this must be the TopObject</span>
                <span class="n">packages</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">container</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - attempt to overwrite (partially) set otherRole with value </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaRole.removeOtherRole"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaRole.removeOtherRole">[docs]</a>  <span class="k">def</span> <span class="nf">removeOtherRole</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; remove otherRole link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;otherRole&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">current</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - attempt to remove non-existing otherRole&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c1"># NB current and self may be the same, but this still works</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="n">current</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span></div>

<div class="viewcode-block" id="MetaRole.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaRole.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ClassElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="n">valueType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span>
    <span class="n">otherRole</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">otherRole</span>
    <span class="n">hicard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span>
    <span class="n">Impl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
      <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
       <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">]))</span>
    <span class="n">DataRoot</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">dataRootName</span><span class="p">)</span>
    <span class="n">Base</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">)</span>
    <span class="n">DataObject</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">dataObjClassName</span><span class="p">)</span>
    <span class="n">TopObject</span> <span class="o">=</span> <span class="n">Impl</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">topObjClassName</span><span class="p">)</span>

    <span class="c1"># check package access</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">valueType</span><span class="p">):</span>
      <span class="c1"># same package or other package is imported - no trouble</span>
      <span class="k">pass</span>

    <span class="k">elif</span> <span class="n">valueType</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="c1"># other package imports this one</span>

      <span class="k">if</span> <span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># NBNB TBD this could be DANGEROUS - RECONSIDER later</span>
        <span class="c1">#if not (DataRoot is self.container and </span>
        <span class="c1">#      TopObject in valueType.getAllSupertypes()):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">DataObject</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">or</span> <span class="p">(</span>
              <span class="n">DataRoot</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span> <span class="ow">and</span> <span class="n">TopObject</span> <span class="ow">in</span> <span class="n">valueType</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">())):</span>
          <span class="c1"># MemopsRoot.currentTopObject has special handling.</span>
          <span class="c1"># any other case is illegal.</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - one-way link to </span><span class="si">%s</span><span class="s2"> in non-imported package&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">))</span>

      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span><span class="p">:</span>
        <span class="k">pass</span>

      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - mandatory link to </span><span class="si">%s</span><span class="s2"> in non-imported package&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">))</span>
      <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - frozen link to </span><span class="si">%s</span><span class="s2"> in non-imported package&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - link to </span><span class="si">%s</span><span class="s2"> in non-imported package&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">))</span>

    <span class="c1"># check otherRole and constraint location</span>
    <span class="k">if</span> <span class="n">otherRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">constraints</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">container</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="n">otherRole</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: constraints on wrong side of interpackage link&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

        <span class="k">elif</span> <span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: constraints on wrong side of one-to-many link&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

        <span class="k">if</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: constraints on both sides of link&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="c1"># checks for parentRoles and composite aggregations </span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">parent_hierarchy</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span>
                        <span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">frozen</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">composite_aggregation</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span> <span class="ow">or</span> <span class="p">(</span>
              <span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="si">%s</span><span class="s2"> - invalid parentRole :</span>
<span class="s2">hicard:</span><span class="si">%s</span><span class="s2">, locard:</span><span class="si">%s</span><span class="s2">, changeability:</span><span class="si">%s</span><span class="s2">, aggregation:</span><span class="si">%s</span><span class="s2"></span>
<span class="s2">isDerived:</span><span class="si">%s</span><span class="s2">, isAutomatic:</span><span class="si">%s</span><span class="s2">, isImplementation:</span><span class="si">%s</span><span class="s2">, otherRole:</span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">hicard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">changeability</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation</span><span class="p">,</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAutomatic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">,</span> <span class="n">otherRole</span>
        <span class="p">))</span>

      <span class="c1"># check parentRole</span>
      <span class="n">pr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">parentRole</span>
      <span class="k">if</span> <span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has hierarchy </span><span class="si">%s</span><span class="s2">, but </span><span class="si">%s</span><span class="s2"> is class parent&quot;</span> <span class="o">%</span>
          <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">parent_hierarchy</span><span class="p">,</span> <span class="n">pr</span><span class="p">))</span>

      <span class="c1"># check package topObjectClass</span>
      <span class="n">package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">container</span>
      <span class="k">if</span> <span class="n">package</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
        <span class="c1"># out-of-package parent role - this must be the TopObject</span>
        <span class="k">if</span> <span class="n">package</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;parentRole </span><span class="si">%s</span><span class="s2"> incompatible with package.topObjectClass </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="s1">&#39;topObjectClass&#39;</span><span class="p">]))</span>

      <span class="k">if</span> <span class="n">constraints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: constraints on parent role&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">composite_aggregation</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - non-parentRole has aggregation </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aggregation</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">child_hierarchy</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">constraints</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: constraints on child role&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">otherRole</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: child role lacks otherRole&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="c1"># check limits on partitioning roles</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitionsChildren</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">no_hierarchy</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: only crosslinks can have partitionsChildren True&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="k">if</span> <span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">):</span>
        <span class="c1"># check that valueType does not have out-of-package subclasses</span>
        <span class="c1"># for two-way roles this is handled at the class level</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">valueType</span><span class="o">.</span><span class="n">container</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">valueType</span><span class="o">.</span><span class="n">getAllSubtypes</span><span class="p">()</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">pp</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ll</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: link to class </span><span class="si">%s</span><span class="s2"> with out-of-package subclasses :</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">,</span> <span class="n">ll</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

      <span class="c1"># check abstract association</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="o">!=</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">isAbstract</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: association has abstract and non-abstract role&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

      <span class="c1"># check coherence with otherRole</span>
      <span class="k">if</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">otherRole</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> otherRole incoherent across Association&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">valueType</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> valueType differs from otherRole.container&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>
      <span class="k">elif</span> <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">valueType</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> otherRole.valueType differs from container&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

      <span class="c1"># check limits on cardinalities (NB may later be relaxed)</span>

      <span class="c1"># limit on bi-ordering:</span>
      <span class="k">if</span> <span class="p">(</span>
              <span class="bp">self</span><span class="o">.</span><span class="n">isOrdered</span> <span class="ow">and</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">isOrdered</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: a link cannot be ordered in both directions, unless it is derived or implementation&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

      <span class="c1"># limit on non-unique two-way links</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isUnique</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isDerived</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: a two-way link must be derived, implementation, or unique in both directions&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

    <span class="c1"># NB - Abstract roles are not allowed in non-abstract classes, but this</span>
    <span class="c1"># is checked in MetaClass.checkValid</span>

    <span class="c1"># check overriding</span>
    <span class="n">allSupertypes</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span>
            <span class="n">Base</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSupertypes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isAbstract</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Non-abstract, non-implementation role in class that does not inherit from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">allSupertypes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
      <span class="n">superElem</span> <span class="o">=</span> <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">superElem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

        <span class="n">superval</span> <span class="o">=</span> <span class="n">superElem</span><span class="o">.</span><span class="n">otherRole</span>

        <span class="k">if</span> <span class="n">otherRole</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">superval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;one-way link </span><span class="si">%s</span><span class="s2"> overrides two-way link </span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">superval</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
          <span class="n">xx</span> <span class="o">=</span> <span class="n">otherRole</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">supertype</span>
          <span class="k">if</span> <span class="n">xx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">superOther</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="n">otherRole</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">superOther</span> <span class="o">=</span> <span class="bp">None</span>
          <span class="k">if</span> <span class="n">superOther</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">superval</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
              <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but otherRole </span><span class="si">%s</span><span class="s2"> does not override </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">otherRole</span><span class="p">,</span> <span class="n">superval</span><span class="p">))</span>

        <span class="k">break</span></div></div>

<span class="c1"># must be set here, after the class definition</span>
<span class="n">MetaRole</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;otherRole&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaRole</span>
<span class="n">MetaClass</span><span class="o">.</span><span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;parentRole&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaRole</span>

<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaAttribute"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaAttribute">[docs]</a><span class="k">class</span> <span class="nc">MetaAttribute</span><span class="p">(</span><span class="n">ClassElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for roles (link ends) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">ClassElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ComplexDataType</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;scope&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span> <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">scope_enumeration</span><span class="p">,</span>
             <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">instance_level</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;valueType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">AbstractDataType</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;forceUndoNotify&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span> <span class="p">},</span>
    <span class="s1">&#39;defaultValue&#39;</span><span class="p">:{</span><span class="s1">&#39;default&#39;</span><span class="p">:[],</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span><span class="n">infinity</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">ClassElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaAttribute&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">ClassElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_ComplexDataType__attributeNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MetaAttribute.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaAttribute.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ClassElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># default value requires a MetaDataType valueType</span>
    <span class="n">defaultValue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaDataType</span><span class="p">)</span> <span class="ow">and</span> <span class="n">defaultValue</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value only when valueType is a MetaDataType&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

    <span class="c1"># default value must be valid</span>
    <span class="k">if</span> <span class="n">defaultValue</span><span class="p">:</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaDataType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value only when valueType is a MetaDataType&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultValue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="n">infinity</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value </span><span class="si">%s</span><span class="s2"> longer than hicard </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">defaultValue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value </span><span class="si">%s</span><span class="s2"> shorter than locard </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span><span class="p">))</span>

      <span class="c1">#if self.locard == 0:</span>
      <span class="c1">#  # optional attribute with default value is not allowed </span>
      <span class="c1">#  # there would be no way to set it to None or empty</span>
      <span class="c1">#  raise MemopsError(</span>
      <span class="c1">#   &quot;%s - attribute with cardinality 0..%s has defaultValue (%s)&quot;</span>
      <span class="c1">#   % (self, self.hicard, self.defaultValue)</span>
      <span class="c1">#  )</span>


      <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">defaultValue</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">dv</span><span class="p">):</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value </span><span class="si">%s</span><span class="s2"> from  </span><span class="si">%s</span><span class="s2"> is invalid&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">dv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">))</span>

    <span class="c1"># package access check</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access valueType </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">))</span>

    <span class="c1"># special check:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> -attribute can not have class valueType: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaParameter"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaParameter">[docs]</a><span class="k">class</span> <span class="nc">MetaParameter</span><span class="p">(</span><span class="n">AbstractValue</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for roles (link ends) </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">AbstractValue</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HasParameters</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;locard&#39;</span><span class="p">][</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;direction&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;Token&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;enumeration&#39;</span><span class="p">:</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">direction_enumeration</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;valueType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">AbstractDataType</span><span class="p">,</span> <span class="p">},</span>
                        <span class="s1">&#39;defaultValue&#39;</span><span class="p">:{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>


  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">AbstractValue</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaParameter&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">AbstractValue</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_HasParameters__parameterNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MetaParameter.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaParameter.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">AbstractValue</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="n">valueType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span>
    <span class="n">superValueTypes</span> <span class="o">=</span> <span class="n">valueType</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()</span>
    <span class="n">Base</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">):</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseClassName</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaDataObjType</span><span class="p">):</span>
      <span class="n">Base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="n">metaConstants</span><span class="o">.</span><span class="n">modellingPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">implementationPackageName</span><span class="p">,</span>
         <span class="n">metaConstants</span><span class="o">.</span><span class="n">baseDataTypeObjName</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">Base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Base</span> <span class="ow">in</span> <span class="n">superValueTypes</span><span class="p">:</span>
      <span class="c1">#raise MemopsError(&quot;%s valueType %s does not descend from %s&quot;</span>
      <span class="c1">#                  % (self, valueType, Base))</span>
      <span class="c1">#NBNB TBD tenporary HACK - test should be put back soonest</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING - </span><span class="si">%s</span><span class="s2"> valueType </span><span class="si">%s</span><span class="s2"> does not descend from </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">valueType</span><span class="p">,</span> <span class="n">Base</span><span class="p">))</span>

    <span class="c1"># package access check</span>
    <span class="n">operationData</span> <span class="o">=</span> <span class="n">OpTypes</span><span class="o">.</span><span class="n">operationData</span>
    <span class="k">if</span> <span class="n">operationData</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">opType</span><span class="p">][</span><span class="s1">&#39;targetTag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;masterOp&#39;</span><span class="p">:</span>
      <span class="c1"># Other operations have their parameters follow autogeneration rules</span>
      <span class="c1"># also, ops for e.g. interpackage links would fail this test</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access valueType </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">))</span>

    <span class="c1"># default value checks</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">:</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">in_direction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - non-input parameter has explicit default </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - has explicit default </span><span class="si">%s</span><span class="s2"> and hicard </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - is mandatory but has explicit default </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">))</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">,</span> <span class="n">MetaDataType</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: explicit default </span><span class="si">%s</span><span class="s2"> but valueType </span><span class="si">%s</span><span class="s2"> is not a MetaDataType&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">))</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">isValid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - default value </span><span class="si">%s</span><span class="s2"> is invalid&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultValue</span><span class="p">))</span>

    <span class="c1"># optional parameters</span>
    <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">in_direction</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - non-input parameter is optional (0..1)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>


    <span class="c1"># check subdivided parameters</span>
    <span class="c1"># these are Dictionaries that are implemented as undefined keyword/value</span>
    <span class="c1"># input or lists implemented as undefined parameters </span>
    <span class="c1"># for langauges that allow it.</span>
    <span class="c1"># In practice we are talking about Python *par and **par.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">taggedValues</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;isSubdivided&#39;</span><span class="p">):</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">!=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">in_direction</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - isSubdivided and direction is not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hicard</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided parameter is 1..0&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">skDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaObjFromQualName</span><span class="p">(</span>
          <span class="s1">&#39;memops.Implementation.StringKeyDict&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">skDict</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - isSubdivided, hicard == 1 and type is not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="bp">self</span><span class="p">,</span> <span class="n">skDict</span><span class="p">))</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locard</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: isSubdivided parameter is n..m&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">))</span>


    <span class="c1"># check overiding of elements. NB special, as operations</span>
    <span class="c1"># override but do not have supertypes themselves</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span>
    <span class="n">superContainer</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaOperation</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">supertype</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">superContainer</span> <span class="o">=</span> <span class="n">supertype</span><span class="o">.</span><span class="n">_MetaModelElement__elementDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
          <span class="n">container</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">superContainer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">break</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaException</span><span class="p">):</span>
      <span class="n">superContainer</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">supertype</span>

    <span class="k">if</span> <span class="n">superContainer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">superContainer</span><span class="o">.</span><span class="n">opType</span> <span class="o">!=</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span>
      <span class="n">superElem</span> <span class="o">=</span> <span class="n">superContainer</span><span class="o">.</span><span class="n">getElement</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">superElem</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: new parameter </span><span class="si">%s</span><span class="s2"> in overriding </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span>
          <span class="n">container</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">superContainer</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check that parameters fit</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isImplicit</span> <span class="ow">and</span> <span class="n">superElem</span><span class="o">.</span><span class="n">isImplicit</span><span class="p">):</span>
          <span class="c1"># no need to police autogenerated parameters.</span>

          <span class="n">parameterData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterData</span>
          <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">parameterData</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;container&#39;</span><span class="p">,</span> <span class="s1">&#39;documentation&#39;</span><span class="p">,</span> <span class="s1">&#39;guid&#39;</span><span class="p">,</span> <span class="s1">&#39;defaultValue&#39;</span><span class="p">):</span>
              <span class="k">continue</span>

            <span class="k">if</span> <span class="n">parameterData</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span>
              <span class="k">continue</span>

            <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
            <span class="n">superval</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">superval</span><span class="p">:</span>
              <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;locard&#39;</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">superval</span> <span class="o">&gt;</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: locard </span><span class="si">%s</span><span class="s2"> lower than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;hicard&#39;</span><span class="p">:</span>

              <span class="k">if</span> <span class="p">(</span><span class="n">superval</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overriding </span><span class="si">%s</span><span class="s2">: hicard must be 1 in both or neither&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

              <span class="k">elif</span> <span class="n">superval</span> <span class="o">==</span> <span class="n">infinity</span><span class="p">:</span>
                <span class="k">pass</span>

              <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="n">infinity</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard infinity higher than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>
                <span class="k">pass</span>

              <span class="k">elif</span> <span class="n">superval</span> <span class="o">&lt;</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                  <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: hicard </span><span class="si">%s</span><span class="s2"> higher than in overridden </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">superElem</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;valueType&#39;</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">superval</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">getAllSupertypes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">superval</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;memops.Implementation.Any&#39;</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2">, but valuetype </span><span class="si">%s</span><span class="s2"> is not a subtype of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">superval</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;taggedValues&#39;</span><span class="p">:</span>
              <span class="k">for</span> <span class="n">tt</span><span class="p">,</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">superval</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span> <span class="o">!=</span> <span class="n">vv</span><span class="p">:</span>
                  <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but tagged value </span><span class="si">%s</span><span class="s2"> differs&quot;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">tt</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
              <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> overrides </span><span class="si">%s</span><span class="s2"> but differs for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">superElem</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>

<div class="viewcode-block" id="MetaConstant"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstant">[docs]</a><span class="k">class</span> <span class="nc">MetaConstant</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; class for static constants</span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MetaPackage</span>
  <span class="n">parameterData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:{},</span> <span class="s1">&#39;valueType&#39;</span><span class="p">:{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="n">MetaDataType</span><span class="p">,</span> <span class="p">},</span> <span class="p">})</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaConstant&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># finish link from container</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_MetaPackage__constantNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="MetaConstant.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstant.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="o">.</span><span class="n">isValid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - value </span><span class="si">%s</span><span class="s2"> is invalid&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="c1"># package access check</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">canAccess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - cannot access valueType </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">valueType</span><span class="p">))</span>

    <span class="c1"># name style</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">uppercase</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING, name of </span><span class="si">%s</span><span class="s2"> does not start with upper case&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="p">)</span></div></div>


<span class="c1">#############################################################################</span>


<div class="viewcode-block" id="MetaConstraint"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstraint">[docs]</a><span class="k">class</span> <span class="nc">MetaConstraint</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; abstract class for elements </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="c1"># information for handling input parameters</span>
  <span class="n">parameterData</span> <span class="o">=</span> <span class="n">metaUtil</span><span class="o">.</span><span class="n">semideepcopy</span><span class="p">(</span><span class="n">MetaModelElement</span><span class="o">.</span><span class="n">parameterData</span><span class="p">)</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;container&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConstrainedElement</span>
  <span class="n">parameterData</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;StringDict&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:{},</span> <span class="p">}</span>

  <span class="c1"># allowed tagged values</span>
  <span class="n">allowedTags</span> <span class="o">=</span> <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">allowedTags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
  <span class="n">allowedTags</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">TaggedValues</span><span class="o">.</span><span class="n">allowedTags</span><span class="p">[</span><span class="s1">&#39;MetaConstraint&#39;</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># special case - MetaParameters cannot have constraints.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">MetaParameter</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;Attempt to add constraint to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">)</span>

<div class="viewcode-block" id="MetaConstraint.addCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstraint.addCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">addCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Add codeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub tag </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="n">StringType</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> codeStub </span><span class="si">%s</span><span class="s2"> value </span><span class="si">%s</span><span class="s2"> is not a string&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> : unsupported  codeStub tag </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="MetaConstraint.removeCodeStub"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstraint.removeCodeStub">[docs]</a>  <span class="k">def</span> <span class="nf">removeCodeStub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Remove existing CodeStub</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span>
                                                         <span class="n">sentinel</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">sentinel</span><span class="p">:</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">][</span><span class="n">tag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no CodeStub </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetaConstraint.checkValid"><a class="viewcode-back" href="../../../../../ccpnmodel/ccpnmodel.ccpncore.memops.metamodel.html#ccpnmodel.ccpncore.memops.metamodel.MetaModel.MetaConstraint.checkValid">[docs]</a>  <span class="k">def</span> <span class="nf">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check that object is valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">MetaModelElement</span><span class="o">.</span><span class="n">checkValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complete</span><span class="o">=</span><span class="n">complete</span><span class="p">)</span>

    <span class="c1"># check if container is derived</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span> <span class="n">ClassElement</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">isDerived</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;MetaConstraint </span><span class="si">%s</span><span class="s2"> is attached to derived element&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

    <span class="c1"># check if container is Implementation</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="p">,</span>
                  <span class="n">ClassElement</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">isImplementation</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span>
        <span class="s2">&quot;MetaConstraint </span><span class="si">%s</span><span class="s2"> is attached to Implementation element&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifiedName</span><span class="p">())</span>

    <span class="c1"># check code</span>
    <span class="n">codeStubs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MetaModelElement__dataDict</span><span class="p">[</span><span class="s1">&#39;codeStubs&#39;</span><span class="p">]</span>
    <span class="n">codeTags</span> <span class="o">=</span> <span class="n">metaConstants</span><span class="o">.</span><span class="n">codeStubTags</span>
    <span class="k">for</span> <span class="n">codeTag</span> <span class="ow">in</span> <span class="n">codeStubs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

      <span class="c1"># check code tags</span>
      <span class="k">if</span> <span class="n">codeTag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codeTags</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Ilegal codeStub tag </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codeTag</span><span class="p">))</span>

      <span class="c1"># check code content</span>
      <span class="n">codeString</span> <span class="o">=</span> <span class="n">codeStubs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">codeTag</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">codeString</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">codeString</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;isValid&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span>
        <span class="n">codeString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span>
      <span class="p">):</span>
        <span class="k">raise</span> <span class="n">MemopsError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;MetaConstraint:</span>
<span class="si">%s</span><span class="s2"></span>
<span class="s2">has multiline </span><span class="si">%s</span><span class="s2"> code:</span>

<span class="si">%s</span><span class="s2"></span>

<span class="s2">that does not contains string &#39;isValid&#39;</span>
<span class="s2">      &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codeTag</span><span class="p">,</span> <span class="n">codeString</span><span class="p">))</span></div></div>


<span class="c1">#############################################################################</span>
<span class="c1">#</span>
<span class="c1"># classes</span>
<span class="c1">#</span>
<span class="c1">#############################################################################</span>

<span class="c1"># non-abstract classes. NB used in XmlModelGen</span>
<span class="n">nonAbstractClasses</span> <span class="o">=</span> <span class="p">(</span>
  <span class="n">MetaPackage</span><span class="p">,</span> <span class="n">MetaClass</span><span class="p">,</span> <span class="n">MetaDataObjType</span><span class="p">,</span> <span class="n">MetaDataType</span><span class="p">,</span> <span class="n">MetaException</span><span class="p">,</span>
  <span class="n">MetaOperation</span><span class="p">,</span> <span class="n">MetaRole</span><span class="p">,</span> <span class="n">MetaAttribute</span><span class="p">,</span> <span class="n">MetaParameter</span><span class="p">,</span> <span class="n">MetaConstant</span><span class="p">,</span>
  <span class="n">MetaConstraint</span>
<span class="p">)</span>

<span class="c1"># check business rules for MetaClasses</span>
<span class="k">for</span> <span class="n">cls</span> <span class="ow">in</span> <span class="n">nonAbstractClasses</span><span class="p">:</span>
  <span class="n">finaliseMetaClass</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Python  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright .
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>